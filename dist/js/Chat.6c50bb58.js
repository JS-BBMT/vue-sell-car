"use strict";(self["webpackChunkflutter_buy_sell"]=self["webpackChunkflutter_buy_sell"]||[]).push([[2370],{9446:function(e,t,n){var r=n(6099),i=n(909),o=n(4589),s=n(655),a=n(4594);e=n.hmd(e);var u="@firebase/database",l="0.11.0",c="";function h(e){c=e}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var d=function(){function e(e){this.domStorage_=e,this.prefix_="firebase:"}return e.prototype.set=function(e,t){null==t?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),(0,o.Pz)(t))},e.prototype.get=function(e){var t=this.domStorage_.getItem(this.prefixedName_(e));return null==t?null:(0,o.cI)(t)},e.prototype.remove=function(e){this.domStorage_.removeItem(this.prefixedName_(e))},e.prototype.prefixedName_=function(e){return this.prefix_+e},e.prototype.toString=function(){return this.domStorage_.toString()},e}(),p=function(){function e(){this.cache_={},this.isInMemoryStorage=!0}return e.prototype.set=function(e,t){null==t?delete this.cache_[e]:this.cache_[e]=t},e.prototype.get=function(e){return(0,o.r3)(this.cache_,e)?this.cache_[e]:null},e.prototype.remove=function(e){delete this.cache_[e]},e}(),f=function(e){try{if("undefined"!==typeof window&&"undefined"!==typeof window[e]){var t=window[e];return t.setItem("firebase:sentinel","cache"),t.removeItem("firebase:sentinel"),new d(t)}}catch(n){}return new p},_=f("localStorage"),v=f("sessionStorage"),y=new a.Yd("@firebase/database"),m=function(){var e=1;return function(){return e++}}(),g=function(e){var t=(0,o.dS)(e),n=new o.gQ;n.update(t);var r=n.digest();return o.US.encodeByteArray(r)},w=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var n="",r=0;r<e.length;r++){var i=e[r];Array.isArray(i)||i&&"object"===typeof i&&"number"===typeof i.length?n+=w.apply(null,i):n+="object"===typeof i?(0,o.Pz)(i):i,n+=" "}return n},C=null,b=!0,k=function(e,t){(0,o.hu)(!t||!0===e||!1===e,"Can't turn on custom loggers persistently."),!0===e?(y.logLevel=a["in"].VERBOSE,C=y.log.bind(y),t&&v.set("logging_enabled",!0)):"function"===typeof e?C=e:(C=null,v.remove("logging_enabled"))},T=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];if(!0===b&&(b=!1,null===C&&!0===v.get("logging_enabled")&&k(!0)),C){var n=w.apply(null,e);C(n)}},I=function(e){return function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];T.apply(void 0,(0,s.ev)([e],(0,s.CR)(t)))}},x=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n="FIREBASE INTERNAL ERROR: "+w.apply(void 0,(0,s.ev)([],(0,s.CR)(e)));y.error(n)},S=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n="FIREBASE FATAL ERROR: "+w.apply(void 0,(0,s.ev)([],(0,s.CR)(e)));throw y.error(n),new Error(n)},P=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n="FIREBASE WARNING: "+w.apply(void 0,(0,s.ev)([],(0,s.CR)(e)));y.warn(n)},E=function(){"undefined"!==typeof window&&window.location&&window.location.protocol&&-1!==window.location.protocol.indexOf("https:")&&P("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().")},D=function(e){return"number"===typeof e&&(e!==e||e===Number.POSITIVE_INFINITY||e===Number.NEGATIVE_INFINITY)},R=function(e){if((0,o.Yr)()||"complete"===document.readyState)e();else{var t=!1,n=function(){document.body?t||(t=!0,e()):setTimeout(n,Math.floor(10))};document.addEventListener?(document.addEventListener("DOMContentLoaded",n,!1),window.addEventListener("load",n,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",(function(){"complete"===document.readyState&&n()})),window.attachEvent("onload",n))}},N="[MIN_NAME]",U="[MAX_NAME]",A=function(e,t){if(e===t)return 0;if(e===N||t===U)return-1;if(t===N||e===U)return 1;var n=V(e),r=V(t);return null!==n?null!==r?n-r===0?e.length-t.length:n-r:-1:null!==r?1:e<t?-1:1},O=function(e,t){return e===t?0:e<t?-1:1},M=function(e,t){if(t&&e in t)return t[e];throw new Error("Missing required key ("+e+") in object: "+(0,o.Pz)(t))},L=function(e){if("object"!==typeof e||null===e)return(0,o.Pz)(e);var t=[];for(var n in e)t.push(n);t.sort();for(var r="{",i=0;i<t.length;i++)0!==i&&(r+=","),r+=(0,o.Pz)(t[i]),r+=":",r+=L(e[t[i]]);return r+="}",r},q=function(e,t){var n=e.length;if(n<=t)return[e];for(var r=[],i=0;i<n;i+=t)i+t>n?r.push(e.substring(i,n)):r.push(e.substring(i,i+t));return r};
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function F(e,t){for(var n in e)e.hasOwnProperty(n)&&t(n,e[n])}var W=function(e){(0,o.hu)(!D(e),"Invalid JSON number");var t,n,r,i,s,a=11,u=52,l=(1<<a-1)-1;0===e?(n=0,r=0,t=1/e===-1/0?1:0):(t=e<0,e=Math.abs(e),e>=Math.pow(2,1-l)?(i=Math.min(Math.floor(Math.log(e)/Math.LN2),l),n=i+l,r=Math.round(e*Math.pow(2,u-i)-Math.pow(2,u))):(n=0,r=Math.round(e/Math.pow(2,1-l-u))));var c=[];for(s=u;s;s-=1)c.push(r%2?1:0),r=Math.floor(r/2);for(s=a;s;s-=1)c.push(n%2?1:0),n=Math.floor(n/2);c.push(t?1:0),c.reverse();var h=c.join(""),d="";for(s=0;s<64;s+=8){var p=parseInt(h.substr(s,8),2).toString(16);1===p.length&&(p="0"+p),d+=p}return d.toLowerCase()},H=function(){return!("object"!==typeof window||!window["chrome"]||!window["chrome"]["extension"]||/^chrome/.test(window.location.href))},j=function(){return"object"===typeof Windows&&"object"===typeof Windows.UI};function Z(e,t){var n="Unknown Error";"too_big"===e?n="The data requested exceeds the maximum size that can be accessed with a single request.":"permission_denied"===e?n="Client doesn't have permission to access the desired data.":"unavailable"===e&&(n="The service is unavailable");var r=new Error(e+" at "+t._path.toString()+": "+n);return r.code=e.toUpperCase(),r}var B=new RegExp("^-?(0*)\\d{1,10}$"),z=-2147483648,Y=2147483647,V=function(e){if(B.test(e)){var t=Number(e);if(t>=z&&t<=Y)return t}return null},G=function(e){try{e()}catch(t){setTimeout((function(){var e=t.stack||"";throw P("Exception was thrown by user callback.",e),t}),Math.floor(0))}},$=function(){var e="object"===typeof window&&window["navigator"]&&window["navigator"]["userAgent"]||"";return e.search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0},Q=function(e,t){var n=setTimeout(e,t);return"object"===typeof n&&n["unref"]&&n["unref"](),n},K=function(){function e(e,t){var n=this;this.appName_=e,this.appCheckProvider=t,this.appCheck=null===t||void 0===t?void 0:t.getImmediate({optional:!0}),this.appCheck||null===t||void 0===t||t.get().then((function(e){return n.appCheck=e}))}return e.prototype.getToken=function(e){var t=this;return this.appCheck?this.appCheck.getToken(e):new Promise((function(n,r){setTimeout((function(){t.appCheck?t.getToken(e).then(n,r):n(null)}),0)}))},e.prototype.addTokenChangeListener=function(e){var t;null===(t=this.appCheckProvider)||void 0===t||t.get().then((function(t){return t.addTokenListener(e)}))},e.prototype.notifyForInvalidToken=function(){P('Provided AppCheck credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly.')},e}(),J=function(){function e(e,t,n){var r=this;this.appName_=e,this.firebaseOptions_=t,this.authProvider_=n,this.auth_=null,this.auth_=n.getImmediate({optional:!0}),this.auth_||n.onInit((function(e){return r.auth_=e}))}return e.prototype.getToken=function(e){var t=this;return this.auth_?this.auth_.getToken(e).catch((function(e){return e&&"auth/token-not-initialized"===e.code?(T("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(e)})):new Promise((function(n,r){setTimeout((function(){t.auth_?t.getToken(e).then(n,r):n(null)}),0)}))},e.prototype.addTokenChangeListener=function(e){this.auth_?this.auth_.addAuthTokenListener(e):this.authProvider_.get().then((function(t){return t.addAuthTokenListener(e)}))},e.prototype.removeTokenChangeListener=function(e){this.authProvider_.get().then((function(t){return t.removeAuthTokenListener(e)}))},e.prototype.notifyForInvalidToken=function(){var e='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?e+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?e+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':e+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',P(e)},e}(),X=function(){function e(e){this.accessToken=e}return e.prototype.getToken=function(e){return Promise.resolve({accessToken:this.accessToken})},e.prototype.addTokenChangeListener=function(e){e(this.accessToken)},e.prototype.removeTokenChangeListener=function(e){},e.prototype.notifyForInvalidToken=function(){},e.OWNER="owner",e}(),ee="5",te="v",ne="s",re="r",ie="f",oe=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,se="ls",ae="p",ue="ac",le="websocket",ce="long_polling",he=function(){function e(e,t,n,r,i,o,s){void 0===i&&(i=!1),void 0===o&&(o=""),void 0===s&&(s=!1),this.secure=t,this.namespace=n,this.webSocketOnly=r,this.nodeAdmin=i,this.persistenceKey=o,this.includeNamespaceInQueryParams=s,this._host=e.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=_.get("host:"+e)||this._host}return e.prototype.isCacheableHost=function(){return"s-"===this.internalHost.substr(0,2)},e.prototype.isCustomHost=function(){return"firebaseio.com"!==this._domain&&"firebaseio-demo.com"!==this._domain},Object.defineProperty(e.prototype,"host",{get:function(){return this._host},set:function(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&_.set("host:"+this._host,this.internalHost))},enumerable:!1,configurable:!0}),e.prototype.toString=function(){var e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e},e.prototype.toURLString=function(){var e=this.secure?"https://":"http://",t=this.includeNamespaceInQueryParams?"?ns="+this.namespace:"";return""+e+this.host+"/"+t},e}();function de(e){return e.host!==e.internalHost||e.isCustomHost()||e.includeNamespaceInQueryParams}function pe(e,t,n){var r;if((0,o.hu)("string"===typeof t,"typeof type must == string"),(0,o.hu)("object"===typeof n,"typeof params must == object"),t===le)r=(e.secure?"wss://":"ws://")+e.internalHost+"/.ws?";else{if(t!==ce)throw new Error("Unknown connection type: "+t);r=(e.secure?"https://":"http://")+e.internalHost+"/.lp?"}de(e)&&(n["ns"]=e.namespace);var i=[];return F(n,(function(e,t){i.push(e+"="+t)})),r+i.join("&")}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var fe=function(){function e(){this.counters_={}}return e.prototype.incrementCounter=function(e,t){void 0===t&&(t=1),(0,o.r3)(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=t},e.prototype.get=function(){return(0,o.p$)(this.counters_)},e}(),_e={},ve={};
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ye(e){var t=e.toString();return _e[t]||(_e[t]=new fe),_e[t]}function me(e,t){var n=e.toString();return ve[n]||(ve[n]=t()),ve[n]}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var ge=function(){function e(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}return e.prototype.closeAfter=function(e,t){this.closeAfterResponse=e,this.onClose=t,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)},e.prototype.handleResponse=function(e,t){var n=this;this.pendingResponses[e]=t;var r=function(){var e=i.pendingResponses[i.currentResponseNum];delete i.pendingResponses[i.currentResponseNum];for(var t=function(t){e[t]&&G((function(){n.onMessage_(e[t])}))},r=0;r<e.length;++r)t(r);if(i.currentResponseNum===i.closeAfterResponse)return i.onClose&&(i.onClose(),i.onClose=null),"break";i.currentResponseNum++},i=this;while(this.pendingResponses[this.currentResponseNum]){var o=r();if("break"===o)break}},e}(),we="start",Ce="close",be="pLPCommand",ke="pRTLPCB",Te="id",Ie="pw",xe="ser",Se="cb",Pe="seg",Ee="ts",De="d",Re="dframe",Ne=1870,Ue=30,Ae=Ne-Ue,Oe=25e3,Me=3e4,Le=function(){function e(e,t,n,r,i,o,s){var a=this;this.connId=e,this.repoInfo=t,this.applicationId=n,this.appCheckToken=r,this.authToken=i,this.transportSessionId=o,this.lastSessionId=s,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=I(e),this.stats_=ye(t),this.urlFn=function(e){return a.appCheckToken&&(e[ue]=a.appCheckToken),pe(t,ce,e)}}return e.prototype.open=function(e,t){var n=this;this.curSegmentNum=0,this.onDisconnect_=t,this.myPacketOrderer=new ge(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout((function(){n.log_("Timed out trying to connect."),n.onClosed_(),n.connectTimeoutTimer_=null}),Math.floor(Me)),R((function(){if(!n.isClosed_){n.scriptTagHolder=new qe((function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=(0,s.CR)(e,5),i=r[0],o=r[1],a=r[2];if(r[3],r[4],n.incrementIncomingBytes_(e),n.scriptTagHolder)if(n.connectTimeoutTimer_&&(clearTimeout(n.connectTimeoutTimer_),n.connectTimeoutTimer_=null),n.everConnected_=!0,i===we)n.id=o,n.password=a;else{if(i!==Ce)throw new Error("Unrecognized command received: "+i);o?(n.scriptTagHolder.sendNewPolls=!1,n.myPacketOrderer.closeAfter(o,(function(){n.onClosed_()}))):n.onClosed_()}}),(function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=(0,s.CR)(e,2),i=r[0],o=r[1];n.incrementIncomingBytes_(e),n.myPacketOrderer.handleResponse(i,o)}),(function(){n.onClosed_()}),n.urlFn);var e={};e[we]="t",e[xe]=Math.floor(1e8*Math.random()),n.scriptTagHolder.uniqueCallbackIdentifier&&(e[Se]=n.scriptTagHolder.uniqueCallbackIdentifier),e[te]=ee,n.transportSessionId&&(e[ne]=n.transportSessionId),n.lastSessionId&&(e[se]=n.lastSessionId),n.applicationId&&(e[ae]=n.applicationId),n.appCheckToken&&(e[ue]=n.appCheckToken),"undefined"!==typeof location&&location.hostname&&oe.test(location.hostname)&&(e[re]=ie);var t=n.urlFn(e);n.log_("Connecting via long-poll to "+t),n.scriptTagHolder.addTag(t,(function(){}))}}))},e.prototype.start=function(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)},e.forceAllow=function(){e.forceAllow_=!0},e.forceDisallow=function(){e.forceDisallow_=!0},e.isAvailable=function(){return!(0,o.Yr)()&&(!!e.forceAllow_||!e.forceDisallow_&&"undefined"!==typeof document&&null!=document.createElement&&!H()&&!j())},e.prototype.markConnectionHealthy=function(){},e.prototype.shutdown_=function(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)},e.prototype.onClosed_=function(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))},e.prototype.close=function(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())},e.prototype.send=function(e){var t=(0,o.Pz)(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);for(var n=(0,o.h$)(t),r=q(n,Ae),i=0;i<r.length;i++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,r.length,r[i]),this.curSegmentNum++},e.prototype.addDisconnectPingFrame=function(e,t){if(!(0,o.Yr)()){this.myDisconnFrame=document.createElement("iframe");var n={};n[Re]="t",n[Te]=e,n[Ie]=t,this.myDisconnFrame.src=this.urlFn(n),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}},e.prototype.incrementIncomingBytes_=function(e){var t=(0,o.Pz)(e).length;this.bytesReceived+=t,this.stats_.incrementCounter("bytes_received",t)},e}(),qe=function(){function e(t,n,r,i){if(this.onDisconnect=r,this.urlFn=i,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(1e8*Math.random()),this.sendNewPolls=!0,(0,o.Yr)())this.commandCB=t,this.onMessageCB=n;else{this.uniqueCallbackIdentifier=m(),window[be+this.uniqueCallbackIdentifier]=t,window[ke+this.uniqueCallbackIdentifier]=n,this.myIFrame=e.createIFrame_();var s="";if(this.myIFrame.src&&"javascript:"===this.myIFrame.src.substr(0,"javascript:".length)){var a=document.domain;s='<script>document.domain="'+a+'";<\/script>'}var u="<html><body>"+s+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(u),this.myIFrame.doc.close()}catch(l){T("frame writing exception"),l.stack&&T(l.stack),T(l)}}}return e.createIFrame_=function(){var e=document.createElement("iframe");if(e.style.display="none",!document.body)throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";document.body.appendChild(e);try{var t=e.contentWindow.document;t||T("No IE domain setting required")}catch(r){var n=document.domain;e.src="javascript:void((function(){document.open();document.domain='"+n+"';document.close();})())"}return e.contentDocument?e.doc=e.contentDocument:e.contentWindow?e.doc=e.contentWindow.document:e.document&&(e.doc=e.document),e},e.prototype.close=function(){var e=this;this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.innerHTML="",setTimeout((function(){null!==e.myIFrame&&(document.body.removeChild(e.myIFrame),e.myIFrame=null)}),Math.floor(0)));var t=this.onDisconnect;t&&(this.onDisconnect=null,t())},e.prototype.startLongPoll=function(e,t){this.myID=e,this.myPW=t,this.alive=!0;while(this.newRequest_());},e.prototype.newRequest_=function(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;var e={};e[Te]=this.myID,e[Ie]=this.myPW,e[xe]=this.currentSerial;var t=this.urlFn(e),n="",r=0;while(this.pendingSegs.length>0){var i=this.pendingSegs[0];if(!(i.d.length+Ue+n.length<=Ne))break;var o=this.pendingSegs.shift();n=n+"&"+Pe+r+"="+o.seg+"&"+Ee+r+"="+o.ts+"&"+De+r+"="+o.d,r++}return t+=n,this.addLongPollTag_(t,this.currentSerial),!0}return!1},e.prototype.enqueueSegment=function(e,t,n){this.pendingSegs.push({seg:e,ts:t,d:n}),this.alive&&this.newRequest_()},e.prototype.addLongPollTag_=function(e,t){var n=this;this.outstandingRequests.add(t);var r=function(){n.outstandingRequests.delete(t),n.newRequest_()},i=setTimeout(r,Math.floor(Oe)),o=function(){clearTimeout(i),r()};this.addTag(e,o)},e.prototype.addTag=function(e,t){var n=this;(0,o.Yr)()?this.doNodeLongPoll(e,t):setTimeout((function(){try{if(!n.sendNewPolls)return;var r=n.myIFrame.doc.createElement("script");r.type="text/javascript",r.async=!0,r.src=e,r.onload=r.onreadystatechange=function(){var e=r.readyState;e&&"loaded"!==e&&"complete"!==e||(r.onload=r.onreadystatechange=null,r.parentNode&&r.parentNode.removeChild(r),t())},r.onerror=function(){T("Long-poll script failed to load: "+e),n.sendNewPolls=!1,n.close()},n.myIFrame.doc.body.appendChild(r)}catch(i){}}),Math.floor(1))},e}(),Fe=16384,We=45e3,He=null;
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */"undefined"!==typeof MozWebSocket?He=MozWebSocket:"undefined"!==typeof WebSocket&&(He=WebSocket);var je=function(){function e(t,n,r,i,o,s,a){this.connId=t,this.applicationId=r,this.appCheckToken=i,this.authToken=o,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=I(this.connId),this.stats_=ye(n),this.connURL=e.connectionURL_(n,s,a,i),this.nodeAdmin=n.nodeAdmin}return e.connectionURL_=function(e,t,n,r){var i={};return i[te]=ee,!(0,o.Yr)()&&"undefined"!==typeof location&&location.hostname&&oe.test(location.hostname)&&(i[re]=ie),t&&(i[ne]=t),n&&(i[se]=n),r&&(i[ue]=r),pe(e,le,i)},e.prototype.open=function(e,t){var n=this;this.onDisconnect=t,this.onMessage=e,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,_.set("previous_websocket_failure",!0);try{if((0,o.Yr)()){var r=this.nodeAdmin?"AdminNode":"Node",i={headers:{"User-Agent":"Firebase/"+ee+"/"+c+"/"+process.platform+"/"+r,"X-Firebase-GMPID":this.applicationId||""}};this.authToken&&(i.headers["Authorization"]="Bearer "+this.authToken),this.appCheckToken&&(i.headers["X-Firebase-AppCheck"]=this.appCheckToken);var s={NODE_ENV:"production",BASE_URL:"/"},a=0===this.connURL.indexOf("wss://")?s["HTTPS_PROXY"]||s["https_proxy"]:s["HTTP_PROXY"]||s["http_proxy"];a&&(i["proxy"]={origin:a}),this.mySock=new He(this.connURL,[],i)}else{i={headers:{"X-Firebase-GMPID":this.applicationId||"","X-Firebase-AppCheck":this.appCheckToken||""}};this.mySock=new He(this.connURL,[],i)}}catch(l){this.log_("Error instantiating WebSocket.");var u=l.message||l.data;return u&&this.log_(u),void this.onClosed_()}this.mySock.onopen=function(){n.log_("Websocket connected."),n.everConnected_=!0},this.mySock.onclose=function(){n.log_("Websocket connection was disconnected."),n.mySock=null,n.onClosed_()},this.mySock.onmessage=function(e){n.handleIncomingFrame(e)},this.mySock.onerror=function(e){n.log_("WebSocket error.  Closing connection.");var t=e.message||e.data;t&&n.log_(t),n.onClosed_()}},e.prototype.start=function(){},e.forceDisallow=function(){e.forceDisallow_=!0},e.isAvailable=function(){var t=!1;if("undefined"!==typeof navigator&&navigator.userAgent){var n=/Android ([0-9]{0,}\.[0-9]{0,})/,r=navigator.userAgent.match(n);r&&r.length>1&&parseFloat(r[1])<4.4&&(t=!0)}return!t&&null!==He&&!e.forceDisallow_},e.previouslyFailed=function(){return _.isInMemoryStorage||!0===_.get("previous_websocket_failure")},e.prototype.markConnectionHealthy=function(){_.remove("previous_websocket_failure")},e.prototype.appendFrame_=function(e){if(this.frames.push(e),this.frames.length===this.totalFrames){var t=this.frames.join("");this.frames=null;var n=(0,o.cI)(t);this.onMessage(n)}},e.prototype.handleNewFrameCount_=function(e){this.totalFrames=e,this.frames=[]},e.prototype.extractFrameCount_=function(e){if((0,o.hu)(null===this.frames,"We already have a frame buffer"),e.length<=6){var t=Number(e);if(!isNaN(t))return this.handleNewFrameCount_(t),null}return this.handleNewFrameCount_(1),e},e.prototype.handleIncomingFrame=function(e){if(null!==this.mySock){var t=e["data"];if(this.bytesReceived+=t.length,this.stats_.incrementCounter("bytes_received",t.length),this.resetKeepAlive(),null!==this.frames)this.appendFrame_(t);else{var n=this.extractFrameCount_(t);null!==n&&this.appendFrame_(n)}}},e.prototype.send=function(e){this.resetKeepAlive();var t=(0,o.Pz)(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);var n=q(t,Fe);n.length>1&&this.sendString_(String(n.length));for(var r=0;r<n.length;r++)this.sendString_(n[r])},e.prototype.shutdown_=function(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)},e.prototype.onClosed_=function(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))},e.prototype.close=function(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())},e.prototype.resetKeepAlive=function(){var e=this;clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval((function(){e.mySock&&e.sendString_("0"),e.resetKeepAlive()}),Math.floor(We))},e.prototype.sendString_=function(e){try{this.mySock.send(e)}catch(t){this.log_("Exception thrown from WebSocket.send():",t.message||t.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}},e.responsesRequiredToBeHealthy=2,e.healthyTimeout=3e4,e}(),Ze=function(){function e(e){this.initTransports_(e)}return Object.defineProperty(e,"ALL_TRANSPORTS",{get:function(){return[Le,je]},enumerable:!1,configurable:!0}),e.prototype.initTransports_=function(t){var n,r,i=je&&je["isAvailable"](),o=i&&!je.previouslyFailed();if(t.webSocketOnly&&(i||P("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),o=!0),o)this.transports_=[je];else{var a=this.transports_=[];try{for(var u=(0,s.XA)(e.ALL_TRANSPORTS),l=u.next();!l.done;l=u.next()){var c=l.value;c&&c["isAvailable"]()&&a.push(c)}}catch(h){n={error:h}}finally{try{l&&!l.done&&(r=u.return)&&r.call(u)}finally{if(n)throw n.error}}}},e.prototype.initialTransport=function(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")},e.prototype.upgradeTransport=function(){return this.transports_.length>1?this.transports_[1]:null},e}(),Be=6e4,ze=5e3,Ye=10240,Ve=102400,Ge="t",$e="d",Qe="s",Ke="r",Je="e",Xe="o",et="a",tt="n",nt="p",rt="h",it=function(){function e(e,t,n,r,i,o,s,a,u,l){this.id=e,this.repoInfo_=t,this.applicationId_=n,this.appCheckToken_=r,this.authToken_=i,this.onMessage_=o,this.onReady_=s,this.onDisconnect_=a,this.onKill_=u,this.lastSessionId=l,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=I("c:"+this.id+":"),this.transportManager_=new Ze(t),this.log_("Connection created"),this.start_()}return e.prototype.start_=function(){var e=this,t=this.transportManager_.initialTransport();this.conn_=new t(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=t["responsesRequiredToBeHealthy"]||0;var n=this.connReceiver_(this.conn_),r=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout((function(){e.conn_&&e.conn_.open(n,r)}),Math.floor(0));var i=t["healthyTimeout"]||0;i>0&&(this.healthyTimeout_=Q((function(){e.healthyTimeout_=null,e.isHealthy_||(e.conn_&&e.conn_.bytesReceived>Ve?(e.log_("Connection exceeded healthy timeout but has received "+e.conn_.bytesReceived+" bytes.  Marking connection healthy."),e.isHealthy_=!0,e.conn_.markConnectionHealthy()):e.conn_&&e.conn_.bytesSent>Ye?e.log_("Connection exceeded healthy timeout but has sent "+e.conn_.bytesSent+" bytes.  Leaving connection alive."):(e.log_("Closing unhealthy connection after timeout."),e.close()))}),Math.floor(i)))},e.prototype.nextTransportId_=function(){return"c:"+this.id+":"+this.connectionCount++},e.prototype.disconnReceiver_=function(e){var t=this;return function(n){e===t.conn_?t.onConnectionLost_(n):e===t.secondaryConn_?(t.log_("Secondary connection lost."),t.onSecondaryConnectionLost_()):t.log_("closing an old connection")}},e.prototype.connReceiver_=function(e){var t=this;return function(n){2!==t.state_&&(e===t.rx_?t.onPrimaryMessageReceived_(n):e===t.secondaryConn_?t.onSecondaryMessageReceived_(n):t.log_("message on old connection"))}},e.prototype.sendRequest=function(e){var t={t:"d",d:e};this.sendData_(t)},e.prototype.tryCleanupConnection=function(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)},e.prototype.onSecondaryControl_=function(e){if(Ge in e){var t=e[Ge];t===et?this.upgradeIfSecondaryHealthy_():t===Ke?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),this.tx_!==this.secondaryConn_&&this.rx_!==this.secondaryConn_||this.close()):t===Xe&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}},e.prototype.onSecondaryMessageReceived_=function(e){var t=M("t",e),n=M("d",e);if("c"===t)this.onSecondaryControl_(n);else{if("d"!==t)throw new Error("Unknown protocol layer: "+t);this.pendingDataMessages.push(n)}},e.prototype.upgradeIfSecondaryHealthy_=function(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:nt,d:{}}}))},e.prototype.proceedWithUpgrade_=function(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:et,d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:tt,d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()},e.prototype.onPrimaryMessageReceived_=function(e){var t=M("t",e),n=M("d",e);"c"===t?this.onControl_(n):"d"===t&&this.onDataMessage_(n)},e.prototype.onDataMessage_=function(e){this.onPrimaryResponse_(),this.onMessage_(e)},e.prototype.onPrimaryResponse_=function(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))},e.prototype.onControl_=function(e){var t=M(Ge,e);if($e in e){var n=e[$e];if(t===rt)this.onHandshake_(n);else if(t===tt){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(var r=0;r<this.pendingDataMessages.length;++r)this.onDataMessage_(this.pendingDataMessages[r]);this.pendingDataMessages=[],this.tryCleanupConnection()}else t===Qe?this.onConnectionShutdown_(n):t===Ke?this.onReset_(n):t===Je?x("Server Error: "+n):t===Xe?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):x("Unknown control packet command: "+t)}},e.prototype.onHandshake_=function(e){var t=e.ts,n=e.v,r=e.h;this.sessionId=e.s,this.repoInfo_.host=r,0===this.state_&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,t),ee!==n&&P("Protocol version mismatch detected"),this.tryStartUpgrade_())},e.prototype.tryStartUpgrade_=function(){var e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)},e.prototype.startUpgrade_=function(e){var t=this;this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=e["responsesRequiredToBeHealthy"]||0;var n=this.connReceiver_(this.secondaryConn_),r=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(n,r),Q((function(){t.secondaryConn_&&(t.log_("Timed out trying to upgrade."),t.secondaryConn_.close())}),Math.floor(Be))},e.prototype.onReset_=function(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.host=e,1===this.state_?this.close():(this.closeConnections_(),this.start_())},e.prototype.onConnectionEstablished_=function(e,t){var n=this;this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(t,this.sessionId),this.onReady_=null),0===this.primaryResponsesRequired_?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):Q((function(){n.sendPingOnPrimaryIfNecessary_()}),Math.floor(ze))},e.prototype.sendPingOnPrimaryIfNecessary_=function(){this.isHealthy_||1!==this.state_||(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:nt,d:{}}}))},e.prototype.onSecondaryConnectionLost_=function(){var e=this.secondaryConn_;this.secondaryConn_=null,this.tx_!==e&&this.rx_!==e||this.close()},e.prototype.onConnectionLost_=function(e){this.conn_=null,e||0!==this.state_?1===this.state_&&this.log_("Realtime connection lost."):(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(_.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)),this.close()},e.prototype.onConnectionShutdown_=function(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()},e.prototype.sendData_=function(e){if(1!==this.state_)throw"Connection is not connected";this.tx_.send(e)},e.prototype.close=function(){2!==this.state_&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))},e.prototype.closeConnections_=function(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)},e}(),ot=function(){function e(){}return e.prototype.put=function(e,t,n,r){},e.prototype.merge=function(e,t,n,r){},e.prototype.refreshAuthToken=function(e){},e.prototype.refreshAppCheckToken=function(e){},e.prototype.onDisconnectPut=function(e,t,n){},e.prototype.onDisconnectMerge=function(e,t,n){},e.prototype.onDisconnectCancel=function(e,t){},e.prototype.reportStats=function(e){},e}(),st=function(){function e(e){this.allowedEvents_=e,this.listeners_={},(0,o.hu)(Array.isArray(e)&&e.length>0,"Requires a non-empty array")}return e.prototype.trigger=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];if(Array.isArray(this.listeners_[e]))for(var r=(0,s.ev)([],(0,s.CR)(this.listeners_[e])),i=0;i<r.length;i++)r[i].callback.apply(r[i].context,t)},e.prototype.on=function(e,t,n){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:t,context:n});var r=this.getInitialEvent(e);r&&t.apply(n,r)},e.prototype.off=function(e,t,n){this.validateEventType_(e);for(var r=this.listeners_[e]||[],i=0;i<r.length;i++)if(r[i].callback===t&&(!n||n===r[i].context))return void r.splice(i,1)},e.prototype.validateEventType_=function(e){(0,o.hu)(this.allowedEvents_.find((function(t){return t===e})),"Unknown event: "+e)},e}(),at=function(e){function t(){var t=e.call(this,["online"])||this;return t.online_=!0,"undefined"===typeof window||"undefined"===typeof window.addEventListener||(0,o.uI)()||(window.addEventListener("online",(function(){t.online_||(t.online_=!0,t.trigger("online",!0))}),!1),window.addEventListener("offline",(function(){t.online_&&(t.online_=!1,t.trigger("online",!1))}),!1)),t}return(0,s.ZT)(t,e),t.getInstance=function(){return new t},t.prototype.getInitialEvent=function(e){return(0,o.hu)("online"===e,"Unknown event type: "+e),[this.online_]},t.prototype.currentlyOnline=function(){return this.online_},t}(st),ut=32,lt=768,ct=function(){function e(e,t){if(void 0===t){this.pieces_=e.split("/");for(var n=0,r=0;r<this.pieces_.length;r++)this.pieces_[r].length>0&&(this.pieces_[n]=this.pieces_[r],n++);this.pieces_.length=n,this.pieceNum_=0}else this.pieces_=e,this.pieceNum_=t}return e.prototype.toString=function(){for(var e="",t=this.pieceNum_;t<this.pieces_.length;t++)""!==this.pieces_[t]&&(e+="/"+this.pieces_[t]);return e||"/"},e}();
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ht(){return new ct("")}function dt(e){return e.pieceNum_>=e.pieces_.length?null:e.pieces_[e.pieceNum_]}function pt(e){return e.pieces_.length-e.pieceNum_}function ft(e){var t=e.pieceNum_;return t<e.pieces_.length&&t++,new ct(e.pieces_,t)}function _t(e){return e.pieceNum_<e.pieces_.length?e.pieces_[e.pieces_.length-1]:null}function vt(e){for(var t="",n=e.pieceNum_;n<e.pieces_.length;n++)""!==e.pieces_[n]&&(t+="/"+encodeURIComponent(String(e.pieces_[n])));return t||"/"}function yt(e,t){return void 0===t&&(t=0),e.pieces_.slice(e.pieceNum_+t)}function mt(e){if(e.pieceNum_>=e.pieces_.length)return null;for(var t=[],n=e.pieceNum_;n<e.pieces_.length-1;n++)t.push(e.pieces_[n]);return new ct(t,0)}function gt(e,t){for(var n=[],r=e.pieceNum_;r<e.pieces_.length;r++)n.push(e.pieces_[r]);if(t instanceof ct)for(r=t.pieceNum_;r<t.pieces_.length;r++)n.push(t.pieces_[r]);else{var i=t.split("/");for(r=0;r<i.length;r++)i[r].length>0&&n.push(i[r])}return new ct(n,0)}function wt(e){return e.pieceNum_>=e.pieces_.length}function Ct(e,t){var n=dt(e),r=dt(t);if(null===n)return t;if(n===r)return Ct(ft(e),ft(t));throw new Error("INTERNAL ERROR: innerPath ("+t+") is not within outerPath ("+e+")")}function bt(e,t){for(var n=yt(e,0),r=yt(t,0),i=0;i<n.length&&i<r.length;i++){var o=A(n[i],r[i]);if(0!==o)return o}return n.length===r.length?0:n.length<r.length?-1:1}function kt(e,t){if(pt(e)!==pt(t))return!1;for(var n=e.pieceNum_,r=t.pieceNum_;n<=e.pieces_.length;n++,r++)if(e.pieces_[n]!==t.pieces_[r])return!1;return!0}function Tt(e,t){var n=e.pieceNum_,r=t.pieceNum_;if(pt(e)>pt(t))return!1;while(n<e.pieces_.length){if(e.pieces_[n]!==t.pieces_[r])return!1;++n,++r}return!0}var It=function(){function e(e,t){this.errorPrefix_=t,this.parts_=yt(e,0),this.byteLength_=Math.max(1,this.parts_.length);for(var n=0;n<this.parts_.length;n++)this.byteLength_+=(0,o.ug)(this.parts_[n]);Pt(this)}return e}();function xt(e,t){e.parts_.length>0&&(e.byteLength_+=1),e.parts_.push(t),e.byteLength_+=(0,o.ug)(t),Pt(e)}function St(e){var t=e.parts_.pop();e.byteLength_-=(0,o.ug)(t),e.parts_.length>0&&(e.byteLength_-=1)}function Pt(e){if(e.byteLength_>lt)throw new Error(e.errorPrefix_+"has a key path longer than "+lt+" bytes ("+e.byteLength_+").");if(e.parts_.length>ut)throw new Error(e.errorPrefix_+"path specified exceeds the maximum depth that can be written ("+ut+") or object contains a cycle "+Et(e))}function Et(e){return 0===e.parts_.length?"":"in property '"+e.parts_.join(".")+"'"}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Dt,Rt,Nt=function(e){function t(){var t,n,r=e.call(this,["visible"])||this;return"undefined"!==typeof document&&"undefined"!==typeof document.addEventListener&&("undefined"!==typeof document["hidden"]?(n="visibilitychange",t="hidden"):"undefined"!==typeof document["mozHidden"]?(n="mozvisibilitychange",t="mozHidden"):"undefined"!==typeof document["msHidden"]?(n="msvisibilitychange",t="msHidden"):"undefined"!==typeof document["webkitHidden"]&&(n="webkitvisibilitychange",t="webkitHidden")),r.visible_=!0,n&&document.addEventListener(n,(function(){var e=!document[t];e!==r.visible_&&(r.visible_=e,r.trigger("visible",e))}),!1),r}return(0,s.ZT)(t,e),t.getInstance=function(){return new t},t.prototype.getInitialEvent=function(e){return(0,o.hu)("visible"===e,"Unknown event type: "+e),[this.visible_]},t}(st),Ut=1e3,At=3e5,Ot=3e3,Mt=3e4,Lt=1.3,qt=3e4,Ft="server_kill",Wt=3,Ht=function(e){function t(n,r,i,s,a,u,l,c){var h=e.call(this)||this;if(h.repoInfo_=n,h.applicationId_=r,h.onDataUpdate_=i,h.onConnectStatus_=s,h.onServerInfoUpdate_=a,h.authTokenProvider_=u,h.appCheckTokenProvider_=l,h.authOverride_=c,h.id=t.nextPersistentConnectionId_++,h.log_=I("p:"+h.id+":"),h.interruptReasons_={},h.listens=new Map,h.outstandingPuts_=[],h.outstandingGets_=[],h.outstandingPutCount_=0,h.outstandingGetCount_=0,h.onDisconnectRequestQueue_=[],h.connected_=!1,h.reconnectDelay_=Ut,h.maxReconnectDelay_=At,h.securityDebugCallback_=null,h.lastSessionId=null,h.establishConnectionTimer_=null,h.visible_=!1,h.requestCBHash_={},h.requestNumber_=0,h.realtime_=null,h.authToken_=null,h.appCheckToken_=null,h.forceTokenRefresh_=!1,h.invalidAuthTokenCount_=0,h.invalidAppCheckTokenCount_=0,h.firstConnection_=!0,h.lastConnectionAttemptTime_=null,h.lastConnectionEstablishedTime_=null,c&&!(0,o.Yr)())throw new Error("Auth override specified in options, but not supported on non Node.js platforms");return Nt.getInstance().on("visible",h.onVisible_,h),-1===n.host.indexOf("fblocal")&&at.getInstance().on("online",h.onOnline_,h),h}return(0,s.ZT)(t,e),t.prototype.sendRequest=function(e,t,n){var r=++this.requestNumber_,i={r:r,a:e,b:t};this.log_((0,o.Pz)(i)),(0,o.hu)(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(i),n&&(this.requestCBHash_[r]=n)},t.prototype.get=function(e){var t=this;this.initConnection_();var n=new o.BH,r={p:e._path.toString(),q:e._queryObject},i={action:"g",request:r,onComplete:function(e){var i=e["d"];"ok"===e["s"]?(t.onDataUpdate_(r["p"],i,!1,null),n.resolve(i)):n.reject(i)}};this.outstandingGets_.push(i),this.outstandingGetCount_++;var s=this.outstandingGets_.length-1;return this.connected_||setTimeout((function(){var e=t.outstandingGets_[s];void 0!==e&&i===e&&(delete t.outstandingGets_[s],t.outstandingGetCount_--,0===t.outstandingGetCount_&&(t.outstandingGets_=[]),t.log_("get "+s+" timed out on connection"),n.reject(new Error("Client is offline.")))}),Ot),this.connected_&&this.sendGet_(s),n.promise},t.prototype.listen=function(e,t,n,r){this.initConnection_();var i=e._queryIdentifier,s=e._path.toString();this.log_("Listen called for "+s+" "+i),this.listens.has(s)||this.listens.set(s,new Map),(0,o.hu)(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"listen() called for non-default but complete query"),(0,o.hu)(!this.listens.get(s).has(i),"listen() called twice for same path/queryId.");var a={onComplete:r,hashFn:t,query:e,tag:n};this.listens.get(s).set(i,a),this.connected_&&this.sendListen_(a)},t.prototype.sendGet_=function(e){var t=this,n=this.outstandingGets_[e];this.sendRequest("g",n.request,(function(r){delete t.outstandingGets_[e],t.outstandingGetCount_--,0===t.outstandingGetCount_&&(t.outstandingGets_=[]),n.onComplete&&n.onComplete(r)}))},t.prototype.sendListen_=function(e){var n=this,r=e.query,i=r._path.toString(),o=r._queryIdentifier;this.log_("Listen on "+i+" for "+o);var s={p:i},a="q";e.tag&&(s["q"]=r._queryObject,s["t"]=e.tag),s["h"]=e.hashFn(),this.sendRequest(a,s,(function(s){var a=s["d"],u=s["s"];t.warnOnListenWarnings_(a,r);var l=n.listens.get(i)&&n.listens.get(i).get(o);l===e&&(n.log_("listen response",s),"ok"!==u&&n.removeListen_(i,o),e.onComplete&&e.onComplete(u,a))}))},t.warnOnListenWarnings_=function(e,t){if(e&&"object"===typeof e&&(0,o.r3)(e,"w")){var n=(0,o.DV)(e,"w");if(Array.isArray(n)&&~n.indexOf("no_index")){var r='".indexOn": "'+t._queryParams.getIndex().toString()+'"',i=t._path.toString();P("Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding "+r+" at "+i+" to your security rules for better performance.")}}},t.prototype.refreshAuthToken=function(e){this.authToken_=e,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},(function(){})),this.reduceReconnectDelayIfAdminCredential_(e)},t.prototype.reduceReconnectDelayIfAdminCredential_=function(e){var t=e&&40===e.length;(t||(0,o.GJ)(e))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=Mt)},t.prototype.refreshAppCheckToken=function(e){this.appCheckToken_=e,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},(function(){}))},t.prototype.tryAuth=function(){var e=this;if(this.connected_&&this.authToken_){var t=this.authToken_,n=(0,o.w9)(t)?"auth":"gauth",r={cred:t};null===this.authOverride_?r["noauth"]=!0:"object"===typeof this.authOverride_&&(r["authvar"]=this.authOverride_),this.sendRequest(n,r,(function(n){var r=n["s"],i=n["d"]||"error";e.authToken_===t&&("ok"===r?e.invalidAuthTokenCount_=0:e.onAuthRevoked_(r,i))}))}},t.prototype.tryAppCheck=function(){var e=this;this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},(function(t){var n=t["s"],r=t["d"]||"error";"ok"===n?e.invalidAppCheckTokenCount_=0:e.onAppCheckRevoked_(n,r)}))},t.prototype.unlisten=function(e,t){var n=e._path.toString(),r=e._queryIdentifier;this.log_("Unlisten called for "+n+" "+r),(0,o.hu)(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"unlisten() called for non-default but complete query");var i=this.removeListen_(n,r);i&&this.connected_&&this.sendUnlisten_(n,r,e._queryObject,t)},t.prototype.sendUnlisten_=function(e,t,n,r){this.log_("Unlisten on "+e+" for "+t);var i={p:e},o="n";r&&(i["q"]=n,i["t"]=r),this.sendRequest(o,i)},t.prototype.onDisconnectPut=function(e,t,n){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",e,t,n):this.onDisconnectRequestQueue_.push({pathString:e,action:"o",data:t,onComplete:n})},t.prototype.onDisconnectMerge=function(e,t,n){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",e,t,n):this.onDisconnectRequestQueue_.push({pathString:e,action:"om",data:t,onComplete:n})},t.prototype.onDisconnectCancel=function(e,t){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",e,null,t):this.onDisconnectRequestQueue_.push({pathString:e,action:"oc",data:null,onComplete:t})},t.prototype.sendOnDisconnect_=function(e,t,n,r){var i={p:t,d:n};this.log_("onDisconnect "+e,i),this.sendRequest(e,i,(function(e){r&&setTimeout((function(){r(e["s"],e["d"])}),Math.floor(0))}))},t.prototype.put=function(e,t,n,r){this.putInternal("p",e,t,n,r)},t.prototype.merge=function(e,t,n,r){this.putInternal("m",e,t,n,r)},t.prototype.putInternal=function(e,t,n,r,i){this.initConnection_();var o={p:t,d:n};void 0!==i&&(o["h"]=i),this.outstandingPuts_.push({action:e,request:o,onComplete:r}),this.outstandingPutCount_++;var s=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(s):this.log_("Buffering put: "+t)},t.prototype.sendPut_=function(e){var t=this,n=this.outstandingPuts_[e].action,r=this.outstandingPuts_[e].request,i=this.outstandingPuts_[e].onComplete;this.outstandingPuts_[e].queued=this.connected_,this.sendRequest(n,r,(function(r){t.log_(n+" response",r),delete t.outstandingPuts_[e],t.outstandingPutCount_--,0===t.outstandingPutCount_&&(t.outstandingPuts_=[]),i&&i(r["s"],r["d"])}))},t.prototype.reportStats=function(e){var t=this;if(this.connected_){var n={c:e};this.log_("reportStats",n),this.sendRequest("s",n,(function(e){var n=e["s"];if("ok"!==n){var r=e["d"];t.log_("reportStats","Error sending stats: "+r)}}))}},t.prototype.onDataMessage_=function(e){if("r"in e){this.log_("from server: "+(0,o.Pz)(e));var t=e["r"],n=this.requestCBHash_[t];n&&(delete this.requestCBHash_[t],n(e["b"]))}else{if("error"in e)throw"A server-side error has occurred: "+e["error"];"a"in e&&this.onDataPush_(e["a"],e["b"])}},t.prototype.onDataPush_=function(e,t){this.log_("handleServerMessage",e,t),"d"===e?this.onDataUpdate_(t["p"],t["d"],!1,t["t"]):"m"===e?this.onDataUpdate_(t["p"],t["d"],!0,t["t"]):"c"===e?this.onListenRevoked_(t["p"],t["q"]):"ac"===e?this.onAuthRevoked_(t["s"],t["d"]):"apc"===e?this.onAppCheckRevoked_(t["s"],t["d"]):"sd"===e?this.onSecurityDebugPacket_(t):x("Unrecognized action received from server: "+(0,o.Pz)(e)+"\nAre you using the latest client?")},t.prototype.onReady_=function(e,t){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=(new Date).getTime(),this.handleTimestamp_(e),this.lastSessionId=t,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)},t.prototype.scheduleConnect_=function(e){var t=this;(0,o.hu)(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout((function(){t.establishConnectionTimer_=null,t.establishConnection_()}),Math.floor(e))},t.prototype.initConnection_=function(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)},t.prototype.onVisible_=function(e){e&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=Ut,this.realtime_||this.scheduleConnect_(0)),this.visible_=e},t.prototype.onOnline_=function(e){e?(this.log_("Browser went online."),this.reconnectDelay_=Ut,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())},t.prototype.onRealtimeDisconnect_=function(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){if(this.visible_){if(this.lastConnectionEstablishedTime_){var e=(new Date).getTime()-this.lastConnectionEstablishedTime_;e>qt&&(this.reconnectDelay_=Ut),this.lastConnectionEstablishedTime_=null}}else this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=(new Date).getTime();var t=(new Date).getTime()-this.lastConnectionAttemptTime_,n=Math.max(0,this.reconnectDelay_-t);n=Math.random()*n,this.log_("Trying to reconnect in "+n+"ms"),this.scheduleConnect_(n),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,this.reconnectDelay_*Lt)}this.onConnectStatus_(!1)},t.prototype.establishConnection_=function(){return(0,s.mG)(this,void 0,void 0,(function(){var e,n,r,i,a,u,l,c,h,d,p,f,_,v,y=this;return(0,s.Jh)(this,(function(m){switch(m.label){case 0:if(!this.shouldReconnect_())return[3,4];this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=(new Date).getTime(),this.lastConnectionEstablishedTime_=null,e=this.onDataMessage_.bind(this),n=this.onReady_.bind(this),r=this.onRealtimeDisconnect_.bind(this),i=this.id+":"+t.nextConnectionId_++,a=this.lastSessionId,u=!1,l=null,c=function(){l?l.close():(u=!0,r())},h=function(e){(0,o.hu)(l,"sendRequest call when we're not connected not allowed."),l.sendRequest(e)},this.realtime_={close:c,sendRequest:h},d=this.forceTokenRefresh_,this.forceTokenRefresh_=!1,m.label=1;case 1:return m.trys.push([1,3,,4]),[4,Promise.all([this.authTokenProvider_.getToken(d),this.appCheckTokenProvider_.getToken(d)])];case 2:return p=s.CR.apply(void 0,[m.sent(),2]),f=p[0],_=p[1],u?T("getToken() completed but was canceled"):(T("getToken() completed. Creating connection."),this.authToken_=f&&f.accessToken,this.appCheckToken_=_&&_.token,l=new it(i,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,e,n,r,(function(e){P(e+" ("+y.repoInfo_.toString()+")"),y.interrupt(Ft)}),a)),[3,4];case 3:return v=m.sent(),this.log_("Failed to get token: "+v),u||(this.repoInfo_.nodeAdmin&&P(v),c()),[3,4];case 4:return[2]}}))}))},t.prototype.interrupt=function(e){T("Interrupting connection for reason: "+e),this.interruptReasons_[e]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())},t.prototype.resume=function(e){T("Resuming connection for reason: "+e),delete this.interruptReasons_[e],(0,o.xb)(this.interruptReasons_)&&(this.reconnectDelay_=Ut,this.realtime_||this.scheduleConnect_(0))},t.prototype.handleTimestamp_=function(e){var t=e-(new Date).getTime();this.onServerInfoUpdate_({serverTimeOffset:t})},t.prototype.cancelSentTransactions_=function(){for(var e=0;e<this.outstandingPuts_.length;e++){var t=this.outstandingPuts_[e];t&&"h"in t.request&&t.queued&&(t.onComplete&&t.onComplete("disconnect"),delete this.outstandingPuts_[e],this.outstandingPutCount_--)}0===this.outstandingPutCount_&&(this.outstandingPuts_=[])},t.prototype.onListenRevoked_=function(e,t){var n;n=t?t.map((function(e){return L(e)})).join("$"):"default";var r=this.removeListen_(e,n);r&&r.onComplete&&r.onComplete("permission_denied")},t.prototype.removeListen_=function(e,t){var n,r=new ct(e).toString();if(this.listens.has(r)){var i=this.listens.get(r);n=i.get(t),i.delete(t),0===i.size&&this.listens.delete(r)}else n=void 0;return n},t.prototype.onAuthRevoked_=function(e,t){T("Auth token revoked: "+e+"/"+t),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),"invalid_token"!==e&&"permission_denied"!==e||(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=Wt&&(this.reconnectDelay_=Mt,this.authTokenProvider_.notifyForInvalidToken()))},t.prototype.onAppCheckRevoked_=function(e,t){T("App check token revoked: "+e+"/"+t),this.appCheckToken_=null,this.forceTokenRefresh_=!0,"invalid_token"!==e&&"permission_denied"!==e||(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=Wt&&this.appCheckTokenProvider_.notifyForInvalidToken())},t.prototype.onSecurityDebugPacket_=function(e){this.securityDebugCallback_?this.securityDebugCallback_(e):"msg"in e&&console.log("FIREBASE: "+e["msg"].replace("\n","\nFIREBASE: "))},t.prototype.restoreState_=function(){var e,t,n,r;this.tryAuth(),this.tryAppCheck();try{for(var i=(0,s.XA)(this.listens.values()),o=i.next();!o.done;o=i.next()){var a=o.value;try{for(var u=(n=void 0,(0,s.XA)(a.values())),l=u.next();!l.done;l=u.next()){var c=l.value;this.sendListen_(c)}}catch(p){n={error:p}}finally{try{l&&!l.done&&(r=u.return)&&r.call(u)}finally{if(n)throw n.error}}}}catch(f){e={error:f}}finally{try{o&&!o.done&&(t=i.return)&&t.call(i)}finally{if(e)throw e.error}}for(var h=0;h<this.outstandingPuts_.length;h++)this.outstandingPuts_[h]&&this.sendPut_(h);while(this.onDisconnectRequestQueue_.length){var d=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(d.action,d.pathString,d.data,d.onComplete)}for(h=0;h<this.outstandingGets_.length;h++)this.outstandingGets_[h]&&this.sendGet_(h)},t.prototype.sendConnectStats_=function(){var e={},t="js";(0,o.Yr)()&&(t=this.repoInfo_.nodeAdmin?"admin_node":"node"),e["sdk."+t+"."+c.replace(/\./g,"-")]=1,(0,o.uI)()?e["framework.cordova"]=1:(0,o.b$)()&&(e["framework.reactnative"]=1),this.reportStats(e)},t.prototype.shouldReconnect_=function(){var e=at.getInstance().currentlyOnline();return(0,o.xb)(this.interruptReasons_)&&e},t.nextPersistentConnectionId_=0,t.nextConnectionId_=0,t}(ot),jt=function(){function e(e,t){this.name=e,this.node=t}return e.Wrap=function(t,n){return new e(t,n)},e}(),Zt=function(){function e(){}return e.prototype.getCompare=function(){return this.compare.bind(this)},e.prototype.indexedValueChanged=function(e,t){var n=new jt(N,e),r=new jt(N,t);return 0!==this.compare(n,r)},e.prototype.minPost=function(){return jt.MIN},e}(),Bt=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return(0,s.ZT)(t,e),Object.defineProperty(t,"__EMPTY_NODE",{get:function(){return Dt},set:function(e){Dt=e},enumerable:!1,configurable:!0}),t.prototype.compare=function(e,t){return A(e.name,t.name)},t.prototype.isDefinedOn=function(e){throw(0,o.g5)("KeyIndex.isDefinedOn not expected to be called.")},t.prototype.indexedValueChanged=function(e,t){return!1},t.prototype.minPost=function(){return jt.MIN},t.prototype.maxPost=function(){return new jt(U,Dt)},t.prototype.makePost=function(e,t){return(0,o.hu)("string"===typeof e,"KeyIndex indexValue must always be a string."),new jt(e,Dt)},t.prototype.toString=function(){return".key"},t}(Zt),zt=new Bt,Yt=function(){function e(e,t,n,r,i){void 0===i&&(i=null),this.isReverse_=r,this.resultGenerator_=i,this.nodeStack_=[];var o=1;while(!e.isEmpty())if(o=t?n(e.key,t):1,r&&(o*=-1),o<0)e=this.isReverse_?e.left:e.right;else{if(0===o){this.nodeStack_.push(e);break}this.nodeStack_.push(e),e=this.isReverse_?e.right:e.left}}return e.prototype.getNext=function(){if(0===this.nodeStack_.length)return null;var e,t=this.nodeStack_.pop();if(e=this.resultGenerator_?this.resultGenerator_(t.key,t.value):{key:t.key,value:t.value},this.isReverse_){t=t.left;while(!t.isEmpty())this.nodeStack_.push(t),t=t.right}else{t=t.right;while(!t.isEmpty())this.nodeStack_.push(t),t=t.left}return e},e.prototype.hasNext=function(){return this.nodeStack_.length>0},e.prototype.peek=function(){if(0===this.nodeStack_.length)return null;var e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}},e}(),Vt=function(){function e(t,n,r,i,o){this.key=t,this.value=n,this.color=null!=r?r:e.RED,this.left=null!=i?i:$t.EMPTY_NODE,this.right=null!=o?o:$t.EMPTY_NODE}return e.prototype.copy=function(t,n,r,i,o){return new e(null!=t?t:this.key,null!=n?n:this.value,null!=r?r:this.color,null!=i?i:this.left,null!=o?o:this.right)},e.prototype.count=function(){return this.left.count()+1+this.right.count()},e.prototype.isEmpty=function(){return!1},e.prototype.inorderTraversal=function(e){return this.left.inorderTraversal(e)||!!e(this.key,this.value)||this.right.inorderTraversal(e)},e.prototype.reverseTraversal=function(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)},e.prototype.min_=function(){return this.left.isEmpty()?this:this.left.min_()},e.prototype.minKey=function(){return this.min_().key},e.prototype.maxKey=function(){return this.right.isEmpty()?this.key:this.right.maxKey()},e.prototype.insert=function(e,t,n){var r=this,i=n(e,r.key);return r=i<0?r.copy(null,null,null,r.left.insert(e,t,n),null):0===i?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,n)),r.fixUp_()},e.prototype.removeMin_=function(){if(this.left.isEmpty())return $t.EMPTY_NODE;var e=this;return e.left.isRed_()||e.left.left.isRed_()||(e=e.moveRedLeft_()),e=e.copy(null,null,null,e.left.removeMin_(),null),e.fixUp_()},e.prototype.remove=function(e,t){var n,r;if(n=this,t(e,n.key)<0)n.left.isEmpty()||n.left.isRed_()||n.left.left.isRed_()||(n=n.moveRedLeft_()),n=n.copy(null,null,null,n.left.remove(e,t),null);else{if(n.left.isRed_()&&(n=n.rotateRight_()),n.right.isEmpty()||n.right.isRed_()||n.right.left.isRed_()||(n=n.moveRedRight_()),0===t(e,n.key)){if(n.right.isEmpty())return $t.EMPTY_NODE;r=n.right.min_(),n=n.copy(r.key,r.value,null,null,n.right.removeMin_())}n=n.copy(null,null,null,null,n.right.remove(e,t))}return n.fixUp_()},e.prototype.isRed_=function(){return this.color},e.prototype.fixUp_=function(){var e=this;return e.right.isRed_()&&!e.left.isRed_()&&(e=e.rotateLeft_()),e.left.isRed_()&&e.left.left.isRed_()&&(e=e.rotateRight_()),e.left.isRed_()&&e.right.isRed_()&&(e=e.colorFlip_()),e},e.prototype.moveRedLeft_=function(){var e=this.colorFlip_();return e.right.left.isRed_()&&(e=e.copy(null,null,null,null,e.right.rotateRight_()),e=e.rotateLeft_(),e=e.colorFlip_()),e},e.prototype.moveRedRight_=function(){var e=this.colorFlip_();return e.left.left.isRed_()&&(e=e.rotateRight_(),e=e.colorFlip_()),e},e.prototype.rotateLeft_=function(){var t=this.copy(null,null,e.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)},e.prototype.rotateRight_=function(){var t=this.copy(null,null,e.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)},e.prototype.colorFlip_=function(){var e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)},e.prototype.checkMaxDepth_=function(){var e=this.check_();return Math.pow(2,e)<=this.count()+1},e.prototype.check_=function(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");var e=this.left.check_();if(e!==this.right.check_())throw new Error("Black depths differ");return e+(this.isRed_()?0:1)},e.RED=!0,e.BLACK=!1,e}(),Gt=function(){function e(){}return e.prototype.copy=function(e,t,n,r,i){return this},e.prototype.insert=function(e,t,n){return new Vt(e,t,null)},e.prototype.remove=function(e,t){return this},e.prototype.count=function(){return 0},e.prototype.isEmpty=function(){return!0},e.prototype.inorderTraversal=function(e){return!1},e.prototype.reverseTraversal=function(e){return!1},e.prototype.minKey=function(){return null},e.prototype.maxKey=function(){return null},e.prototype.check_=function(){return 0},e.prototype.isRed_=function(){return!1},e}(),$t=function(){function e(t,n){void 0===n&&(n=e.EMPTY_NODE),this.comparator_=t,this.root_=n}return e.prototype.insert=function(t,n){return new e(this.comparator_,this.root_.insert(t,n,this.comparator_).copy(null,null,Vt.BLACK,null,null))},e.prototype.remove=function(t){return new e(this.comparator_,this.root_.remove(t,this.comparator_).copy(null,null,Vt.BLACK,null,null))},e.prototype.get=function(e){var t,n=this.root_;while(!n.isEmpty()){if(t=this.comparator_(e,n.key),0===t)return n.value;t<0?n=n.left:t>0&&(n=n.right)}return null},e.prototype.getPredecessorKey=function(e){var t,n=this.root_,r=null;while(!n.isEmpty()){if(t=this.comparator_(e,n.key),0===t){if(n.left.isEmpty())return r?r.key:null;n=n.left;while(!n.right.isEmpty())n=n.right;return n.key}t<0?n=n.left:t>0&&(r=n,n=n.right)}throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")},e.prototype.isEmpty=function(){return this.root_.isEmpty()},e.prototype.count=function(){return this.root_.count()},e.prototype.minKey=function(){return this.root_.minKey()},e.prototype.maxKey=function(){return this.root_.maxKey()},e.prototype.inorderTraversal=function(e){return this.root_.inorderTraversal(e)},e.prototype.reverseTraversal=function(e){return this.root_.reverseTraversal(e)},e.prototype.getIterator=function(e){return new Yt(this.root_,null,this.comparator_,!1,e)},e.prototype.getIteratorFrom=function(e,t){return new Yt(this.root_,e,this.comparator_,!1,t)},e.prototype.getReverseIteratorFrom=function(e,t){return new Yt(this.root_,e,this.comparator_,!0,t)},e.prototype.getReverseIterator=function(e){return new Yt(this.root_,null,this.comparator_,!0,e)},e.EMPTY_NODE=new Gt,e}();
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function Qt(e,t){return A(e.name,t.name)}function Kt(e,t){return A(e,t)}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Jt(e){Rt=e}var Xt,en,tn,nn=function(e){return"number"===typeof e?"number:"+W(e):"string:"+e},rn=function(e){if(e.isLeafNode()){var t=e.val();(0,o.hu)("string"===typeof t||"number"===typeof t||"object"===typeof t&&(0,o.r3)(t,".sv"),"Priority must be a string or number.")}else(0,o.hu)(e===Rt||e.isEmpty(),"priority of unexpected type.");(0,o.hu)(e===Rt||e.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")},on=function(){function e(t,n){void 0===n&&(n=e.__childrenNodeConstructor.EMPTY_NODE),this.value_=t,this.priorityNode_=n,this.lazyHash_=null,(0,o.hu)(void 0!==this.value_&&null!==this.value_,"LeafNode shouldn't be created with null/undefined value."),rn(this.priorityNode_)}return Object.defineProperty(e,"__childrenNodeConstructor",{get:function(){return Xt},set:function(e){Xt=e},enumerable:!1,configurable:!0}),e.prototype.isLeafNode=function(){return!0},e.prototype.getPriority=function(){return this.priorityNode_},e.prototype.updatePriority=function(t){return new e(this.value_,t)},e.prototype.getImmediateChild=function(t){return".priority"===t?this.priorityNode_:e.__childrenNodeConstructor.EMPTY_NODE},e.prototype.getChild=function(t){return wt(t)?this:".priority"===dt(t)?this.priorityNode_:e.__childrenNodeConstructor.EMPTY_NODE},e.prototype.hasChild=function(){return!1},e.prototype.getPredecessorChildName=function(e,t){return null},e.prototype.updateImmediateChild=function(t,n){return".priority"===t?this.updatePriority(n):n.isEmpty()&&".priority"!==t?this:e.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(t,n).updatePriority(this.priorityNode_)},e.prototype.updateChild=function(t,n){var r=dt(t);return null===r?n:n.isEmpty()&&".priority"!==r?this:((0,o.hu)(".priority"!==r||1===pt(t),".priority must be the last token in a path"),this.updateImmediateChild(r,e.__childrenNodeConstructor.EMPTY_NODE.updateChild(ft(t),n)))},e.prototype.isEmpty=function(){return!1},e.prototype.numChildren=function(){return 0},e.prototype.forEachChild=function(e,t){return!1},e.prototype.val=function(e){return e&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()},e.prototype.hash=function(){if(null===this.lazyHash_){var e="";this.priorityNode_.isEmpty()||(e+="priority:"+nn(this.priorityNode_.val())+":");var t=typeof this.value_;e+=t+":",e+="number"===t?W(this.value_):this.value_,this.lazyHash_=g(e)}return this.lazyHash_},e.prototype.getValue=function(){return this.value_},e.prototype.compareTo=function(t){return t===e.__childrenNodeConstructor.EMPTY_NODE?1:t instanceof e.__childrenNodeConstructor?-1:((0,o.hu)(t.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(t))},e.prototype.compareToLeafNode_=function(t){var n=typeof t.value_,r=typeof this.value_,i=e.VALUE_TYPE_ORDER.indexOf(n),s=e.VALUE_TYPE_ORDER.indexOf(r);return(0,o.hu)(i>=0,"Unknown leaf type: "+n),(0,o.hu)(s>=0,"Unknown leaf type: "+r),i===s?"object"===r?0:this.value_<t.value_?-1:this.value_===t.value_?0:1:s-i},e.prototype.withIndex=function(){return this},e.prototype.isIndexed=function(){return!0},e.prototype.equals=function(e){if(e===this)return!0;if(e.isLeafNode()){var t=e;return this.value_===t.value_&&this.priorityNode_.equals(t.priorityNode_)}return!1},e.VALUE_TYPE_ORDER=["object","boolean","number","string"],e}();function sn(e){en=e}function an(e){tn=e}var un,ln,cn=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return(0,s.ZT)(t,e),t.prototype.compare=function(e,t){var n=e.node.getPriority(),r=t.node.getPriority(),i=n.compareTo(r);return 0===i?A(e.name,t.name):i},t.prototype.isDefinedOn=function(e){return!e.getPriority().isEmpty()},t.prototype.indexedValueChanged=function(e,t){return!e.getPriority().equals(t.getPriority())},t.prototype.minPost=function(){return jt.MIN},t.prototype.maxPost=function(){return new jt(U,new on("[PRIORITY-POST]",tn))},t.prototype.makePost=function(e,t){var n=en(e);return new jt(t,new on("[PRIORITY-POST]",n))},t.prototype.toString=function(){return".priority"},t}(Zt),hn=new cn,dn=Math.log(2),pn=function(){function e(e){var t=function(e){return parseInt(Math.log(e)/dn,10)},n=function(e){return parseInt(Array(e+1).join("1"),2)};this.count=t(e+1),this.current_=this.count-1;var r=n(this.count);this.bits_=e+1&r}return e.prototype.nextBitIsOne=function(){var e=!(this.bits_&1<<this.current_);return this.current_--,e},e}(),fn=function(e,t,n,r){e.sort(t);var i=function(t,r){var o,s,a=r-t;if(0===a)return null;if(1===a)return o=e[t],s=n?n(o):o,new Vt(s,o.node,Vt.BLACK,null,null);var u=parseInt(a/2,10)+t,l=i(t,u),c=i(u+1,r);return o=e[u],s=n?n(o):o,new Vt(s,o.node,Vt.BLACK,l,c)},o=function(t){for(var r=null,o=null,s=e.length,a=function(t,r){var o=s-t,a=s;s-=t;var l=i(o+1,a),c=e[o],h=n?n(c):c;u(new Vt(h,c.node,r,null,l))},u=function(e){r?(r.left=e,r=e):(o=e,r=e)},l=0;l<t.count;++l){var c=t.nextBitIsOne(),h=Math.pow(2,t.count-(l+1));c?a(h,Vt.BLACK):(a(h,Vt.BLACK),a(h,Vt.RED))}return o},s=new pn(e.length),a=o(s);return new $t(r||t,a)},_n={},vn=function(){function e(e,t){this.indexes_=e,this.indexSet_=t}return Object.defineProperty(e,"Default",{get:function(){return(0,o.hu)(_n&&hn,"ChildrenNode.ts has not been loaded"),un=un||new e({".priority":_n},{".priority":hn}),un},enumerable:!1,configurable:!0}),e.prototype.get=function(e){var t=(0,o.DV)(this.indexes_,e);if(!t)throw new Error("No index defined for "+e);return t instanceof $t?t:null},e.prototype.hasIndex=function(e){return(0,o.r3)(this.indexSet_,e.toString())},e.prototype.addIndex=function(t,n){(0,o.hu)(t!==zt,"KeyIndex always exists and isn't meant to be added to the IndexMap.");var r,i=[],a=!1,u=n.getIterator(jt.Wrap),l=u.getNext();while(l)a=a||t.isDefinedOn(l.node),i.push(l),l=u.getNext();r=a?fn(i,t.getCompare()):_n;var c=t.toString(),h=(0,s.pi)({},this.indexSet_);h[c]=t;var d=(0,s.pi)({},this.indexes_);return d[c]=r,new e(d,h)},e.prototype.addToIndexes=function(t,n){var r=this,i=(0,o.UI)(this.indexes_,(function(e,i){var s=(0,o.DV)(r.indexSet_,i);if((0,o.hu)(s,"Missing index implementation for "+i),e===_n){if(s.isDefinedOn(t.node)){var a=[],u=n.getIterator(jt.Wrap),l=u.getNext();while(l)l.name!==t.name&&a.push(l),l=u.getNext();return a.push(t),fn(a,s.getCompare())}return _n}var c=n.get(t.name),h=e;return c&&(h=h.remove(new jt(t.name,c))),h.insert(t,t.node)}));return new e(i,this.indexSet_)},e.prototype.removeFromIndexes=function(t,n){var r=(0,o.UI)(this.indexes_,(function(e){if(e===_n)return e;var r=n.get(t.name);return r?e.remove(new jt(t.name,r)):e}));return new e(r,this.indexSet_)},e}(),yn=function(){function e(e,t,n){this.children_=e,this.priorityNode_=t,this.indexMap_=n,this.lazyHash_=null,this.priorityNode_&&rn(this.priorityNode_),this.children_.isEmpty()&&(0,o.hu)(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}return Object.defineProperty(e,"EMPTY_NODE",{get:function(){return ln||(ln=new e(new $t(Kt),null,vn.Default))},enumerable:!1,configurable:!0}),e.prototype.isLeafNode=function(){return!1},e.prototype.getPriority=function(){return this.priorityNode_||ln},e.prototype.updatePriority=function(t){return this.children_.isEmpty()?this:new e(this.children_,t,this.indexMap_)},e.prototype.getImmediateChild=function(e){if(".priority"===e)return this.getPriority();var t=this.children_.get(e);return null===t?ln:t},e.prototype.getChild=function(e){var t=dt(e);return null===t?this:this.getImmediateChild(t).getChild(ft(e))},e.prototype.hasChild=function(e){return null!==this.children_.get(e)},e.prototype.updateImmediateChild=function(t,n){if((0,o.hu)(n,"We should always be passing snapshot nodes"),".priority"===t)return this.updatePriority(n);var r=new jt(t,n),i=void 0,s=void 0;n.isEmpty()?(i=this.children_.remove(t),s=this.indexMap_.removeFromIndexes(r,this.children_)):(i=this.children_.insert(t,n),s=this.indexMap_.addToIndexes(r,this.children_));var a=i.isEmpty()?ln:this.priorityNode_;return new e(i,a,s)},e.prototype.updateChild=function(e,t){var n=dt(e);if(null===n)return t;(0,o.hu)(".priority"!==dt(e)||1===pt(e),".priority must be the last token in a path");var r=this.getImmediateChild(n).updateChild(ft(e),t);return this.updateImmediateChild(n,r)},e.prototype.isEmpty=function(){return this.children_.isEmpty()},e.prototype.numChildren=function(){return this.children_.count()},e.prototype.val=function(t){if(this.isEmpty())return null;var n={},r=0,i=0,o=!0;if(this.forEachChild(hn,(function(s,a){n[s]=a.val(t),r++,o&&e.INTEGER_REGEXP_.test(s)?i=Math.max(i,Number(s)):o=!1})),!t&&o&&i<2*r){var s=[];for(var a in n)s[a]=n[a];return s}return t&&!this.getPriority().isEmpty()&&(n[".priority"]=this.getPriority().val()),n},e.prototype.hash=function(){if(null===this.lazyHash_){var e="";this.getPriority().isEmpty()||(e+="priority:"+nn(this.getPriority().val())+":"),this.forEachChild(hn,(function(t,n){var r=n.hash();""!==r&&(e+=":"+t+":"+r)})),this.lazyHash_=""===e?"":g(e)}return this.lazyHash_},e.prototype.getPredecessorChildName=function(e,t,n){var r=this.resolveIndex_(n);if(r){var i=r.getPredecessorKey(new jt(e,t));return i?i.name:null}return this.children_.getPredecessorKey(e)},e.prototype.getFirstChildName=function(e){var t=this.resolveIndex_(e);if(t){var n=t.minKey();return n&&n.name}return this.children_.minKey()},e.prototype.getFirstChild=function(e){var t=this.getFirstChildName(e);return t?new jt(t,this.children_.get(t)):null},e.prototype.getLastChildName=function(e){var t=this.resolveIndex_(e);if(t){var n=t.maxKey();return n&&n.name}return this.children_.maxKey()},e.prototype.getLastChild=function(e){var t=this.getLastChildName(e);return t?new jt(t,this.children_.get(t)):null},e.prototype.forEachChild=function(e,t){var n=this.resolveIndex_(e);return n?n.inorderTraversal((function(e){return t(e.name,e.node)})):this.children_.inorderTraversal(t)},e.prototype.getIterator=function(e){return this.getIteratorFrom(e.minPost(),e)},e.prototype.getIteratorFrom=function(e,t){var n=this.resolveIndex_(t);if(n)return n.getIteratorFrom(e,(function(e){return e}));var r=this.children_.getIteratorFrom(e.name,jt.Wrap),i=r.peek();while(null!=i&&t.compare(i,e)<0)r.getNext(),i=r.peek();return r},e.prototype.getReverseIterator=function(e){return this.getReverseIteratorFrom(e.maxPost(),e)},e.prototype.getReverseIteratorFrom=function(e,t){var n=this.resolveIndex_(t);if(n)return n.getReverseIteratorFrom(e,(function(e){return e}));var r=this.children_.getReverseIteratorFrom(e.name,jt.Wrap),i=r.peek();while(null!=i&&t.compare(i,e)>0)r.getNext(),i=r.peek();return r},e.prototype.compareTo=function(e){return this.isEmpty()?e.isEmpty()?0:-1:e.isLeafNode()||e.isEmpty()?1:e===gn?-1:0},e.prototype.withIndex=function(t){if(t===zt||this.indexMap_.hasIndex(t))return this;var n=this.indexMap_.addIndex(t,this.children_);return new e(this.children_,this.priorityNode_,n)},e.prototype.isIndexed=function(e){return e===zt||this.indexMap_.hasIndex(e)},e.prototype.equals=function(e){if(e===this)return!0;if(e.isLeafNode())return!1;var t=e;if(this.getPriority().equals(t.getPriority())){if(this.children_.count()===t.children_.count()){var n=this.getIterator(hn),r=t.getIterator(hn),i=n.getNext(),o=r.getNext();while(i&&o){if(i.name!==o.name||!i.node.equals(o.node))return!1;i=n.getNext(),o=r.getNext()}return null===i&&null===o}return!1}return!1},e.prototype.resolveIndex_=function(e){return e===zt?null:this.indexMap_.get(e.toString())},e.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/,e}(),mn=function(e){function t(){return e.call(this,new $t(Kt),yn.EMPTY_NODE,vn.Default)||this}return(0,s.ZT)(t,e),t.prototype.compareTo=function(e){return e===this?0:1},t.prototype.equals=function(e){return e===this},t.prototype.getPriority=function(){return this},t.prototype.getImmediateChild=function(e){return yn.EMPTY_NODE},t.prototype.isEmpty=function(){return!1},t}(yn),gn=new mn;Object.defineProperties(jt,{MIN:{value:new jt(N,yn.EMPTY_NODE)},MAX:{value:new jt(U,gn)}}),Bt.__EMPTY_NODE=yn.EMPTY_NODE,on.__childrenNodeConstructor=yn,Jt(gn),an(gn);
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var wn=!0;function Cn(e,t){if(void 0===t&&(t=null),null===e)return yn.EMPTY_NODE;if("object"===typeof e&&".priority"in e&&(t=e[".priority"]),(0,o.hu)(null===t||"string"===typeof t||"number"===typeof t||"object"===typeof t&&".sv"in t,"Invalid priority type found: "+typeof t),"object"===typeof e&&".value"in e&&null!==e[".value"]&&(e=e[".value"]),"object"!==typeof e||".sv"in e){var n=e;return new on(n,Cn(t))}if(e instanceof Array||!wn){var r=yn.EMPTY_NODE;return F(e,(function(t,n){if((0,o.r3)(e,t)&&"."!==t.substring(0,1)){var i=Cn(n);!i.isLeafNode()&&i.isEmpty()||(r=r.updateImmediateChild(t,i))}})),r.updatePriority(Cn(t))}var i=[],s=!1,a=e;if(F(a,(function(e,t){if("."!==e.substring(0,1)){var n=Cn(t);n.isEmpty()||(s=s||!n.getPriority().isEmpty(),i.push(new jt(e,n)))}})),0===i.length)return yn.EMPTY_NODE;var u=fn(i,Qt,(function(e){return e.name}),Kt);if(s){var l=fn(i,hn.getCompare());return new yn(u,Cn(t),new vn({".priority":l},{".priority":hn}))}return new yn(u,Cn(t),vn.Default)}sn(Cn);
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var bn=function(e){function t(t){var n=e.call(this)||this;return n.indexPath_=t,(0,o.hu)(!wt(t)&&".priority"!==dt(t),"Can't create PathIndex with empty path or .priority key"),n}return(0,s.ZT)(t,e),t.prototype.extractChild=function(e){return e.getChild(this.indexPath_)},t.prototype.isDefinedOn=function(e){return!e.getChild(this.indexPath_).isEmpty()},t.prototype.compare=function(e,t){var n=this.extractChild(e.node),r=this.extractChild(t.node),i=n.compareTo(r);return 0===i?A(e.name,t.name):i},t.prototype.makePost=function(e,t){var n=Cn(e),r=yn.EMPTY_NODE.updateChild(this.indexPath_,n);return new jt(t,r)},t.prototype.maxPost=function(){var e=yn.EMPTY_NODE.updateChild(this.indexPath_,gn);return new jt(U,e)},t.prototype.toString=function(){return yt(this.indexPath_,0).join("/")},t}(Zt),kn=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return(0,s.ZT)(t,e),t.prototype.compare=function(e,t){var n=e.node.compareTo(t.node);return 0===n?A(e.name,t.name):n},t.prototype.isDefinedOn=function(e){return!0},t.prototype.indexedValueChanged=function(e,t){return!e.equals(t)},t.prototype.minPost=function(){return jt.MIN},t.prototype.maxPost=function(){return jt.MAX},t.prototype.makePost=function(e,t){var n=Cn(e);return new jt(t,n)},t.prototype.toString=function(){return".value"},t}(Zt),Tn=new kn,In="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz",xn="-",Sn="z",Pn=786,En=function(){var e=0,t=[];return function(n){var r,i=n===e;e=n;var s=new Array(8);for(r=7;r>=0;r--)s[r]=In.charAt(n%64),n=Math.floor(n/64);(0,o.hu)(0===n,"Cannot push at time == 0");var a=s.join("");if(i){for(r=11;r>=0&&63===t[r];r--)t[r]=0;t[r]++}else for(r=0;r<12;r++)t[r]=Math.floor(64*Math.random());for(r=0;r<12;r++)a+=In.charAt(t[r]);return(0,o.hu)(20===a.length,"nextPushId: Length should be 20."),a}}(),Dn=function(e){if(e===""+Y)return xn;var t=V(e);if(null!=t)return""+(t+1);for(var n=new Array(e.length),r=0;r<n.length;r++)n[r]=e.charAt(r);if(n.length<Pn)return n.push(xn),n.join("");var i=n.length-1;while(i>=0&&n[i]===Sn)i--;if(-1===i)return U;var o=n[i],s=In.charAt(In.indexOf(o)+1);return n[i]=s,n.slice(0,i+1).join("")},Rn=function(e){if(e===""+z)return N;var t=V(e);if(null!=t)return""+(t-1);for(var n=new Array(e.length),r=0;r<n.length;r++)n[r]=e.charAt(r);return n[n.length-1]===xn?1===n.length?""+Y:(delete n[n.length-1],n.join("")):(n[n.length-1]=In.charAt(In.indexOf(n[n.length-1])-1),n.join("")+Sn.repeat(Pn-n.length))};
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function Nn(e){return{type:"value",snapshotNode:e}}function Un(e,t){return{type:"child_added",snapshotNode:t,childName:e}}function An(e,t){return{type:"child_removed",snapshotNode:t,childName:e}}function On(e,t,n){return{type:"child_changed",snapshotNode:t,childName:e,oldSnap:n}}function Mn(e,t){return{type:"child_moved",snapshotNode:t,childName:e}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Ln=function(){function e(e){this.index_=e}return e.prototype.updateChild=function(e,t,n,r,i,s){(0,o.hu)(e.isIndexed(this.index_),"A node must be indexed if only a child is updated");var a=e.getImmediateChild(t);return a.getChild(r).equals(n.getChild(r))&&a.isEmpty()===n.isEmpty()?e:(null!=s&&(n.isEmpty()?e.hasChild(t)?s.trackChildChange(An(t,a)):(0,o.hu)(e.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):a.isEmpty()?s.trackChildChange(Un(t,n)):s.trackChildChange(On(t,n,a))),e.isLeafNode()&&n.isEmpty()?e:e.updateImmediateChild(t,n).withIndex(this.index_))},e.prototype.updateFullNode=function(e,t,n){return null!=n&&(e.isLeafNode()||e.forEachChild(hn,(function(e,r){t.hasChild(e)||n.trackChildChange(An(e,r))})),t.isLeafNode()||t.forEachChild(hn,(function(t,r){if(e.hasChild(t)){var i=e.getImmediateChild(t);i.equals(r)||n.trackChildChange(On(t,r,i))}else n.trackChildChange(Un(t,r))}))),t.withIndex(this.index_)},e.prototype.updatePriority=function(e,t){return e.isEmpty()?yn.EMPTY_NODE:e.updatePriority(t)},e.prototype.filtersNodes=function(){return!1},e.prototype.getIndexedFilter=function(){return this},e.prototype.getIndex=function(){return this.index_},e}(),qn=function(){function e(t){this.indexedFilter_=new Ln(t.getIndex()),this.index_=t.getIndex(),this.startPost_=e.getStartPost_(t),this.endPost_=e.getEndPost_(t)}return e.prototype.getStartPost=function(){return this.startPost_},e.prototype.getEndPost=function(){return this.endPost_},e.prototype.matches=function(e){return this.index_.compare(this.getStartPost(),e)<=0&&this.index_.compare(e,this.getEndPost())<=0},e.prototype.updateChild=function(e,t,n,r,i,o){return this.matches(new jt(t,n))||(n=yn.EMPTY_NODE),this.indexedFilter_.updateChild(e,t,n,r,i,o)},e.prototype.updateFullNode=function(e,t,n){t.isLeafNode()&&(t=yn.EMPTY_NODE);var r=t.withIndex(this.index_);r=r.updatePriority(yn.EMPTY_NODE);var i=this;return t.forEachChild(hn,(function(e,t){i.matches(new jt(e,t))||(r=r.updateImmediateChild(e,yn.EMPTY_NODE))})),this.indexedFilter_.updateFullNode(e,r,n)},e.prototype.updatePriority=function(e,t){return e},e.prototype.filtersNodes=function(){return!0},e.prototype.getIndexedFilter=function(){return this.indexedFilter_},e.prototype.getIndex=function(){return this.index_},e.getStartPost_=function(e){if(e.hasStart()){var t=e.getIndexStartName();return e.getIndex().makePost(e.getIndexStartValue(),t)}return e.getIndex().minPost()},e.getEndPost_=function(e){if(e.hasEnd()){var t=e.getIndexEndName();return e.getIndex().makePost(e.getIndexEndValue(),t)}return e.getIndex().maxPost()},e}(),Fn=function(){function e(e){this.rangedFilter_=new qn(e),this.index_=e.getIndex(),this.limit_=e.getLimit(),this.reverse_=!e.isViewFromLeft()}return e.prototype.updateChild=function(e,t,n,r,i,o){return this.rangedFilter_.matches(new jt(t,n))||(n=yn.EMPTY_NODE),e.getImmediateChild(t).equals(n)?e:e.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(e,t,n,r,i,o):this.fullLimitUpdateChild_(e,t,n,i,o)},e.prototype.updateFullNode=function(e,t,n){var r;if(t.isLeafNode()||t.isEmpty())r=yn.EMPTY_NODE.withIndex(this.index_);else if(2*this.limit_<t.numChildren()&&t.isIndexed(this.index_)){r=yn.EMPTY_NODE.withIndex(this.index_);var i=void 0;i=this.reverse_?t.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):t.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);var o=0;while(i.hasNext()&&o<this.limit_){var s=i.getNext(),a=void 0;if(a=this.reverse_?this.index_.compare(this.rangedFilter_.getStartPost(),s)<=0:this.index_.compare(s,this.rangedFilter_.getEndPost())<=0,!a)break;r=r.updateImmediateChild(s.name,s.node),o++}}else{r=t.withIndex(this.index_),r=r.updatePriority(yn.EMPTY_NODE);var u=void 0,l=void 0,c=void 0;i=void 0;if(this.reverse_){i=r.getReverseIterator(this.index_),u=this.rangedFilter_.getEndPost(),l=this.rangedFilter_.getStartPost();var h=this.index_.getCompare();c=function(e,t){return h(t,e)}}else i=r.getIterator(this.index_),u=this.rangedFilter_.getStartPost(),l=this.rangedFilter_.getEndPost(),c=this.index_.getCompare();o=0;var d=!1;while(i.hasNext()){s=i.getNext();!d&&c(u,s)<=0&&(d=!0);a=d&&o<this.limit_&&c(s,l)<=0;a?o++:r=r.updateImmediateChild(s.name,yn.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(e,r,n)},e.prototype.updatePriority=function(e,t){return e},e.prototype.filtersNodes=function(){return!0},e.prototype.getIndexedFilter=function(){return this.rangedFilter_.getIndexedFilter()},e.prototype.getIndex=function(){return this.index_},e.prototype.fullLimitUpdateChild_=function(e,t,n,r,i){var s;if(this.reverse_){var a=this.index_.getCompare();s=function(e,t){return a(t,e)}}else s=this.index_.getCompare();var u=e;(0,o.hu)(u.numChildren()===this.limit_,"");var l=new jt(t,n),c=this.reverse_?u.getFirstChild(this.index_):u.getLastChild(this.index_),h=this.rangedFilter_.matches(l);if(u.hasChild(t)){var d=u.getImmediateChild(t),p=r.getChildAfterChild(this.index_,c,this.reverse_);while(null!=p&&(p.name===t||u.hasChild(p.name)))p=r.getChildAfterChild(this.index_,p,this.reverse_);var f=null==p?1:s(p,l),_=h&&!n.isEmpty()&&f>=0;if(_)return null!=i&&i.trackChildChange(On(t,n,d)),u.updateImmediateChild(t,n);null!=i&&i.trackChildChange(An(t,d));var v=u.updateImmediateChild(t,yn.EMPTY_NODE),y=null!=p&&this.rangedFilter_.matches(p);return y?(null!=i&&i.trackChildChange(Un(p.name,p.node)),v.updateImmediateChild(p.name,p.node)):v}return n.isEmpty()?e:h&&s(c,l)>=0?(null!=i&&(i.trackChildChange(An(c.name,c.node)),i.trackChildChange(Un(t,n))),u.updateImmediateChild(t,n).updateImmediateChild(c.name,yn.EMPTY_NODE)):e},e}(),Wn=function(){function e(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=hn}return e.prototype.hasStart=function(){return this.startSet_},e.prototype.hasStartAfter=function(){return this.startAfterSet_},e.prototype.hasEndBefore=function(){return this.endBeforeSet_},e.prototype.isViewFromLeft=function(){return""===this.viewFrom_?this.startSet_:"l"===this.viewFrom_},e.prototype.getIndexStartValue=function(){return(0,o.hu)(this.startSet_,"Only valid if start has been set"),this.indexStartValue_},e.prototype.getIndexStartName=function(){return(0,o.hu)(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:N},e.prototype.hasEnd=function(){return this.endSet_},e.prototype.getIndexEndValue=function(){return(0,o.hu)(this.endSet_,"Only valid if end has been set"),this.indexEndValue_},e.prototype.getIndexEndName=function(){return(0,o.hu)(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:U},e.prototype.hasLimit=function(){return this.limitSet_},e.prototype.hasAnchoredLimit=function(){return this.limitSet_&&""!==this.viewFrom_},e.prototype.getLimit=function(){return(0,o.hu)(this.limitSet_,"Only valid if limit has been set"),this.limit_},e.prototype.getIndex=function(){return this.index_},e.prototype.loadsAllData=function(){return!(this.startSet_||this.endSet_||this.limitSet_)},e.prototype.isDefault=function(){return this.loadsAllData()&&this.index_===hn},e.prototype.copy=function(){var t=new e;return t.limitSet_=this.limitSet_,t.limit_=this.limit_,t.startSet_=this.startSet_,t.indexStartValue_=this.indexStartValue_,t.startNameSet_=this.startNameSet_,t.indexStartName_=this.indexStartName_,t.endSet_=this.endSet_,t.indexEndValue_=this.indexEndValue_,t.endNameSet_=this.endNameSet_,t.indexEndName_=this.indexEndName_,t.index_=this.index_,t.viewFrom_=this.viewFrom_,t},e}();
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Hn(e){return e.loadsAllData()?new Ln(e.getIndex()):e.hasLimit()?new Fn(e):new qn(e)}function jn(e,t){var n=e.copy();return n.limitSet_=!0,n.limit_=t,n.viewFrom_="l",n}function Zn(e,t){var n=e.copy();return n.limitSet_=!0,n.limit_=t,n.viewFrom_="r",n}function Bn(e,t,n){var r=e.copy();return r.startSet_=!0,void 0===t&&(t=null),r.indexStartValue_=t,null!=n?(r.startNameSet_=!0,r.indexStartName_=n):(r.startNameSet_=!1,r.indexStartName_=""),r}function zn(e,t,n){var r;if(e.index_===zt)"string"===typeof t&&(t=Dn(t)),r=Bn(e,t,n);else{var i=void 0;i=null==n?U:Dn(n),r=Bn(e,t,i)}return r.startAfterSet_=!0,r}function Yn(e,t,n){var r=e.copy();return r.endSet_=!0,void 0===t&&(t=null),r.indexEndValue_=t,void 0!==n?(r.endNameSet_=!0,r.indexEndName_=n):(r.endNameSet_=!1,r.indexEndName_=""),r}function Vn(e,t,n){var r,i;return e.index_===zt?("string"===typeof t&&(t=Rn(t)),i=Yn(e,t,n)):(r=null==n?N:Rn(n),i=Yn(e,t,r)),i.endBeforeSet_=!0,i}function Gn(e,t){var n=e.copy();return n.index_=t,n}function $n(e){var t,n={};return e.isDefault()||(e.index_===hn?t="$priority":e.index_===Tn?t="$value":e.index_===zt?t="$key":((0,o.hu)(e.index_ instanceof bn,"Unrecognized index type!"),t=e.index_.toString()),n["orderBy"]=(0,o.Pz)(t),e.startSet_&&(n["startAt"]=(0,o.Pz)(e.indexStartValue_),e.startNameSet_&&(n["startAt"]+=","+(0,o.Pz)(e.indexStartName_))),e.endSet_&&(n["endAt"]=(0,o.Pz)(e.indexEndValue_),e.endNameSet_&&(n["endAt"]+=","+(0,o.Pz)(e.indexEndName_))),e.limitSet_&&(e.isViewFromLeft()?n["limitToFirst"]=e.limit_:n["limitToLast"]=e.limit_)),n}function Qn(e){var t={};if(e.startSet_&&(t["sp"]=e.indexStartValue_,e.startNameSet_&&(t["sn"]=e.indexStartName_)),e.endSet_&&(t["ep"]=e.indexEndValue_,e.endNameSet_&&(t["en"]=e.indexEndName_)),e.limitSet_){t["l"]=e.limit_;var n=e.viewFrom_;""===n&&(n=e.isViewFromLeft()?"l":"r"),t["vf"]=n}return e.index_!==hn&&(t["i"]=e.index_.toString()),t}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Kn=function(e){function t(t,n,r,i){var o=e.call(this)||this;return o.repoInfo_=t,o.onDataUpdate_=n,o.authTokenProvider_=r,o.appCheckTokenProvider_=i,o.log_=I("p:rest:"),o.listens_={},o}return(0,s.ZT)(t,e),t.prototype.reportStats=function(e){throw new Error("Method not implemented.")},t.getListenId_=function(e,t){return void 0!==t?"tag$"+t:((0,o.hu)(e._queryParams.isDefault(),"should have a tag if it's not a default query."),e._path.toString())},t.prototype.listen=function(e,n,r,i){var s=this,a=e._path.toString();this.log_("Listen called for "+a+" "+e._queryIdentifier);var u=t.getListenId_(e,r),l={};this.listens_[u]=l;var c=$n(e._queryParams);this.restRequest_(a+".json",c,(function(e,t){var n,c=t;(404===e&&(c=null,e=null),null===e&&s.onDataUpdate_(a,c,!1,r),(0,o.DV)(s.listens_,u)===l)&&(n=e?401===e?"permission_denied":"rest_error:"+e:"ok",i(n,null))}))},t.prototype.unlisten=function(e,n){var r=t.getListenId_(e,n);delete this.listens_[r]},t.prototype.get=function(e){var t=this,n=$n(e._queryParams),r=e._path.toString(),i=new o.BH;return this.restRequest_(r+".json",n,(function(e,n){var o=n;404===e&&(o=null,e=null),null===e?(t.onDataUpdate_(r,o,!1,null),i.resolve(o)):i.reject(new Error(o))})),i.promise},t.prototype.refreshAuthToken=function(e){},t.prototype.restRequest_=function(e,t,n){var r=this;return void 0===t&&(t={}),t["format"]="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then((function(i){var a=(0,s.CR)(i,2),u=a[0],l=a[1];u&&u.accessToken&&(t["auth"]=u.accessToken),l&&l.token&&(t["ac"]=l.token);var c=(r.repoInfo_.secure?"https://":"http://")+r.repoInfo_.host+e+"?ns="+r.repoInfo_.namespace+(0,o.xO)(t);r.log_("Sending REST request for "+c);var h=new XMLHttpRequest;h.onreadystatechange=function(){if(n&&4===h.readyState){r.log_("REST Response for "+c+" received. status:",h.status,"response:",h.responseText);var e=null;if(h.status>=200&&h.status<300){try{e=(0,o.cI)(h.responseText)}catch(t){P("Failed to parse JSON response for "+c+": "+h.responseText)}n(null,e)}else 401!==h.status&&404!==h.status&&P("Got unsuccessful REST response for "+c+" Status: "+h.status),n(h.status);n=null}},h.open("GET",c,!0),h.send()}))},t}(ot),Jn=function(){function e(){this.rootNode_=yn.EMPTY_NODE}return e.prototype.getNode=function(e){return this.rootNode_.getChild(e)},e.prototype.updateSnapshot=function(e,t){this.rootNode_=this.rootNode_.updateChild(e,t)},e}();
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function Xn(){return{value:null,children:new Map}}function er(e,t,n){if(wt(t))e.value=n,e.children.clear();else if(null!==e.value)e.value=e.value.updateChild(t,n);else{var r=dt(t);e.children.has(r)||e.children.set(r,Xn());var i=e.children.get(r);t=ft(t),er(i,t,n)}}function tr(e,t){if(wt(t))return e.value=null,e.children.clear(),!0;if(null!==e.value){if(e.value.isLeafNode())return!1;var n=e.value;return e.value=null,n.forEachChild(hn,(function(t,n){er(e,new ct(t),n)})),tr(e,t)}if(e.children.size>0){var r=dt(t);if(t=ft(t),e.children.has(r)){var i=tr(e.children.get(r),t);i&&e.children.delete(r)}return 0===e.children.size}return!0}function nr(e,t,n){null!==e.value?n(t,e.value):rr(e,(function(e,r){var i=new ct(t.toString()+"/"+e);nr(r,i,n)}))}function rr(e,t){e.children.forEach((function(e,n){t(n,e)}))}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var ir,or=function(){function e(e){this.collection_=e,this.last_=null}return e.prototype.get=function(){var e=this.collection_.get(),t=(0,s.pi)({},e);return this.last_&&F(this.last_,(function(e,n){t[e]=t[e]-n})),this.last_=e,t},e}(),sr=1e4,ar=3e4,ur=3e5,lr=function(){function e(e,t){this.server_=t,this.statsToReport_={},this.statsListener_=new or(e);var n=sr+(ar-sr)*Math.random();Q(this.reportStats_.bind(this),Math.floor(n))}return e.prototype.reportStats_=function(){var e=this,t=this.statsListener_.get(),n={},r=!1;F(t,(function(t,i){i>0&&(0,o.r3)(e.statsToReport_,t)&&(n[t]=i,r=!0)})),r&&this.server_.reportStats(n),Q(this.reportStats_.bind(this),Math.floor(2*Math.random()*ur))},e}();
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function cr(e,t){e.statsToReport_[t]=!0}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hr(){return{fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}function dr(){return{fromUser:!1,fromServer:!0,queryId:null,tagged:!1}}function pr(e){return{fromUser:!1,fromServer:!0,queryId:e,tagged:!0}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(function(e){e[e["OVERWRITE"]=0]="OVERWRITE",e[e["MERGE"]=1]="MERGE",e[e["ACK_USER_WRITE"]=2]="ACK_USER_WRITE",e[e["LISTEN_COMPLETE"]=3]="LISTEN_COMPLETE"})(ir||(ir={}));var fr,_r=function(){function e(e,t,n){this.path=e,this.affectedTree=t,this.revert=n,this.type=ir.ACK_USER_WRITE,this.source=hr()}return e.prototype.operationForChild=function(t){if(wt(this.path)){if(null!=this.affectedTree.value)return(0,o.hu)(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;var n=this.affectedTree.subtree(new ct(t));return new e(ht(),n,this.revert)}return(0,o.hu)(dt(this.path)===t,"operationForChild called for unrelated child."),new e(ft(this.path),this.affectedTree,this.revert)},e}(),vr=function(){function e(e,t){this.source=e,this.path=t,this.type=ir.LISTEN_COMPLETE}return e.prototype.operationForChild=function(t){return wt(this.path)?new e(this.source,ht()):new e(this.source,ft(this.path))},e}(),yr=function(){function e(e,t,n){this.source=e,this.path=t,this.snap=n,this.type=ir.OVERWRITE}return e.prototype.operationForChild=function(t){return wt(this.path)?new e(this.source,ht(),this.snap.getImmediateChild(t)):new e(this.source,ft(this.path),this.snap)},e}(),mr=function(){function e(e,t,n){this.source=e,this.path=t,this.children=n,this.type=ir.MERGE}return e.prototype.operationForChild=function(t){if(wt(this.path)){var n=this.children.subtree(new ct(t));return n.isEmpty()?null:n.value?new yr(this.source,ht(),n.value):new e(this.source,ht(),n)}return(0,o.hu)(dt(this.path)===t,"Can't get a merge for a child not on the path of the operation"),new e(this.source,ft(this.path),this.children)},e.prototype.toString=function(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"},e}(),gr=function(){function e(e,t,n){this.node_=e,this.fullyInitialized_=t,this.filtered_=n}return e.prototype.isFullyInitialized=function(){return this.fullyInitialized_},e.prototype.isFiltered=function(){return this.filtered_},e.prototype.isCompleteForPath=function(e){if(wt(e))return this.isFullyInitialized()&&!this.filtered_;var t=dt(e);return this.isCompleteForChild(t)},e.prototype.isCompleteForChild=function(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)},e.prototype.getNode=function(){return this.node_},e}(),wr=function(){function e(e){this.query_=e,this.index_=this.query_._queryParams.getIndex()}return e}();
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Cr(e,t,n,r){var i=[],o=[];return t.forEach((function(t){"child_changed"===t.type&&e.index_.indexedValueChanged(t.oldSnap,t.snapshotNode)&&o.push(Mn(t.childName,t.snapshotNode))})),br(e,i,"child_removed",t,r,n),br(e,i,"child_added",t,r,n),br(e,i,"child_moved",o,r,n),br(e,i,"child_changed",t,r,n),br(e,i,"value",t,r,n),i}function br(e,t,n,r,i,o){var s=r.filter((function(e){return e.type===n}));s.sort((function(t,n){return Tr(e,t,n)})),s.forEach((function(n){var r=kr(e,n,o);i.forEach((function(i){i.respondsTo(n.type)&&t.push(i.createEvent(r,e.query_))}))}))}function kr(e,t,n){return"value"===t.type||"child_removed"===t.type||(t.prevName=n.getPredecessorChildName(t.childName,t.snapshotNode,e.index_)),t}function Tr(e,t,n){if(null==t.childName||null==n.childName)throw(0,o.g5)("Should only compare child_ events.");var r=new jt(t.childName,t.snapshotNode),i=new jt(n.childName,n.snapshotNode);return e.index_.compare(r,i)}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ir(e,t){return{eventCache:e,serverCache:t}}function xr(e,t,n,r){return Ir(new gr(t,n,r),e.serverCache)}function Sr(e,t,n,r){return Ir(e.eventCache,new gr(t,n,r))}function Pr(e){return e.eventCache.isFullyInitialized()?e.eventCache.getNode():null}function Er(e){return e.serverCache.isFullyInitialized()?e.serverCache.getNode():null}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Dr=function(){return fr||(fr=new $t(O)),fr},Rr=function(){function e(e,t){void 0===t&&(t=Dr()),this.value=e,this.children=t}return e.fromObject=function(t){var n=new e(null);return F(t,(function(e,t){n=n.set(new ct(e),t)})),n},e.prototype.isEmpty=function(){return null===this.value&&this.children.isEmpty()},e.prototype.findRootMostMatchingPathAndValue=function(e,t){if(null!=this.value&&t(this.value))return{path:ht(),value:this.value};if(wt(e))return null;var n=dt(e),r=this.children.get(n);if(null!==r){var i=r.findRootMostMatchingPathAndValue(ft(e),t);if(null!=i){var o=gt(new ct(n),i.path);return{path:o,value:i.value}}return null}return null},e.prototype.findRootMostValueAndPath=function(e){return this.findRootMostMatchingPathAndValue(e,(function(){return!0}))},e.prototype.subtree=function(t){if(wt(t))return this;var n=dt(t),r=this.children.get(n);return null!==r?r.subtree(ft(t)):new e(null)},e.prototype.set=function(t,n){if(wt(t))return new e(n,this.children);var r=dt(t),i=this.children.get(r)||new e(null),o=i.set(ft(t),n),s=this.children.insert(r,o);return new e(this.value,s)},e.prototype.remove=function(t){if(wt(t))return this.children.isEmpty()?new e(null):new e(null,this.children);var n=dt(t),r=this.children.get(n);if(r){var i=r.remove(ft(t)),o=void 0;return o=i.isEmpty()?this.children.remove(n):this.children.insert(n,i),null===this.value&&o.isEmpty()?new e(null):new e(this.value,o)}return this},e.prototype.get=function(e){if(wt(e))return this.value;var t=dt(e),n=this.children.get(t);return n?n.get(ft(e)):null},e.prototype.setTree=function(t,n){if(wt(t))return n;var r=dt(t),i=this.children.get(r)||new e(null),o=i.setTree(ft(t),n),s=void 0;return s=o.isEmpty()?this.children.remove(r):this.children.insert(r,o),new e(this.value,s)},e.prototype.fold=function(e){return this.fold_(ht(),e)},e.prototype.fold_=function(e,t){var n={};return this.children.inorderTraversal((function(r,i){n[r]=i.fold_(gt(e,r),t)})),t(e,this.value,n)},e.prototype.findOnPath=function(e,t){return this.findOnPath_(e,ht(),t)},e.prototype.findOnPath_=function(e,t,n){var r=!!this.value&&n(t,this.value);if(r)return r;if(wt(e))return null;var i=dt(e),o=this.children.get(i);return o?o.findOnPath_(ft(e),gt(t,i),n):null},e.prototype.foreachOnPath=function(e,t){return this.foreachOnPath_(e,ht(),t)},e.prototype.foreachOnPath_=function(t,n,r){if(wt(t))return this;this.value&&r(n,this.value);var i=dt(t),o=this.children.get(i);return o?o.foreachOnPath_(ft(t),gt(n,i),r):new e(null)},e.prototype.foreach=function(e){this.foreach_(ht(),e)},e.prototype.foreach_=function(e,t){this.children.inorderTraversal((function(n,r){r.foreach_(gt(e,n),t)})),this.value&&t(e,this.value)},e.prototype.foreachChild=function(e){this.children.inorderTraversal((function(t,n){n.value&&e(t,n.value)}))},e}(),Nr=function(){function e(e){this.writeTree_=e}return e.empty=function(){return new e(new Rr(null))},e}();function Ur(e,t,n){if(wt(t))return new Nr(new Rr(n));var r=e.writeTree_.findRootMostValueAndPath(t);if(null!=r){var i=r.path,o=r.value,s=Ct(i,t);return o=o.updateChild(s,n),new Nr(e.writeTree_.set(i,o))}var a=new Rr(n),u=e.writeTree_.setTree(t,a);return new Nr(u)}function Ar(e,t,n){var r=e;return F(n,(function(e,n){r=Ur(r,gt(t,e),n)})),r}function Or(e,t){if(wt(t))return Nr.empty();var n=e.writeTree_.setTree(t,new Rr(null));return new Nr(n)}function Mr(e,t){return null!=Lr(e,t)}function Lr(e,t){var n=e.writeTree_.findRootMostValueAndPath(t);return null!=n?e.writeTree_.get(n.path).getChild(Ct(n.path,t)):null}function qr(e){var t=[],n=e.writeTree_.value;return null!=n?n.isLeafNode()||n.forEachChild(hn,(function(e,n){t.push(new jt(e,n))})):e.writeTree_.children.inorderTraversal((function(e,n){null!=n.value&&t.push(new jt(e,n.value))})),t}function Fr(e,t){if(wt(t))return e;var n=Lr(e,t);return new Nr(null!=n?new Rr(n):e.writeTree_.subtree(t))}function Wr(e){return e.writeTree_.isEmpty()}function Hr(e,t){return jr(ht(),e.writeTree_,t)}function jr(e,t,n){if(null!=t.value)return n.updateChild(e,t.value);var r=null;return t.children.inorderTraversal((function(t,i){".priority"===t?((0,o.hu)(null!==i.value,"Priority writes must always be leaf nodes"),r=i.value):n=jr(gt(e,t),i,n)})),n.getChild(e).isEmpty()||null===r||(n=n.updateChild(gt(e,".priority"),r)),n}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Zr(e,t){return di(t,e)}function Br(e,t,n,r,i){(0,o.hu)(r>e.lastWriteId,"Stacking an older write on top of newer ones"),void 0===i&&(i=!0),e.allWrites.push({path:t,snap:n,writeId:r,visible:i}),i&&(e.visibleWrites=Ur(e.visibleWrites,t,n)),e.lastWriteId=r}function zr(e,t,n,r){(0,o.hu)(r>e.lastWriteId,"Stacking an older merge on top of newer ones"),e.allWrites.push({path:t,children:n,writeId:r,visible:!0}),e.visibleWrites=Ar(e.visibleWrites,t,n),e.lastWriteId=r}function Yr(e,t){for(var n=0;n<e.allWrites.length;n++){var r=e.allWrites[n];if(r.writeId===t)return r}return null}function Vr(e,t){var n=e.allWrites.findIndex((function(e){return e.writeId===t}));(0,o.hu)(n>=0,"removeWrite called with nonexistent writeId.");var r=e.allWrites[n];e.allWrites.splice(n,1);var i=r.visible,s=!1,a=e.allWrites.length-1;while(i&&a>=0){var u=e.allWrites[a];u.visible&&(a>=n&&Gr(u,r.path)?i=!1:Tt(r.path,u.path)&&(s=!0)),a--}if(i){if(s)return $r(e),!0;if(r.snap)e.visibleWrites=Or(e.visibleWrites,r.path);else{var l=r.children;F(l,(function(t){e.visibleWrites=Or(e.visibleWrites,gt(r.path,t))}))}return!0}return!1}function Gr(e,t){if(e.snap)return Tt(e.path,t);for(var n in e.children)if(e.children.hasOwnProperty(n)&&Tt(gt(e.path,n),t))return!0;return!1}function $r(e){e.visibleWrites=Kr(e.allWrites,Qr,ht()),e.allWrites.length>0?e.lastWriteId=e.allWrites[e.allWrites.length-1].writeId:e.lastWriteId=-1}function Qr(e){return e.visible}function Kr(e,t,n){for(var r=Nr.empty(),i=0;i<e.length;++i){var s=e[i];if(t(s)){var a=s.path,u=void 0;if(s.snap)Tt(n,a)?(u=Ct(n,a),r=Ur(r,u,s.snap)):Tt(a,n)&&(u=Ct(a,n),r=Ur(r,ht(),s.snap.getChild(u)));else{if(!s.children)throw(0,o.g5)("WriteRecord should have .snap or .children");if(Tt(n,a))u=Ct(n,a),r=Ar(r,u,s.children);else if(Tt(a,n))if(u=Ct(a,n),wt(u))r=Ar(r,ht(),s.children);else{var l=(0,o.DV)(s.children,dt(u));if(l){var c=l.getChild(ft(u));r=Ur(r,ht(),c)}}}}}return r}function Jr(e,t,n,r,i){if(r||i){var o=Fr(e.visibleWrites,t);if(!i&&Wr(o))return n;if(i||null!=n||Mr(o,ht())){var s=function(e){return(e.visible||i)&&(!r||!~r.indexOf(e.writeId))&&(Tt(e.path,t)||Tt(t,e.path))},a=Kr(e.allWrites,s,t);c=n||yn.EMPTY_NODE;return Hr(a,c)}return null}var u=Lr(e.visibleWrites,t);if(null!=u)return u;var l=Fr(e.visibleWrites,t);if(Wr(l))return n;if(null!=n||Mr(l,ht())){var c=n||yn.EMPTY_NODE;return Hr(l,c)}return null}function Xr(e,t,n){var r=yn.EMPTY_NODE,i=Lr(e.visibleWrites,t);if(i)return i.isLeafNode()||i.forEachChild(hn,(function(e,t){r=r.updateImmediateChild(e,t)})),r;if(n){var o=Fr(e.visibleWrites,t);return n.forEachChild(hn,(function(e,t){var n=Hr(Fr(o,new ct(e)),t);r=r.updateImmediateChild(e,n)})),qr(o).forEach((function(e){r=r.updateImmediateChild(e.name,e.node)})),r}var s=Fr(e.visibleWrites,t);return qr(s).forEach((function(e){r=r.updateImmediateChild(e.name,e.node)})),r}function ei(e,t,n,r,i){(0,o.hu)(r||i,"Either existingEventSnap or existingServerSnap must exist");var s=gt(t,n);if(Mr(e.visibleWrites,s))return null;var a=Fr(e.visibleWrites,s);return Wr(a)?i.getChild(n):Hr(a,i.getChild(n))}function ti(e,t,n,r){var i=gt(t,n),o=Lr(e.visibleWrites,i);if(null!=o)return o;if(r.isCompleteForChild(n)){var s=Fr(e.visibleWrites,i);return Hr(s,r.getNode().getImmediateChild(n))}return null}function ni(e,t){return Lr(e.visibleWrites,t)}function ri(e,t,n,r,i,o,s){var a,u=Fr(e.visibleWrites,t),l=Lr(u,ht());if(null!=l)a=l;else{if(null==n)return[];a=Hr(u,n)}if(a=a.withIndex(s),a.isEmpty()||a.isLeafNode())return[];var c=[],h=s.getCompare(),d=o?a.getReverseIteratorFrom(r,s):a.getIteratorFrom(r,s),p=d.getNext();while(p&&c.length<i)0!==h(p,r)&&c.push(p),p=d.getNext();return c}function ii(){return{visibleWrites:Nr.empty(),allWrites:[],lastWriteId:-1}}function oi(e,t,n,r){return Jr(e.writeTree,e.treePath,t,n,r)}function si(e,t){return Xr(e.writeTree,e.treePath,t)}function ai(e,t,n,r){return ei(e.writeTree,e.treePath,t,n,r)}function ui(e,t){return ni(e.writeTree,gt(e.treePath,t))}function li(e,t,n,r,i,o){return ri(e.writeTree,e.treePath,t,n,r,i,o)}function ci(e,t,n){return ti(e.writeTree,e.treePath,t,n)}function hi(e,t){return di(gt(e.treePath,t),e.writeTree)}function di(e,t){return{treePath:e,writeTree:t}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var pi=function(){function e(){this.changeMap=new Map}return e.prototype.trackChildChange=function(e){var t=e.type,n=e.childName;(0,o.hu)("child_added"===t||"child_changed"===t||"child_removed"===t,"Only child changes supported for tracking"),(0,o.hu)(".priority"!==n,"Only non-priority child changes can be tracked.");var r=this.changeMap.get(n);if(r){var i=r.type;if("child_added"===t&&"child_removed"===i)this.changeMap.set(n,On(n,e.snapshotNode,r.snapshotNode));else if("child_removed"===t&&"child_added"===i)this.changeMap.delete(n);else if("child_removed"===t&&"child_changed"===i)this.changeMap.set(n,An(n,r.oldSnap));else if("child_changed"===t&&"child_added"===i)this.changeMap.set(n,Un(n,e.snapshotNode));else{if("child_changed"!==t||"child_changed"!==i)throw(0,o.g5)("Illegal combination of changes: "+e+" occurred after "+r);this.changeMap.set(n,On(n,e.snapshotNode,r.oldSnap))}}else this.changeMap.set(n,e)},e.prototype.getChanges=function(){return Array.from(this.changeMap.values())},e}(),fi=function(){function e(){}return e.prototype.getCompleteChild=function(e){return null},e.prototype.getChildAfterChild=function(e,t,n){return null},e}(),_i=new fi,vi=function(){function e(e,t,n){void 0===n&&(n=null),this.writes_=e,this.viewCache_=t,this.optCompleteServerCache_=n}return e.prototype.getCompleteChild=function(e){var t=this.viewCache_.eventCache;if(t.isCompleteForChild(e))return t.getNode().getImmediateChild(e);var n=null!=this.optCompleteServerCache_?new gr(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return ci(this.writes_,e,n)},e.prototype.getChildAfterChild=function(e,t,n){var r=null!=this.optCompleteServerCache_?this.optCompleteServerCache_:Er(this.viewCache_),i=li(this.writes_,r,t,1,n,e);return 0===i.length?null:i[0]},e}();
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function yi(e){return{filter:e}}function mi(e,t){(0,o.hu)(t.eventCache.getNode().isIndexed(e.filter.getIndex()),"Event snap not indexed"),(0,o.hu)(t.serverCache.getNode().isIndexed(e.filter.getIndex()),"Server snap not indexed")}function gi(e,t,n,r,i){var s,a,u=new pi;if(n.type===ir.OVERWRITE){var l=n;l.source.fromUser?s=ki(e,t,l.path,l.snap,r,i,u):((0,o.hu)(l.source.fromServer,"Unknown source."),a=l.source.tagged||t.serverCache.isFiltered()&&!wt(l.path),s=bi(e,t,l.path,l.snap,r,i,a,u))}else if(n.type===ir.MERGE){var c=n;c.source.fromUser?s=Ii(e,t,c.path,c.children,r,i,u):((0,o.hu)(c.source.fromServer,"Unknown source."),a=c.source.tagged||t.serverCache.isFiltered(),s=Si(e,t,c.path,c.children,r,i,a,u))}else if(n.type===ir.ACK_USER_WRITE){var h=n;s=h.revert?Di(e,t,h.path,r,i,u):Pi(e,t,h.path,h.affectedTree,r,i,u)}else{if(n.type!==ir.LISTEN_COMPLETE)throw(0,o.g5)("Unknown operation type: "+n.type);s=Ei(e,t,n.path,r,u)}var d=u.getChanges();return wi(t,s,d),{viewCache:s,changes:d}}function wi(e,t,n){var r=t.eventCache;if(r.isFullyInitialized()){var i=r.getNode().isLeafNode()||r.getNode().isEmpty(),o=Pr(e);(n.length>0||!e.eventCache.isFullyInitialized()||i&&!r.getNode().equals(o)||!r.getNode().getPriority().equals(o.getPriority()))&&n.push(Nn(Pr(t)))}}function Ci(e,t,n,r,i,s){var a=t.eventCache;if(null!=ui(r,n))return t;var u=void 0,l=void 0;if(wt(n))if((0,o.hu)(t.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),t.serverCache.isFiltered()){var c=Er(t),h=c instanceof yn?c:yn.EMPTY_NODE,d=si(r,h);u=e.filter.updateFullNode(t.eventCache.getNode(),d,s)}else{var p=oi(r,Er(t));u=e.filter.updateFullNode(t.eventCache.getNode(),p,s)}else{var f=dt(n);if(".priority"===f){(0,o.hu)(1===pt(n),"Can't have a priority with additional path components");var _=a.getNode();l=t.serverCache.getNode();var v=ai(r,n,_,l);u=null!=v?e.filter.updatePriority(_,v):a.getNode()}else{var y=ft(n),m=void 0;if(a.isCompleteForChild(f)){l=t.serverCache.getNode();var g=ai(r,n,a.getNode(),l);m=null!=g?a.getNode().getImmediateChild(f).updateChild(y,g):a.getNode().getImmediateChild(f)}else m=ci(r,f,t.serverCache);u=null!=m?e.filter.updateChild(a.getNode(),f,m,y,i,s):a.getNode()}}return xr(t,u,a.isFullyInitialized()||wt(n),e.filter.filtersNodes())}function bi(e,t,n,r,i,o,s,a){var u,l=t.serverCache,c=s?e.filter:e.filter.getIndexedFilter();if(wt(n))u=c.updateFullNode(l.getNode(),r,null);else if(c.filtersNodes()&&!l.isFiltered()){var h=l.getNode().updateChild(n,r);u=c.updateFullNode(l.getNode(),h,null)}else{var d=dt(n);if(!l.isCompleteForPath(n)&&pt(n)>1)return t;var p=ft(n),f=l.getNode().getImmediateChild(d),_=f.updateChild(p,r);u=".priority"===d?c.updatePriority(l.getNode(),_):c.updateChild(l.getNode(),d,_,p,_i,null)}var v=Sr(t,u,l.isFullyInitialized()||wt(n),c.filtersNodes()),y=new vi(i,v,o);return Ci(e,v,n,i,y,a)}function ki(e,t,n,r,i,o,s){var a,u,l=t.eventCache,c=new vi(i,t,o);if(wt(n))u=e.filter.updateFullNode(t.eventCache.getNode(),r,s),a=xr(t,u,!0,e.filter.filtersNodes());else{var h=dt(n);if(".priority"===h)u=e.filter.updatePriority(t.eventCache.getNode(),r),a=xr(t,u,l.isFullyInitialized(),l.isFiltered());else{var d=ft(n),p=l.getNode().getImmediateChild(h),f=void 0;if(wt(d))f=r;else{var _=c.getCompleteChild(h);f=null!=_?".priority"===_t(d)&&_.getChild(mt(d)).isEmpty()?_:_.updateChild(d,r):yn.EMPTY_NODE}if(p.equals(f))a=t;else{var v=e.filter.updateChild(l.getNode(),h,f,d,c,s);a=xr(t,v,l.isFullyInitialized(),e.filter.filtersNodes())}}}return a}function Ti(e,t){return e.eventCache.isCompleteForChild(t)}function Ii(e,t,n,r,i,o,s){var a=t;return r.foreach((function(r,u){var l=gt(n,r);Ti(t,dt(l))&&(a=ki(e,a,l,u,i,o,s))})),r.foreach((function(r,u){var l=gt(n,r);Ti(t,dt(l))||(a=ki(e,a,l,u,i,o,s))})),a}function xi(e,t,n){return n.foreach((function(e,n){t=t.updateChild(e,n)})),t}function Si(e,t,n,r,i,o,s,a){if(t.serverCache.getNode().isEmpty()&&!t.serverCache.isFullyInitialized())return t;var u,l=t;u=wt(n)?r:new Rr(null).setTree(n,r);var c=t.serverCache.getNode();return u.children.inorderTraversal((function(n,r){if(c.hasChild(n)){var u=t.serverCache.getNode().getImmediateChild(n),h=xi(e,u,r);l=bi(e,l,new ct(n),h,i,o,s,a)}})),u.children.inorderTraversal((function(n,r){var u=!t.serverCache.isCompleteForChild(n)&&void 0===r.value;if(!c.hasChild(n)&&!u){var h=t.serverCache.getNode().getImmediateChild(n),d=xi(e,h,r);l=bi(e,l,new ct(n),d,i,o,s,a)}})),l}function Pi(e,t,n,r,i,o,s){if(null!=ui(i,n))return t;var a=t.serverCache.isFiltered(),u=t.serverCache;if(null!=r.value){if(wt(n)&&u.isFullyInitialized()||u.isCompleteForPath(n))return bi(e,t,n,u.getNode().getChild(n),i,o,a,s);if(wt(n)){var l=new Rr(null);return u.getNode().forEachChild(zt,(function(e,t){l=l.set(new ct(e),t)})),Si(e,t,n,l,i,o,a,s)}return t}var c=new Rr(null);return r.foreach((function(e,t){var r=gt(n,e);u.isCompleteForPath(r)&&(c=c.set(e,u.getNode().getChild(r)))})),Si(e,t,n,c,i,o,a,s)}function Ei(e,t,n,r,i){var o=t.serverCache,s=Sr(t,o.getNode(),o.isFullyInitialized()||wt(n),o.isFiltered());return Ci(e,s,n,r,_i,i)}function Di(e,t,n,r,i,s){var a;if(null!=ui(r,n))return t;var u=new vi(r,t,i),l=t.eventCache.getNode(),c=void 0;if(wt(n)||".priority"===dt(n)){var h=void 0;if(t.serverCache.isFullyInitialized())h=oi(r,Er(t));else{var d=t.serverCache.getNode();(0,o.hu)(d instanceof yn,"serverChildren would be complete if leaf node"),h=si(r,d)}c=e.filter.updateFullNode(l,h,s)}else{var p=dt(n),f=ci(r,p,t.serverCache);null==f&&t.serverCache.isCompleteForChild(p)&&(f=l.getImmediateChild(p)),c=null!=f?e.filter.updateChild(l,p,f,ft(n),u,s):t.eventCache.getNode().hasChild(p)?e.filter.updateChild(l,p,yn.EMPTY_NODE,ft(n),u,s):l,c.isEmpty()&&t.serverCache.isFullyInitialized()&&(a=oi(r,Er(t)),a.isLeafNode()&&(c=e.filter.updateFullNode(c,a,s)))}return a=t.serverCache.isFullyInitialized()||null!=ui(r,ht()),xr(t,c,a,e.filter.filtersNodes())}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Ri,Ni=function(){function e(e,t){this.query_=e,this.eventRegistrations_=[];var n=this.query_._queryParams,r=new Ln(n.getIndex()),i=Hn(n);this.processor_=yi(i);var o=t.serverCache,s=t.eventCache,a=r.updateFullNode(yn.EMPTY_NODE,o.getNode(),null),u=i.updateFullNode(yn.EMPTY_NODE,s.getNode(),null),l=new gr(a,o.isFullyInitialized(),r.filtersNodes()),c=new gr(u,s.isFullyInitialized(),i.filtersNodes());this.viewCache_=Ir(c,l),this.eventGenerator_=new wr(this.query_)}return Object.defineProperty(e.prototype,"query",{get:function(){return this.query_},enumerable:!1,configurable:!0}),e}();function Ui(e){return e.viewCache_.serverCache.getNode()}function Ai(e){return Pr(e.viewCache_)}function Oi(e,t){var n=Er(e.viewCache_);return n&&(e.query._queryParams.loadsAllData()||!wt(t)&&!n.getImmediateChild(dt(t)).isEmpty())?n.getChild(t):null}function Mi(e){return 0===e.eventRegistrations_.length}function Li(e,t){e.eventRegistrations_.push(t)}function qi(e,t,n){var r=[];if(n){(0,o.hu)(null==t,"A cancel should cancel all event registrations.");var i=e.query._path;e.eventRegistrations_.forEach((function(e){var t=e.createCancelEvent(n,i);t&&r.push(t)}))}if(t){for(var s=[],a=0;a<e.eventRegistrations_.length;++a){var u=e.eventRegistrations_[a];if(u.matches(t)){if(t.hasAnyCallback()){s=s.concat(e.eventRegistrations_.slice(a+1));break}}else s.push(u)}e.eventRegistrations_=s}else e.eventRegistrations_=[];return r}function Fi(e,t,n,r){t.type===ir.MERGE&&null!==t.source.queryId&&((0,o.hu)(Er(e.viewCache_),"We should always have a full cache before handling merges"),(0,o.hu)(Pr(e.viewCache_),"Missing event cache, even though we have a server cache"));var i=e.viewCache_,s=gi(e.processor_,i,t,n,r);return mi(e.processor_,s.viewCache),(0,o.hu)(s.viewCache.serverCache.isFullyInitialized()||!i.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),e.viewCache_=s.viewCache,Hi(e,s.changes,s.viewCache.eventCache.getNode(),null)}function Wi(e,t){var n=e.viewCache_.eventCache,r=[];if(!n.getNode().isLeafNode()){var i=n.getNode();i.forEachChild(hn,(function(e,t){r.push(Un(e,t))}))}return n.isFullyInitialized()&&r.push(Nn(n.getNode())),Hi(e,r,n.getNode(),t)}function Hi(e,t,n,r){var i=r?[r]:e.eventRegistrations_;return Cr(e.eventGenerator_,t,n,i)}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var ji,Zi=function(){function e(){this.views=new Map}return e}();function Bi(e){(0,o.hu)(!Ri,"__referenceConstructor has already been defined"),Ri=e}function zi(){return(0,o.hu)(Ri,"Reference.ts has not been loaded"),Ri}function Yi(e){return 0===e.views.size}function Vi(e,t,n,r){var i,a,u=t.source.queryId;if(null!==u){var l=e.views.get(u);return(0,o.hu)(null!=l,"SyncTree gave us an op for an invalid query."),Fi(l,t,n,r)}var c=[];try{for(var h=(0,s.XA)(e.views.values()),d=h.next();!d.done;d=h.next()){l=d.value;c=c.concat(Fi(l,t,n,r))}}catch(p){i={error:p}}finally{try{d&&!d.done&&(a=h.return)&&a.call(h)}finally{if(i)throw i.error}}return c}function Gi(e,t,n,r,i){var o=t._queryIdentifier,s=e.views.get(o);if(!s){var a=oi(n,i?r:null),u=!1;a?u=!0:r instanceof yn?(a=si(n,r),u=!1):(a=yn.EMPTY_NODE,u=!1);var l=Ir(new gr(a,u,!1),new gr(r,i,!1));return new Ni(t,l)}return s}function $i(e,t,n,r,i,o){var s=Gi(e,t,r,i,o);return e.views.has(t._queryIdentifier)||e.views.set(t._queryIdentifier,s),Li(s,n),Wi(s,n)}function Qi(e,t,n,r){var i,o,a=t._queryIdentifier,u=[],l=[],c=to(e);if("default"===a)try{for(var h=(0,s.XA)(e.views.entries()),d=h.next();!d.done;d=h.next()){var p=(0,s.CR)(d.value,2),f=p[0],_=p[1];l=l.concat(qi(_,n,r)),Mi(_)&&(e.views.delete(f),_.query._queryParams.loadsAllData()||u.push(_.query))}}catch(v){i={error:v}}finally{try{d&&!d.done&&(o=h.return)&&o.call(h)}finally{if(i)throw i.error}}else{_=e.views.get(a);_&&(l=l.concat(qi(_,n,r)),Mi(_)&&(e.views.delete(a),_.query._queryParams.loadsAllData()||u.push(_.query)))}return c&&!to(e)&&u.push(new(zi())(t._repo,t._path)),{removed:u,events:l}}function Ki(e){var t,n,r=[];try{for(var i=(0,s.XA)(e.views.values()),o=i.next();!o.done;o=i.next()){var a=o.value;a.query._queryParams.loadsAllData()||r.push(a)}}catch(u){t={error:u}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}return r}function Ji(e,t){var n,r,i=null;try{for(var o=(0,s.XA)(e.views.values()),a=o.next();!a.done;a=o.next()){var u=a.value;i=i||Oi(u,t)}}catch(l){n={error:l}}finally{try{a&&!a.done&&(r=o.return)&&r.call(o)}finally{if(n)throw n.error}}return i}function Xi(e,t){var n=t._queryParams;if(n.loadsAllData())return no(e);var r=t._queryIdentifier;return e.views.get(r)}function eo(e,t){return null!=Xi(e,t)}function to(e){return null!=no(e)}function no(e){var t,n;try{for(var r=(0,s.XA)(e.views.values()),i=r.next();!i.done;i=r.next()){var o=i.value;if(o.query._queryParams.loadsAllData())return o}}catch(a){t={error:a}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(t)throw t.error}}return null}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ro(e){(0,o.hu)(!ji,"__referenceConstructor has already been defined"),ji=e}function io(){return(0,o.hu)(ji,"Reference.ts has not been loaded"),ji}var oo=1,so=function(){function e(e){this.listenProvider_=e,this.syncPointTree_=new Rr(null),this.pendingWriteTree_=ii(),this.tagToQueryMap=new Map,this.queryToTagMap=new Map}return e}();function ao(e,t,n,r,i){return Br(e.pendingWriteTree_,t,n,r,i),i?Co(e,new yr(hr(),t,n)):[]}function uo(e,t,n,r){zr(e.pendingWriteTree_,t,n,r);var i=Rr.fromObject(n);return Co(e,new mr(hr(),t,i))}function lo(e,t,n){void 0===n&&(n=!1);var r=Yr(e.pendingWriteTree_,t),i=Vr(e.pendingWriteTree_,t);if(i){var o=new Rr(null);return null!=r.snap?o=o.set(ht(),!0):F(r.children,(function(e){o=o.set(new ct(e),!0)})),Co(e,new _r(r.path,o,n))}return[]}function co(e,t,n){return Co(e,new yr(dr(),t,n))}function ho(e,t,n){var r=Rr.fromObject(n);return Co(e,new mr(dr(),t,r))}function po(e,t){return Co(e,new vr(dr(),t))}function fo(e,t,n){var r=So(e,n);if(r){var i=Po(r),o=i.path,s=i.queryId,a=Ct(o,t),u=new vr(pr(s),a);return Eo(e,o,u)}return[]}function _o(e,t,n,r){var i=t._path,o=e.syncPointTree_.get(i),s=[];if(o&&("default"===t._queryIdentifier||eo(o,t))){var a=Qi(o,t,n,r);Yi(o)&&(e.syncPointTree_=e.syncPointTree_.remove(i));var u=a.removed;s=a.events;var l=-1!==u.findIndex((function(e){return e._queryParams.loadsAllData()})),c=e.syncPointTree_.findOnPath(i,(function(e,t){return to(t)}));if(l&&!c){var h=e.syncPointTree_.subtree(i);if(!h.isEmpty())for(var d=Do(h),p=0;p<d.length;++p){var f=d[p],_=f.query,v=To(e,f);e.listenProvider_.startListening(Ro(_),Io(e,_),v.hashFn,v.onComplete)}}if(!c&&u.length>0&&!r)if(l){var y=null;e.listenProvider_.stopListening(Ro(t),y)}else u.forEach((function(t){var n=e.queryToTagMap.get(xo(t));e.listenProvider_.stopListening(Ro(t),n)}));No(e,u)}return s}function vo(e,t,n,r){var i=So(e,r);if(null!=i){var o=Po(i),s=o.path,a=o.queryId,u=Ct(s,t),l=new yr(pr(a),u,n);return Eo(e,s,l)}return[]}function yo(e,t,n,r){var i=So(e,r);if(i){var o=Po(i),s=o.path,a=o.queryId,u=Ct(s,t),l=Rr.fromObject(n),c=new mr(pr(a),u,l);return Eo(e,s,c)}return[]}function mo(e,t,n){var r=t._path,i=null,s=!1;e.syncPointTree_.foreachOnPath(r,(function(e,t){var n=Ct(e,r);i=i||Ji(t,n),s=s||to(t)}));var a,u=e.syncPointTree_.get(r);if(u?(s=s||to(u),i=i||Ji(u,ht())):(u=new Zi,e.syncPointTree_=e.syncPointTree_.set(r,u)),null!=i)a=!0;else{a=!1,i=yn.EMPTY_NODE;var l=e.syncPointTree_.subtree(r);l.foreachChild((function(e,t){var n=Ji(t,ht());n&&(i=i.updateImmediateChild(e,n))}))}var c=eo(u,t);if(!c&&!t._queryParams.loadsAllData()){var h=xo(t);(0,o.hu)(!e.queryToTagMap.has(h),"View does not exist, but we have a tag");var d=Uo();e.queryToTagMap.set(h,d),e.tagToQueryMap.set(d,h)}var p=Zr(e.pendingWriteTree_,r),f=$i(u,t,n,p,i,a);if(!c&&!s){var _=Xi(u,t);f=f.concat(Ao(e,t,_))}return f}function go(e,t,n){var r=!0,i=e.pendingWriteTree_,o=e.syncPointTree_.findOnPath(t,(function(e,n){var r=Ct(e,t),i=Ji(n,r);if(i)return i}));return Jr(i,t,o,n,r)}function wo(e,t){var n=t._path,r=null;e.syncPointTree_.foreachOnPath(n,(function(e,t){var i=Ct(e,n);r=r||Ji(t,i)}));var i=e.syncPointTree_.get(n);i?r=r||Ji(i,ht()):(i=new Zi,e.syncPointTree_=e.syncPointTree_.set(n,i));var o=null!=r,s=o?new gr(r,!0,!1):null,a=Zr(e.pendingWriteTree_,t._path),u=Gi(i,t,a,o?s.getNode():yn.EMPTY_NODE,o);return Ai(u)}function Co(e,t){return bo(t,e.syncPointTree_,null,Zr(e.pendingWriteTree_,ht()))}function bo(e,t,n,r){if(wt(e.path))return ko(e,t,n,r);var i=t.get(ht());null==n&&null!=i&&(n=Ji(i,ht()));var o=[],s=dt(e.path),a=e.operationForChild(s),u=t.children.get(s);if(u&&a){var l=n?n.getImmediateChild(s):null,c=hi(r,s);o=o.concat(bo(a,u,l,c))}return i&&(o=o.concat(Vi(i,e,r,n))),o}function ko(e,t,n,r){var i=t.get(ht());null==n&&null!=i&&(n=Ji(i,ht()));var o=[];return t.children.inorderTraversal((function(t,i){var s=n?n.getImmediateChild(t):null,a=hi(r,t),u=e.operationForChild(t);u&&(o=o.concat(ko(u,i,s,a)))})),i&&(o=o.concat(Vi(i,e,r,n))),o}function To(e,t){var n=t.query,r=Io(e,n);return{hashFn:function(){var e=Ui(t)||yn.EMPTY_NODE;return e.hash()},onComplete:function(t){if("ok"===t)return r?fo(e,n._path,r):po(e,n._path);var i=Z(t,n);return _o(e,n,null,i)}}}function Io(e,t){var n=xo(t);return e.queryToTagMap.get(n)}function xo(e){return e._path.toString()+"$"+e._queryIdentifier}function So(e,t){return e.tagToQueryMap.get(t)}function Po(e){var t=e.indexOf("$");return(0,o.hu)(-1!==t&&t<e.length-1,"Bad queryKey."),{queryId:e.substr(t+1),path:new ct(e.substr(0,t))}}function Eo(e,t,n){var r=e.syncPointTree_.get(t);(0,o.hu)(r,"Missing sync point for query tag that we're tracking");var i=Zr(e.pendingWriteTree_,t);return Vi(r,n,i,null)}function Do(e){return e.fold((function(e,t,n){if(t&&to(t)){var r=no(t);return[r]}var i=[];return t&&(i=Ki(t)),F(n,(function(e,t){i=i.concat(t)})),i}))}function Ro(e){return e._queryParams.loadsAllData()&&!e._queryParams.isDefault()?new(io())(e._repo,e._path):e}function No(e,t){for(var n=0;n<t.length;++n){var r=t[n];if(!r._queryParams.loadsAllData()){var i=xo(r),o=e.queryToTagMap.get(i);e.queryToTagMap.delete(i),e.tagToQueryMap.delete(o)}}}function Uo(){return oo++}function Ao(e,t,n){var r=t._path,i=Io(e,t),s=To(e,n),a=e.listenProvider_.startListening(Ro(t),i,s.hashFn,s.onComplete),u=e.syncPointTree_.subtree(r);if(i)(0,o.hu)(!to(u.value),"If we're adding a query, it shouldn't be shadowed");else for(var l=u.fold((function(e,t,n){if(!wt(e)&&t&&to(t))return[no(t).query];var r=[];return t&&(r=r.concat(Ki(t).map((function(e){return e.query})))),F(n,(function(e,t){r=r.concat(t)})),r})),c=0;c<l.length;++c){var h=l[c];e.listenProvider_.stopListening(Ro(h),Io(e,h))}return a}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Oo=function(){function e(e){this.node_=e}return e.prototype.getImmediateChild=function(t){var n=this.node_.getImmediateChild(t);return new e(n)},e.prototype.node=function(){return this.node_},e}(),Mo=function(){function e(e,t){this.syncTree_=e,this.path_=t}return e.prototype.getImmediateChild=function(t){var n=gt(this.path_,t);return new e(this.syncTree_,n)},e.prototype.node=function(){return go(this.syncTree_,this.path_)},e}(),Lo=function(e){return e=e||{},e["timestamp"]=e["timestamp"]||(new Date).getTime(),e},qo=function(e,t,n){return e&&"object"===typeof e?((0,o.hu)(".sv"in e,"Unexpected leaf node or priority contents"),"string"===typeof e[".sv"]?Fo(e[".sv"],t,n):"object"===typeof e[".sv"]?Wo(e[".sv"],t):void(0,o.hu)(!1,"Unexpected server value: "+JSON.stringify(e,null,2))):e},Fo=function(e,t,n){switch(e){case"timestamp":return n["timestamp"];default:(0,o.hu)(!1,"Unexpected server value: "+e)}},Wo=function(e,t,n){e.hasOwnProperty("increment")||(0,o.hu)(!1,"Unexpected server value: "+JSON.stringify(e,null,2));var r=e["increment"];"number"!==typeof r&&(0,o.hu)(!1,"Unexpected increment value: "+r);var i=t.node();if((0,o.hu)(null!==i&&"undefined"!==typeof i,"Expected ChildrenNode.EMPTY_NODE for nulls"),!i.isLeafNode())return r;var s=i,a=s.getValue();return"number"!==typeof a?r:a+r},Ho=function(e,t,n,r){return Zo(t,new Mo(n,e),r)},jo=function(e,t,n){return Zo(e,new Oo(t),n)};function Zo(e,t,n){var r,i=e.getPriority().val(),o=qo(i,t.getImmediateChild(".priority"),n);if(e.isLeafNode()){var s=e,a=qo(s.getValue(),t,n);return a!==s.getValue()||o!==s.getPriority().val()?new on(a,Cn(o)):e}var u=e;return r=u,o!==u.getPriority().val()&&(r=r.updatePriority(new on(o))),u.forEachChild(hn,(function(e,i){var o=Zo(i,t.getImmediateChild(e),n);o!==i&&(r=r.updateImmediateChild(e,o))})),r}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Bo=function(){function e(e,t,n){void 0===e&&(e=""),void 0===t&&(t=null),void 0===n&&(n={children:{},childCount:0}),this.name=e,this.parent=t,this.node=n}return e}();function zo(e,t){var n=t instanceof ct?t:new ct(t),r=e,i=dt(n);while(null!==i){var s=(0,o.DV)(r.node.children,i)||{children:{},childCount:0};r=new Bo(i,r,s),n=ft(n),i=dt(n)}return r}function Yo(e){return e.node.value}function Vo(e,t){e.node.value=t,es(e)}function Go(e){return e.node.childCount>0}function $o(e){return void 0===Yo(e)&&!Go(e)}function Qo(e,t){F(e.node.children,(function(n,r){t(new Bo(n,e,r))}))}function Ko(e,t,n,r){n&&!r&&t(e),Qo(e,(function(e){Ko(e,t,!0,r)})),n&&r&&t(e)}function Jo(e,t,n){var r=n?e:e.parent;while(null!==r){if(t(r))return!0;r=r.parent}return!1}function Xo(e){return new ct(null===e.parent?e.name:Xo(e.parent)+"/"+e.name)}function es(e){null!==e.parent&&ts(e.parent,e.name,e)}function ts(e,t,n){var r=$o(n),i=(0,o.r3)(e.node.children,t);r&&i?(delete e.node.children[t],e.node.childCount--,es(e)):r||i||(e.node.children[t]=n.node,e.node.childCount++,es(e))}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var ns=/[\[\].#$\/\u0000-\u001F\u007F]/,rs=/[\[\].#$\u0000-\u001F\u007F]/,is=10485760,os=function(e){return"string"===typeof e&&0!==e.length&&!ns.test(e)},ss=function(e){return"string"===typeof e&&0!==e.length&&!rs.test(e)},as=function(e){return e&&(e=e.replace(/^\/*\.info(\/|$)/,"/")),ss(e)},us=function(e){return null===e||"string"===typeof e||"number"===typeof e&&!D(e)||e&&"object"===typeof e&&(0,o.r3)(e,".sv")},ls=function(e,t,n,r){r&&void 0===t||cs((0,o.gK)(e,"value"),t,n)},cs=function(e,t,n){var r=n instanceof ct?new It(n,e):n;if(void 0===t)throw new Error(e+"contains undefined "+Et(r));if("function"===typeof t)throw new Error(e+"contains a function "+Et(r)+" with contents = "+t.toString());if(D(t))throw new Error(e+"contains "+t.toString()+" "+Et(r));if("string"===typeof t&&t.length>is/3&&(0,o.ug)(t)>is)throw new Error(e+"contains a string greater than "+is+" utf8 bytes "+Et(r)+" ('"+t.substring(0,50)+"...')");if(t&&"object"===typeof t){var i=!1,s=!1;if(F(t,(function(t,n){if(".value"===t)i=!0;else if(".priority"!==t&&".sv"!==t&&(s=!0,!os(t)))throw new Error(e+" contains an invalid key ("+t+") "+Et(r)+'.  Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"');xt(r,t),cs(e,n,r),St(r)})),i&&s)throw new Error(e+' contains ".value" child '+Et(r)+" in addition to actual children.")}},hs=function(e,t){var n,r;for(n=0;n<t.length;n++){r=t[n];for(var i=yt(r),o=0;o<i.length;o++)if(".priority"===i[o]&&o===i.length-1);else if(!os(i[o]))throw new Error(e+"contains an invalid key ("+i[o]+") in path "+r.toString()+'. Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"')}t.sort(bt);var s=null;for(n=0;n<t.length;n++){if(r=t[n],null!==s&&Tt(s,r))throw new Error(e+"contains a path "+s.toString()+" that is ancestor of another path "+r.toString());s=r}},ds=function(e,t,n,r){if(!r||void 0!==t){var i=(0,o.gK)(e,"values");if(!t||"object"!==typeof t||Array.isArray(t))throw new Error(i+" must be an object containing the children to replace.");var s=[];F(t,(function(e,t){var r=new ct(e);if(cs(i,t,gt(n,r)),".priority"===_t(r)&&!us(t))throw new Error(i+"contains an invalid value for '"+r.toString()+"', which must be a valid Firebase priority (a string, finite number, server value, or null).");s.push(r)})),hs(i,s)}},ps=function(e,t,n){if(!n||void 0!==t){if(D(t))throw new Error((0,o.gK)(e,"priority")+"is "+t.toString()+", but must be a valid Firebase priority (a string, finite number, server value, or null).");if(!us(t))throw new Error((0,o.gK)(e,"priority")+"must be a valid Firebase priority (a string, finite number, server value, or null).")}},fs=function(e,t,n){if(!n||void 0!==t)switch(t){case"value":case"child_added":case"child_removed":case"child_changed":case"child_moved":break;default:throw new Error((0,o.gK)(e,"eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}},_s=function(e,t,n,r){if((!r||void 0!==n)&&!os(n))throw new Error((0,o.gK)(e,t)+'was an invalid key = "'+n+'".  Firebase keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]").')},vs=function(e,t,n,r){if((!r||void 0!==n)&&!ss(n))throw new Error((0,o.gK)(e,t)+'was an invalid path = "'+n+'". Paths must be non-empty strings and can\'t contain ".", "#", "$", "[", or "]"')},ys=function(e,t,n,r){n&&(n=n.replace(/^\/*\.info(\/|$)/,"/")),vs(e,t,n,r)},ms=function(e,t){if(".info"===dt(t))throw new Error(e+" failed = Can't modify data under /.info/")},gs=function(e,t){var n=t.path.toString();if("string"!==typeof t.repoInfo.host||0===t.repoInfo.host.length||!os(t.repoInfo.namespace)&&"localhost"!==t.repoInfo.host.split(":")[0]||0!==n.length&&!as(n))throw new Error((0,o.gK)(e,"url")+'must be a valid firebase URL and the path can\'t contain ".", "#", "$", "[", or "]".')},ws=function(e,t,n,r){if((!r||void 0!==n)&&"boolean"!==typeof n)throw new Error((0,o.gK)(e,t)+"must be a boolean.")},Cs=function(){function e(){this.eventLists_=[],this.recursionDepth_=0}return e}();function bs(e,t){for(var n=null,r=0;r<t.length;r++){var i=t[r],o=i.getPath();null===n||kt(o,n.path)||(e.eventLists_.push(n),n=null),null===n&&(n={events:[],path:o}),n.events.push(i)}n&&e.eventLists_.push(n)}function ks(e,t,n){bs(e,n),Is(e,(function(e){return kt(e,t)}))}function Ts(e,t,n){bs(e,n),Is(e,(function(e){return Tt(e,t)||Tt(t,e)}))}function Is(e,t){e.recursionDepth_++;for(var n=!0,r=0;r<e.eventLists_.length;r++){var i=e.eventLists_[r];if(i){var o=i.path;t(o)?(xs(e.eventLists_[r]),e.eventLists_[r]=null):n=!1}}n&&(e.eventLists_=[]),e.recursionDepth_--}function xs(e){for(var t=0;t<e.events.length;t++){var n=e.events[t];if(null!==n){e.events[t]=null;var r=n.getEventRunner();C&&T("event: "+n.toString()),G(r)}}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Ss="repo_interrupt",Ps=25,Es=function(){function e(e,t,n,r){this.repoInfo_=e,this.forceRestClient_=t,this.authTokenProvider_=n,this.appCheckProvider_=r,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new Cs,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=Xn(),this.transactionQueueTree_=new Bo,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}return e.prototype.toString=function(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host},e}();function Ds(e,t,n){if(e.stats_=ye(e.repoInfo_),e.forceRestClient_||$())e.server_=new Kn(e.repoInfo_,(function(t,n,r,i){Us(e,t,n,r,i)}),e.authTokenProvider_,e.appCheckProvider_),setTimeout((function(){return Os(e,!0)}),0);else{if("undefined"!==typeof n&&null!==n){if("object"!==typeof n)throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{(0,o.Pz)(n)}catch(r){throw new Error("Invalid authOverride provided: "+r)}}e.persistentConnection_=new Ht(e.repoInfo_,t,(function(t,n,r,i){Us(e,t,n,r,i)}),(function(t){Os(e,t)}),(function(t){Ms(e,t)}),e.authTokenProvider_,e.appCheckProvider_,n),e.server_=e.persistentConnection_}e.authTokenProvider_.addTokenChangeListener((function(t){e.server_.refreshAuthToken(t)})),e.appCheckProvider_.addTokenChangeListener((function(t){e.server_.refreshAppCheckToken(t.token)})),e.statsReporter_=me(e.repoInfo_,(function(){return new lr(e.stats_,e.server_)})),e.infoData_=new Jn,e.infoSyncTree_=new so({startListening:function(t,n,r,i){var o=[],s=e.infoData_.getNode(t._path);return s.isEmpty()||(o=co(e.infoSyncTree_,t._path,s),setTimeout((function(){i("ok")}),0)),o},stopListening:function(){}}),Ls(e,"connected",!1),e.serverSyncTree_=new so({startListening:function(t,n,r,i){return e.server_.listen(t,r,n,(function(n,r){var o=i(n,r);Ts(e.eventQueue_,t._path,o)})),[]},stopListening:function(t,n){e.server_.unlisten(t,n)}})}function Rs(e){var t=e.infoData_.getNode(new ct(".info/serverTimeOffset")),n=t.val()||0;return(new Date).getTime()+n}function Ns(e){return Lo({timestamp:Rs(e)})}function Us(e,t,n,r,i){e.dataUpdateCount++;var s=new ct(t);n=e.interceptServerDataCallback_?e.interceptServerDataCallback_(t,n):n;var a=[];if(i)if(r){var u=(0,o.UI)(n,(function(e){return Cn(e)}));a=yo(e.serverSyncTree_,s,u,i)}else{var l=Cn(n);a=vo(e.serverSyncTree_,s,l,i)}else if(r){var c=(0,o.UI)(n,(function(e){return Cn(e)}));a=ho(e.serverSyncTree_,s,c)}else{var h=Cn(n);a=co(e.serverSyncTree_,s,h)}var d=s;a.length>0&&(d=oa(e,s)),Ts(e.eventQueue_,d,a)}function As(e,t){e.interceptServerDataCallback_=t}function Os(e,t){Ls(e,"connected",t),!1===t&&js(e)}function Ms(e,t){F(t,(function(t,n){Ls(e,t,n)}))}function Ls(e,t,n){var r=new ct("/.info/"+t),i=Cn(n);e.infoData_.updateSnapshot(r,i);var o=co(e.infoSyncTree_,r,i);Ts(e.eventQueue_,r,o)}function qs(e){return e.nextWriteId_++}function Fs(e,t){var n=wo(e.serverSyncTree_,t);return null!=n?Promise.resolve(n):e.server_.get(t).then((function(n){var r=Cn(n).withIndex(t._queryParams.getIndex()),i=co(e.serverSyncTree_,t._path,r);return ks(e.eventQueue_,t._path,i),Promise.resolve(r)}),(function(n){return Xs(e,"get for query "+(0,o.Pz)(t)+" failed: "+n),Promise.reject(new Error(n))}))}function Ws(e,t,n,r,i){Xs(e,"set",{path:t.toString(),value:n,priority:r});var o=Ns(e),s=Cn(n,r),a=go(e.serverSyncTree_,t),u=jo(s,a,o),l=qs(e),c=ao(e.serverSyncTree_,t,u,l,!0);bs(e.eventQueue_,c),e.server_.put(t.toString(),s.val(!0),(function(n,r){var o="ok"===n;o||P("set at "+t+" failed: "+n);var s=lo(e.serverSyncTree_,l,!o);Ts(e.eventQueue_,t,s),ea(e,i,n,r)}));var h=ha(e,t);oa(e,h),Ts(e.eventQueue_,h,[])}function Hs(e,t,n,r){Xs(e,"update",{path:t.toString(),value:n});var i=!0,o=Ns(e),s={};if(F(n,(function(n,r){i=!1,s[n]=Ho(gt(t,n),Cn(r),e.serverSyncTree_,o)})),i)T("update() called with empty data.  Don't do anything."),ea(e,r,"ok",void 0);else{var a=qs(e),u=uo(e.serverSyncTree_,t,s,a);bs(e.eventQueue_,u),e.server_.merge(t.toString(),n,(function(n,i){var o="ok"===n;o||P("update at "+t+" failed: "+n);var s=lo(e.serverSyncTree_,a,!o),u=s.length>0?oa(e,t):t;Ts(e.eventQueue_,u,s),ea(e,r,n,i)})),F(n,(function(n){var r=ha(e,gt(t,n));oa(e,r)})),Ts(e.eventQueue_,t,[])}}function js(e){Xs(e,"onDisconnectEvents");var t=Ns(e),n=Xn();nr(e.onDisconnect_,ht(),(function(r,i){var o=Ho(r,i,e.serverSyncTree_,t);er(n,r,o)}));var r=[];nr(n,ht(),(function(t,n){r=r.concat(co(e.serverSyncTree_,t,n));var i=ha(e,t);oa(e,i)})),e.onDisconnect_=Xn(),Ts(e.eventQueue_,ht(),r)}function Zs(e,t,n){e.server_.onDisconnectCancel(t.toString(),(function(r,i){"ok"===r&&tr(e.onDisconnect_,t),ea(e,n,r,i)}))}function Bs(e,t,n,r){var i=Cn(n);e.server_.onDisconnectPut(t.toString(),i.val(!0),(function(n,o){"ok"===n&&er(e.onDisconnect_,t,i),ea(e,r,n,o)}))}function zs(e,t,n,r,i){var o=Cn(n,r);e.server_.onDisconnectPut(t.toString(),o.val(!0),(function(n,r){"ok"===n&&er(e.onDisconnect_,t,o),ea(e,i,n,r)}))}function Ys(e,t,n,r){if((0,o.xb)(n))return T("onDisconnect().update() called with empty data.  Don't do anything."),void ea(e,r,"ok",void 0);e.server_.onDisconnectMerge(t.toString(),n,(function(i,o){"ok"===i&&F(n,(function(n,r){var i=Cn(r);er(e.onDisconnect_,gt(t,n),i)})),ea(e,r,i,o)}))}function Vs(e,t,n){var r;r=".info"===dt(t._path)?mo(e.infoSyncTree_,t,n):mo(e.serverSyncTree_,t,n),ks(e.eventQueue_,t._path,r)}function Gs(e,t,n){var r;r=".info"===dt(t._path)?_o(e.infoSyncTree_,t,n):_o(e.serverSyncTree_,t,n),ks(e.eventQueue_,t._path,r)}function $s(e){e.persistentConnection_&&e.persistentConnection_.interrupt(Ss)}function Qs(e){e.persistentConnection_&&e.persistentConnection_.resume(Ss)}function Ks(e,t){if(void 0===t&&(t=!1),"undefined"!==typeof console){var n;t?(e.statsListener_||(e.statsListener_=new or(e.stats_)),n=e.statsListener_.get()):n=e.stats_.get();var r=Object.keys(n).reduce((function(e,t){return Math.max(t.length,e)}),0);F(n,(function(e,t){for(var n=e,i=e.length;i<r+2;i++)n+=" ";console.log(n+t)}))}}function Js(e,t){e.stats_.incrementCounter(t),cr(e.statsReporter_,t)}function Xs(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];var r="";e.persistentConnection_&&(r=e.persistentConnection_.id+":"),T.apply(void 0,(0,s.ev)([r],(0,s.CR)(t)))}function ea(e,t,n,r){t&&G((function(){if("ok"===n)t(null);else{var e=(n||"error").toUpperCase(),i=e;r&&(i+=": "+r);var o=new Error(i);o.code=e,t(o)}}))}function ta(e,t,n,r,i,s){Xs(e,"transaction on "+t);var a={path:t,update:n,onComplete:r,status:null,order:m(),applyLocally:s,retryCount:0,unwatcher:i,abortReason:null,currentWriteId:null,currentInputSnapshot:null,currentOutputSnapshotRaw:null,currentOutputSnapshotResolved:null},u=na(e,t,void 0);a.currentInputSnapshot=u;var l=a.update(u.val());if(void 0===l)a.unwatcher(),a.currentOutputSnapshotRaw=null,a.currentOutputSnapshotResolved=null,a.onComplete&&a.onComplete(null,!1,a.currentInputSnapshot);else{cs("transaction failed: Data returned ",l,a.path),a.status=0;var c=zo(e.transactionQueueTree_,t),h=Yo(c)||[];h.push(a),Vo(c,h);var d=void 0;if("object"===typeof l&&null!==l&&(0,o.r3)(l,".priority"))d=(0,o.DV)(l,".priority"),(0,o.hu)(us(d),"Invalid priority returned by transaction. Priority must be a valid string, finite number, server value, or null.");else{var p=go(e.serverSyncTree_,t)||yn.EMPTY_NODE;d=p.getPriority().val()}var f=Ns(e),_=Cn(l,d),v=jo(_,u,f);a.currentOutputSnapshotRaw=_,a.currentOutputSnapshotResolved=v,a.currentWriteId=qs(e);var y=ao(e.serverSyncTree_,t,v,a.currentWriteId,a.applyLocally);Ts(e.eventQueue_,t,y),ra(e,e.transactionQueueTree_)}}function na(e,t,n){return go(e.serverSyncTree_,t,n)||yn.EMPTY_NODE}function ra(e,t){if(void 0===t&&(t=e.transactionQueueTree_),t||ca(e,t),Yo(t)){var n=ua(e,t);(0,o.hu)(n.length>0,"Sending zero length transaction queue");var r=n.every((function(e){return 0===e.status}));r&&ia(e,Xo(t),n)}else Go(t)&&Qo(t,(function(t){ra(e,t)}))}function ia(e,t,n){for(var r=n.map((function(e){return e.currentWriteId})),i=na(e,t,r),s=i,a=i.hash(),u=0;u<n.length;u++){var l=n[u];(0,o.hu)(0===l.status,"tryToSendTransactionQueue_: items in queue should all be run."),l.status=1,l.retryCount++;var c=Ct(t,l.path);s=s.updateChild(c,l.currentOutputSnapshotRaw)}var h=s.val(!0),d=t;e.server_.put(d.toString(),h,(function(r){Xs(e,"transaction put response",{path:d.toString(),status:r});var i=[];if("ok"===r){for(var o=[],s=function(t){n[t].status=2,i=i.concat(lo(e.serverSyncTree_,n[t].currentWriteId)),n[t].onComplete&&o.push((function(){return n[t].onComplete(null,!0,n[t].currentOutputSnapshotResolved)})),n[t].unwatcher()},a=0;a<n.length;a++)s(a);ca(e,zo(e.transactionQueueTree_,t)),ra(e,e.transactionQueueTree_),Ts(e.eventQueue_,t,i);for(a=0;a<o.length;a++)G(o[a])}else{if("datastale"===r)for(a=0;a<n.length;a++)3===n[a].status?n[a].status=4:n[a].status=0;else{P("transaction at "+d.toString()+" failed: "+r);for(a=0;a<n.length;a++)n[a].status=4,n[a].abortReason=r}oa(e,t)}}),a)}function oa(e,t){var n=aa(e,t),r=Xo(n),i=ua(e,n);return sa(e,i,r),r}function sa(e,t,n){if(0!==t.length){for(var r=[],i=[],s=t.filter((function(e){return 0===e.status})),a=s.map((function(e){return e.currentWriteId})),u=function(s){var u,l=t[s],c=Ct(n,l.path),h=!1;if((0,o.hu)(null!==c,"rerunTransactionsUnderNode_: relativePath should not be null."),4===l.status)h=!0,u=l.abortReason,i=i.concat(lo(e.serverSyncTree_,l.currentWriteId,!0));else if(0===l.status)if(l.retryCount>=Ps)h=!0,u="maxretry",i=i.concat(lo(e.serverSyncTree_,l.currentWriteId,!0));else{var d=na(e,l.path,a);l.currentInputSnapshot=d;var p=t[s].update(d.val());if(void 0!==p){cs("transaction failed: Data returned ",p,l.path);var f=Cn(p),_="object"===typeof p&&null!=p&&(0,o.r3)(p,".priority");_||(f=f.updatePriority(d.getPriority()));var v=l.currentWriteId,y=Ns(e),m=jo(f,d,y);l.currentOutputSnapshotRaw=f,l.currentOutputSnapshotResolved=m,l.currentWriteId=qs(e),a.splice(a.indexOf(v),1),i=i.concat(ao(e.serverSyncTree_,l.path,m,l.currentWriteId,l.applyLocally)),i=i.concat(lo(e.serverSyncTree_,v,!0))}else h=!0,u="nodata",i=i.concat(lo(e.serverSyncTree_,l.currentWriteId,!0))}Ts(e.eventQueue_,n,i),i=[],h&&(t[s].status=2,function(e){setTimeout(e,Math.floor(0))}(t[s].unwatcher),t[s].onComplete&&("nodata"===u?r.push((function(){return t[s].onComplete(null,!1,t[s].currentInputSnapshot)})):r.push((function(){return t[s].onComplete(new Error(u),!1,null)}))))},l=0;l<t.length;l++)u(l);ca(e,e.transactionQueueTree_);for(l=0;l<r.length;l++)G(r[l]);ra(e,e.transactionQueueTree_)}}function aa(e,t){var n,r=e.transactionQueueTree_;n=dt(t);while(null!==n&&void 0===Yo(r))r=zo(r,n),t=ft(t),n=dt(t);return r}function ua(e,t){var n=[];return la(e,t,n),n.sort((function(e,t){return e.order-t.order})),n}function la(e,t,n){var r=Yo(t);if(r)for(var i=0;i<r.length;i++)n.push(r[i]);Qo(t,(function(t){la(e,t,n)}))}function ca(e,t){var n=Yo(t);if(n){for(var r=0,i=0;i<n.length;i++)2!==n[i].status&&(n[r]=n[i],r++);n.length=r,Vo(t,n.length>0?n:void 0)}Qo(t,(function(t){ca(e,t)}))}function ha(e,t){var n=Xo(aa(e,t)),r=zo(e.transactionQueueTree_,t);return Jo(r,(function(t){da(e,t)})),da(e,r),Ko(r,(function(t){da(e,t)})),n}function da(e,t){var n=Yo(t);if(n){for(var r=[],i=[],s=-1,a=0;a<n.length;a++)3===n[a].status||(1===n[a].status?((0,o.hu)(s===a-1,"All SENT items should be at beginning of queue."),s=a,n[a].status=3,n[a].abortReason="set"):((0,o.hu)(0===n[a].status,"Unexpected transaction status in abort"),n[a].unwatcher(),i=i.concat(lo(e.serverSyncTree_,n[a].currentWriteId,!0)),n[a].onComplete&&r.push(n[a].onComplete.bind(null,new Error("set"),!1,null))));-1===s?Vo(t,void 0):n.length=s+1,Ts(e.eventQueue_,Xo(t),i);for(a=0;a<r.length;a++)G(r[a])}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function pa(e){for(var t="",n=e.split("/"),r=0;r<n.length;r++)if(n[r].length>0){var i=n[r];try{i=decodeURIComponent(i.replace(/\+/g," "))}catch(o){}t+="/"+i}return t}function fa(e){var t,n,r={};"?"===e.charAt(0)&&(e=e.substring(1));try{for(var i=(0,s.XA)(e.split("&")),o=i.next();!o.done;o=i.next()){var a=o.value;if(0!==a.length){var u=a.split("=");2===u.length?r[decodeURIComponent(u[0])]=decodeURIComponent(u[1]):P("Invalid query segment '"+a+"' in query '"+e+"'")}}}catch(l){t={error:l}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}return r}var _a=function(e,t){var n=va(e),r=n.namespace;"firebase.com"===n.domain&&S(n.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),r&&"undefined"!==r||"localhost"===n.domain||S("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),n.secure||E();var i="ws"===n.scheme||"wss"===n.scheme;return{repoInfo:new he(n.host,n.secure,r,t,i,"",r!==n.subdomain),path:new ct(n.pathString)}},va=function(e){var t="",n="",r="",i="",o="",s=!0,a="https",u=443;if("string"===typeof e){var l=e.indexOf("//");l>=0&&(a=e.substring(0,l-1),e=e.substring(l+2));var c=e.indexOf("/");-1===c&&(c=e.length);var h=e.indexOf("?");-1===h&&(h=e.length),t=e.substring(0,Math.min(c,h)),c<h&&(i=pa(e.substring(c,h)));var d=fa(e.substring(Math.min(e.length,h)));l=t.indexOf(":"),l>=0?(s="https"===a||"wss"===a,u=parseInt(t.substring(l+1),10)):l=t.length;var p=t.slice(0,l);if("localhost"===p.toLowerCase())n="localhost";else if(p.split(".").length<=2)n=p;else{var f=t.indexOf(".");r=t.substring(0,f).toLowerCase(),n=t.substring(f+1),o=r}"ns"in d&&(o=d["ns"])}return{host:t,port:u,domain:n,subdomain:r,secure:s,scheme:a,pathString:i,namespace:o}},ya=function(){function e(e,t,n,r){this.eventType=e,this.eventRegistration=t,this.snapshot=n,this.prevName=r}return e.prototype.getPath=function(){var e=this.snapshot.ref;return"value"===this.eventType?e._path:e.parent._path},e.prototype.getEventType=function(){return this.eventType},e.prototype.getEventRunner=function(){return this.eventRegistration.getEventRunner(this)},e.prototype.toString=function(){return this.getPath().toString()+":"+this.eventType+":"+(0,o.Pz)(this.snapshot.exportVal())},e}(),ma=function(){function e(e,t,n){this.eventRegistration=e,this.error=t,this.path=n}return e.prototype.getPath=function(){return this.path},e.prototype.getEventType=function(){return"cancel"},e.prototype.getEventRunner=function(){return this.eventRegistration.getEventRunner(this)},e.prototype.toString=function(){return this.path.toString()+":cancel"},e}(),ga=function(){function e(e,t){this.snapshotCallback=e,this.cancelCallback=t}return e.prototype.onValue=function(e,t){this.snapshotCallback.call(null,e,t)},e.prototype.onCancel=function(e){return(0,o.hu)(this.hasCancelCallback,"Raising a cancel event on a listener with no cancel callback"),this.cancelCallback.call(null,e)},Object.defineProperty(e.prototype,"hasCancelCallback",{get:function(){return!!this.cancelCallback},enumerable:!1,configurable:!0}),e.prototype.matches=function(e){return this.snapshotCallback===e.snapshotCallback||void 0!==this.snapshotCallback.userCallback&&this.snapshotCallback.userCallback===e.snapshotCallback.userCallback&&this.snapshotCallback.context===e.snapshotCallback.context},e}(),wa=function(){function e(e,t){this._repo=e,this._path=t}return e.prototype.cancel=function(){var e=new o.BH;return Zs(this._repo,this._path,e.wrapCallback((function(){}))),e.promise},e.prototype.remove=function(){ms("OnDisconnect.remove",this._path);var e=new o.BH;return Bs(this._repo,this._path,null,e.wrapCallback((function(){}))),e.promise},e.prototype.set=function(e){ms("OnDisconnect.set",this._path),ls("OnDisconnect.set",e,this._path,!1);var t=new o.BH;return Bs(this._repo,this._path,e,t.wrapCallback((function(){}))),t.promise},e.prototype.setWithPriority=function(e,t){ms("OnDisconnect.setWithPriority",this._path),ls("OnDisconnect.setWithPriority",e,this._path,!1),ps("OnDisconnect.setWithPriority",t,!1);var n=new o.BH;return zs(this._repo,this._path,e,t,n.wrapCallback((function(){}))),n.promise},e.prototype.update=function(e){ms("OnDisconnect.update",this._path),ds("OnDisconnect.update",e,this._path,!1);var t=new o.BH;return Ys(this._repo,this._path,e,t.wrapCallback((function(){}))),t.promise},e}(),Ca=function(){function e(e,t,n,r){this._repo=e,this._path=t,this._queryParams=n,this._orderByCalled=r}return Object.defineProperty(e.prototype,"key",{get:function(){return wt(this._path)?null:_t(this._path)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"ref",{get:function(){return new Ia(this._repo,this._path)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"_queryIdentifier",{get:function(){var e=Qn(this._queryParams),t=L(e);return"{}"===t?"default":t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"_queryObject",{get:function(){return Qn(this._queryParams)},enumerable:!1,configurable:!0}),e.prototype.isEqual=function(t){if(t=(0,o.m9)(t),!(t instanceof e))return!1;var n=this._repo===t._repo,r=kt(this._path,t._path),i=this._queryIdentifier===t._queryIdentifier;return n&&r&&i},e.prototype.toJSON=function(){return this.toString()},e.prototype.toString=function(){return this._repo.toString()+vt(this._path)},e}();function ba(e,t){if(!0===e._orderByCalled)throw new Error(t+": You can't combine multiple orderBy calls.")}function ka(e){var t=null,n=null;if(e.hasStart()&&(t=e.getIndexStartValue()),e.hasEnd()&&(n=e.getIndexEndValue()),e.getIndex()===zt){var r="Query: When ordering by key, you may only pass one argument to startAt(), endAt(), or equalTo().",i="Query: When ordering by key, the argument passed to startAt(), startAfter(), endAt(), endBefore(), or equalTo() must be a string.";if(e.hasStart()){var s=e.getIndexStartName();if(s!==N)throw new Error(r);if("string"!==typeof t)throw new Error(i)}if(e.hasEnd()){var a=e.getIndexEndName();if(a!==U)throw new Error(r);if("string"!==typeof n)throw new Error(i)}}else if(e.getIndex()===hn){if(null!=t&&!us(t)||null!=n&&!us(n))throw new Error("Query: When ordering by priority, the first argument passed to startAt(), startAfter() endAt(), endBefore(), or equalTo() must be a valid priority value (null, a number, or a string).")}else if((0,o.hu)(e.getIndex()instanceof bn||e.getIndex()===Tn,"unknown index type."),null!=t&&"object"===typeof t||null!=n&&"object"===typeof n)throw new Error("Query: First argument passed to startAt(), startAfter(), endAt(), endBefore(), or equalTo() cannot be an object.")}function Ta(e){if(e.hasStart()&&e.hasEnd()&&e.hasLimit()&&!e.hasAnchoredLimit())throw new Error("Query: Can't combine startAt(), startAfter(), endAt(), endBefore(), and limit(). Use limitToFirst() or limitToLast() instead.")}var Ia=function(e){function t(t,n){return e.call(this,t,n,new Wn,!1)||this}return(0,s.ZT)(t,e),Object.defineProperty(t.prototype,"parent",{get:function(){var e=mt(this._path);return null===e?null:new t(this._repo,e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"root",{get:function(){var e=this;while(null!==e.parent)e=e.parent;return e},enumerable:!1,configurable:!0}),t}(Ca),xa=function(){function e(e,t,n){this._node=e,this.ref=t,this._index=n}return Object.defineProperty(e.prototype,"priority",{get:function(){return this._node.getPriority().val()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"key",{get:function(){return this.ref.key},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"size",{get:function(){return this._node.numChildren()},enumerable:!1,configurable:!0}),e.prototype.child=function(t){var n=new ct(t),r=Ea(this.ref,t);return new e(this._node.getChild(n),r,hn)},e.prototype.exists=function(){return!this._node.isEmpty()},e.prototype.exportVal=function(){return this._node.val(!0)},e.prototype.forEach=function(t){var n=this;if(this._node.isLeafNode())return!1;var r=this._node;return!!r.forEachChild(this._index,(function(r,i){return t(new e(i,Ea(n.ref,r),hn))}))},e.prototype.hasChild=function(e){var t=new ct(e);return!this._node.getChild(t).isEmpty()},e.prototype.hasChildren=function(){return!this._node.isLeafNode()&&!this._node.isEmpty()},e.prototype.toJSON=function(){return this.exportVal()},e.prototype.val=function(){return this._node.val()},e}();function Sa(e,t){return e=(0,o.m9)(e),e._checkNotDeleted("ref"),void 0!==t?Ea(e._root,t):e._root}function Pa(e,t){e=(0,o.m9)(e),e._checkNotDeleted("refFromURL");var n=_a(t,e._repo.repoInfo_.nodeAdmin);gs("refFromURL",n);var r=n.repoInfo;return e._repo.repoInfo_.isCustomHost()||r.host===e._repo.repoInfo_.host||S("refFromURL: Host name does not match the current database: (found "+r.host+" but expected "+e._repo.repoInfo_.host+")"),Sa(e,n.path.toString())}function Ea(e,t){return e=(0,o.m9)(e),null===dt(e._path)?ys("child","path",t,!1):vs("child","path",t,!1),new Ia(e._repo,gt(e._path,t))}function Da(e,t){e=(0,o.m9)(e),ms("push",e._path),ls("push",t,e._path,!0);var n,r=Rs(e._repo),i=En(r),s=Ea(e,i),a=Ea(e,i);return n=null!=t?Na(a,t).then((function(){return a})):Promise.resolve(a),s.then=n.then.bind(n),s.catch=n.then.bind(n,void 0),s}function Ra(e){return ms("remove",e._path),Na(e,null)}function Na(e,t){e=(0,o.m9)(e),ms("set",e._path),ls("set",t,e._path,!1);var n=new o.BH;return Ws(e._repo,e._path,t,null,n.wrapCallback((function(){}))),n.promise}function Ua(e,t){e=(0,o.m9)(e),ms("setPriority",e._path),ps("setPriority",t,!1);var n=new o.BH;return Ws(e._repo,gt(e._path,".priority"),t,null,n.wrapCallback((function(){}))),n.promise}function Aa(e,t,n){if(ms("setWithPriority",e._path),ls("setWithPriority",t,e._path,!1),ps("setWithPriority",n,!1),".length"===e.key||".keys"===e.key)throw"setWithPriority failed: "+e.key+" is a read-only object.";var r=new o.BH;return Ws(e._repo,e._path,t,n,r.wrapCallback((function(){}))),r.promise}function Oa(e,t){ds("update",t,e._path,!1);var n=new o.BH;return Hs(e._repo,e._path,t,n.wrapCallback((function(){}))),n.promise}function Ma(e){return e=(0,o.m9)(e),Fs(e._repo,e).then((function(t){return new xa(t,new Ia(e._repo,e._path),e._queryParams.getIndex())}))}var La=function(){function e(e){this.callbackContext=e}return e.prototype.respondsTo=function(e){return"value"===e},e.prototype.createEvent=function(e,t){var n=t._queryParams.getIndex();return new ya("value",this,new xa(e.snapshotNode,new Ia(t._repo,t._path),n))},e.prototype.getEventRunner=function(e){var t=this;return"cancel"===e.getEventType()?function(){return t.callbackContext.onCancel(e.error)}:function(){return t.callbackContext.onValue(e.snapshot,null)}},e.prototype.createCancelEvent=function(e,t){return this.callbackContext.hasCancelCallback?new ma(this,e,t):null},e.prototype.matches=function(t){return t instanceof e&&(!t.callbackContext||!this.callbackContext||t.callbackContext.matches(this.callbackContext))},e.prototype.hasAnyCallback=function(){return null!==this.callbackContext},e}(),qa=function(){function e(e,t){this.eventType=e,this.callbackContext=t}return e.prototype.respondsTo=function(e){var t="children_added"===e?"child_added":e;return t="children_removed"===t?"child_removed":t,this.eventType===t},e.prototype.createCancelEvent=function(e,t){return this.callbackContext.hasCancelCallback?new ma(this,e,t):null},e.prototype.createEvent=function(e,t){(0,o.hu)(null!=e.childName,"Child events should have a childName.");var n=Ea(new Ia(t._repo,t._path),e.childName),r=t._queryParams.getIndex();return new ya(e.type,this,new xa(e.snapshotNode,n,r),e.prevName)},e.prototype.getEventRunner=function(e){var t=this;return"cancel"===e.getEventType()?function(){return t.callbackContext.onCancel(e.error)}:function(){return t.callbackContext.onValue(e.snapshot,e.prevName)}},e.prototype.matches=function(t){return t instanceof e&&(this.eventType===t.eventType&&(!this.callbackContext||!t.callbackContext||this.callbackContext.matches(t.callbackContext)))},e.prototype.hasAnyCallback=function(){return!!this.callbackContext},e}();function Fa(e,t,n,r,i){var o;if("object"===typeof r&&(o=void 0,i=r),"function"===typeof r&&(o=r),i&&i.onlyOnce){var s=n,a=function(t,n){Gs(e._repo,e,l),s(t,n)};a.userCallback=n.userCallback,a.context=n.context,n=a}var u=new ga(n,o||void 0),l="value"===t?new La(u):new qa(t,u);return Vs(e._repo,e,l),function(){return Gs(e._repo,e,l)}}function Wa(e,t,n,r){return Fa(e,"value",t,n,r)}function Ha(e,t,n,r){return Fa(e,"child_added",t,n,r)}function ja(e,t,n,r){return Fa(e,"child_changed",t,n,r)}function Za(e,t,n,r){return Fa(e,"child_moved",t,n,r)}function Ba(e,t,n,r){return Fa(e,"child_removed",t,n,r)}function za(e,t,n){var r=null,i=n?new ga(n):null;"value"===t?r=new La(i):t&&(r=new qa(t,i)),Gs(e._repo,e,r)}var Ya=function(){function e(){}return e}(),Va=function(e){function t(t,n){var r=e.call(this)||this;return r._value=t,r._key=n,r}return(0,s.ZT)(t,e),t.prototype._apply=function(e){ls("endAt",this._value,e._path,!0);var t=Yn(e._queryParams,this._value,this._key);if(Ta(t),ka(t),e._queryParams.hasEnd())throw new Error("endAt: Starting point was already set (by another call to endAt, endBefore or equalTo).");return new Ca(e._repo,e._path,t,e._orderByCalled)},t}(Ya);function Ga(e,t){return _s("endAt","key",t,!0),new Va(e,t)}var $a=function(e){function t(t,n){var r=e.call(this)||this;return r._value=t,r._key=n,r}return(0,s.ZT)(t,e),t.prototype._apply=function(e){ls("endBefore",this._value,e._path,!1);var t=Vn(e._queryParams,this._value,this._key);if(Ta(t),ka(t),e._queryParams.hasEnd())throw new Error("endBefore: Starting point was already set (by another call to endAt, endBefore or equalTo).");return new Ca(e._repo,e._path,t,e._orderByCalled)},t}(Ya);function Qa(e,t){return _s("endBefore","key",t,!0),new $a(e,t)}var Ka=function(e){function t(t,n){var r=e.call(this)||this;return r._value=t,r._key=n,r}return(0,s.ZT)(t,e),t.prototype._apply=function(e){ls("startAt",this._value,e._path,!0);var t=Bn(e._queryParams,this._value,this._key);if(Ta(t),ka(t),e._queryParams.hasStart())throw new Error("startAt: Starting point was already set (by another call to startAt, startBefore or equalTo).");return new Ca(e._repo,e._path,t,e._orderByCalled)},t}(Ya);function Ja(e,t){return void 0===e&&(e=null),_s("startAt","key",t,!0),new Ka(e,t)}var Xa=function(e){function t(t,n){var r=e.call(this)||this;return r._value=t,r._key=n,r}return(0,s.ZT)(t,e),t.prototype._apply=function(e){ls("startAfter",this._value,e._path,!1);var t=zn(e._queryParams,this._value,this._key);if(Ta(t),ka(t),e._queryParams.hasStart())throw new Error("startAfter: Starting point was already set (by another call to startAt, startAfter, or equalTo).");return new Ca(e._repo,e._path,t,e._orderByCalled)},t}(Ya);function eu(e,t){return _s("startAfter","key",t,!0),new Xa(e,t)}var tu=function(e){function t(t){var n=e.call(this)||this;return n._limit=t,n}return(0,s.ZT)(t,e),t.prototype._apply=function(e){if(e._queryParams.hasLimit())throw new Error("limitToFirst: Limit was already set (by another call to limitToFirst or limitToLast).");return new Ca(e._repo,e._path,jn(e._queryParams,this._limit),e._orderByCalled)},t}(Ya);function nu(e){if("number"!==typeof e||Math.floor(e)!==e||e<=0)throw new Error("limitToFirst: First argument must be a positive integer.");return new tu(e)}var ru=function(e){function t(t){var n=e.call(this)||this;return n._limit=t,n}return(0,s.ZT)(t,e),t.prototype._apply=function(e){if(e._queryParams.hasLimit())throw new Error("limitToLast: Limit was already set (by another call to limitToFirst or limitToLast).");return new Ca(e._repo,e._path,Zn(e._queryParams,this._limit),e._orderByCalled)},t}(Ya);function iu(e){if("number"!==typeof e||Math.floor(e)!==e||e<=0)throw new Error("limitToLast: First argument must be a positive integer.");return new ru(e)}var ou=function(e){function t(t){var n=e.call(this)||this;return n._path=t,n}return(0,s.ZT)(t,e),t.prototype._apply=function(e){ba(e,"orderByChild");var t=new ct(this._path);if(wt(t))throw new Error("orderByChild: cannot pass in empty path. Use orderByValue() instead.");var n=new bn(t),r=Gn(e._queryParams,n);return ka(r),new Ca(e._repo,e._path,r,!0)},t}(Ya);function su(e){if("$key"===e)throw new Error('orderByChild: "$key" is invalid.  Use orderByKey() instead.');if("$priority"===e)throw new Error('orderByChild: "$priority" is invalid.  Use orderByPriority() instead.');if("$value"===e)throw new Error('orderByChild: "$value" is invalid.  Use orderByValue() instead.');return vs("orderByChild","path",e,!1),new ou(e)}var au=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return(0,s.ZT)(t,e),t.prototype._apply=function(e){ba(e,"orderByKey");var t=Gn(e._queryParams,zt);return ka(t),new Ca(e._repo,e._path,t,!0)},t}(Ya);function uu(){return new au}var lu=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return(0,s.ZT)(t,e),t.prototype._apply=function(e){ba(e,"orderByPriority");var t=Gn(e._queryParams,hn);return ka(t),new Ca(e._repo,e._path,t,!0)},t}(Ya);function cu(){return new lu}var hu=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return(0,s.ZT)(t,e),t.prototype._apply=function(e){ba(e,"orderByValue");var t=Gn(e._queryParams,Tn);return ka(t),new Ca(e._repo,e._path,t,!0)},t}(Ya);function du(){return new hu}var pu=function(e){function t(t,n){var r=e.call(this)||this;return r._value=t,r._key=n,r}return(0,s.ZT)(t,e),t.prototype._apply=function(e){if(ls("equalTo",this._value,e._path,!1),e._queryParams.hasStart())throw new Error("equalTo: Starting point was already set (by another call to startAt/startAfter or equalTo).");if(e._queryParams.hasEnd())throw new Error("equalTo: Ending point was already set (by another call to endAt/endBefore or equalTo).");return new Va(this._value,this._key)._apply(new Ka(this._value,this._key)._apply(e))},t}(Ya);function fu(e,t){return _s("equalTo","key",t,!0),new pu(e,t)}function _u(e){for(var t,n,r=[],i=1;i<arguments.length;i++)r[i-1]=arguments[i];var a=(0,o.m9)(e);try{for(var u=(0,s.XA)(r),l=u.next();!l.done;l=u.next()){var c=l.value;a=c._apply(a)}}catch(h){t={error:h}}finally{try{l&&!l.done&&(n=u.return)&&n.call(u)}finally{if(t)throw t.error}}return a}Bi(Ia),ro(Ia);
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var vu="FIREBASE_DATABASE_EMULATOR_HOST",yu={},mu=!1;function gu(e,t,n,r){e.repoInfo_=new he(t+":"+n,!1,e.repoInfo_.namespace,e.repoInfo_.webSocketOnly,e.repoInfo_.nodeAdmin,e.repoInfo_.persistenceKey,e.repoInfo_.includeNamespaceInQueryParams),r&&(e.authTokenProvider_=r)}function wu(e,t,n,r,i){var o=r||e.options.databaseURL;void 0===o&&(e.options.projectId||S("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),T("Using default host for project ",e.options.projectId),o=e.options.projectId+"-default-rtdb.firebaseio.com");var s,a=_a(o,i),u=a.repoInfo,l=void 0;"undefined"!==typeof process&&(l={NODE_ENV:"production",BASE_URL:"/"}[vu]),l?(s=!0,o="http://"+l+"?ns="+u.namespace,a=_a(o,i),u=a.repoInfo):s=!a.repoInfo.secure;var c=i&&s?new X(X.OWNER):new J(e.name,e.options,t);gs("Invalid Firebase Database URL",a),wt(a.path)||S("Database URL must point to the root of a Firebase Database (not including a child path).");var h=bu(u,e,c,new K(e.name,n));return new Tu(h,e)}function Cu(e,t){var n=yu[t];n&&n[e.key]===e||S("Database "+t+"("+e.repoInfo_+") has already been deleted."),$s(e),delete n[e.key]}function bu(e,t,n,r){var i=yu[t.name];i||(i={},yu[t.name]=i);var o=i[e.toURLString()];return o&&S("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),o=new Es(e,mu,n,r),i[e.toURLString()]=o,o}function ku(e){mu=e}var Tu=function(){function e(e,t){this._repoInternal=e,this.app=t,this["type"]="database",this._instanceStarted=!1}return Object.defineProperty(e.prototype,"_repo",{get:function(){return this._instanceStarted||(Ds(this._repoInternal,this.app.options.appId,this.app.options["databaseAuthVariableOverride"]),this._instanceStarted=!0),this._repoInternal},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"_root",{get:function(){return this._rootInternal||(this._rootInternal=new Ia(this._repo,ht())),this._rootInternal},enumerable:!1,configurable:!0}),e.prototype._delete=function(){return null!==this._rootInternal&&(Cu(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()},e.prototype._checkNotDeleted=function(e){null===this._rootInternal&&S("Cannot call "+e+" on a deleted database.")},e}();function Iu(e,t,n,r){void 0===r&&(r={}),e=(0,o.m9)(e),e._checkNotDeleted("useEmulator"),e._instanceStarted&&S("Cannot call useEmulator() after instance has already been initialized.");var i=e._repoInternal,s=void 0;if(i.repoInfo_.nodeAdmin)r.mockUserToken&&S('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),s=new X(X.OWNER);else if(r.mockUserToken){var a="string"===typeof r.mockUserToken?r.mockUserToken:(0,o.Sg)(r.mockUserToken,e.app.options.projectId);s=new X(a)}gu(i,t,n,s)}function xu(e){e=(0,o.m9)(e),e._checkNotDeleted("goOffline"),$s(e._repo)}function Su(e){e=(0,o.m9)(e),e._checkNotDeleted("goOnline"),Qs(e._repo)}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Pu={".sv":"timestamp"};function Eu(){return Pu}function Du(e){return{".sv":{increment:e}}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Ru=function(){function e(e,t){this.committed=e,this.snapshot=t}return e.prototype.toJSON=function(){return{committed:this.committed,snapshot:this.snapshot.toJSON()}},e}();function Nu(e,t,n){var r;if(e=(0,o.m9)(e),ms("Reference.transaction",e._path),".length"===e.key||".keys"===e.key)throw"Reference.transaction failed: "+e.key+" is a read-only object.";var i=null===(r=null===n||void 0===n?void 0:n.applyLocally)||void 0===r||r,s=new o.BH,a=function(t,n,r){var i=null;t?s.reject(t):(i=new xa(r,new Ia(e._repo,e._path),hn),s.resolve(new Ru(n,i)))},u=Wa(e,(function(){}));return ta(e._repo,e._path,t,a,u,i),s.promise}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Uu=function(){function e(e){this._delegate=e}return e.prototype.cancel=function(e){(0,o.Dv)("OnDisconnect.cancel",0,1,arguments.length),(0,o.Wj)("OnDisconnect.cancel","onComplete",e,!0);var t=this._delegate.cancel();return e&&t.then((function(){return e(null)}),(function(t){return e(t)})),t},e.prototype.remove=function(e){(0,o.Dv)("OnDisconnect.remove",0,1,arguments.length),(0,o.Wj)("OnDisconnect.remove","onComplete",e,!0);var t=this._delegate.remove();return e&&t.then((function(){return e(null)}),(function(t){return e(t)})),t},e.prototype.set=function(e,t){(0,o.Dv)("OnDisconnect.set",1,2,arguments.length),(0,o.Wj)("OnDisconnect.set","onComplete",t,!0);var n=this._delegate.set(e);return t&&n.then((function(){return t(null)}),(function(e){return t(e)})),n},e.prototype.setWithPriority=function(e,t,n){(0,o.Dv)("OnDisconnect.setWithPriority",2,3,arguments.length),(0,o.Wj)("OnDisconnect.setWithPriority","onComplete",n,!0);var r=this._delegate.setWithPriority(e,t);return n&&r.then((function(){return n(null)}),(function(e){return n(e)})),r},e.prototype.update=function(e,t){if((0,o.Dv)("OnDisconnect.update",1,2,arguments.length),Array.isArray(e)){for(var n={},r=0;r<e.length;++r)n[""+r]=e[r];e=n,P("Passing an Array to firebase.database.onDisconnect().update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}(0,o.Wj)("OnDisconnect.update","onComplete",t,!0);var i=this._delegate.update(e);return t&&i.then((function(){return t(null)}),(function(e){return t(e)})),i},e}(),Au=function(){function e(e,t){this.committed=e,this.snapshot=t}return e.prototype.toJSON=function(){return(0,o.Dv)("TransactionResult.toJSON",0,1,arguments.length),{committed:this.committed,snapshot:this.snapshot.toJSON()}},e}(),Ou=function(){function e(e,t){this._database=e,this._delegate=t}return e.prototype.val=function(){return(0,o.Dv)("DataSnapshot.val",0,0,arguments.length),this._delegate.val()},e.prototype.exportVal=function(){return(0,o.Dv)("DataSnapshot.exportVal",0,0,arguments.length),this._delegate.exportVal()},e.prototype.toJSON=function(){return(0,o.Dv)("DataSnapshot.toJSON",0,1,arguments.length),this._delegate.toJSON()},e.prototype.exists=function(){return(0,o.Dv)("DataSnapshot.exists",0,0,arguments.length),this._delegate.exists()},e.prototype.child=function(t){return(0,o.Dv)("DataSnapshot.child",0,1,arguments.length),t=String(t),vs("DataSnapshot.child","path",t,!1),new e(this._database,this._delegate.child(t))},e.prototype.hasChild=function(e){return(0,o.Dv)("DataSnapshot.hasChild",1,1,arguments.length),vs("DataSnapshot.hasChild","path",e,!1),this._delegate.hasChild(e)},e.prototype.getPriority=function(){return(0,o.Dv)("DataSnapshot.getPriority",0,0,arguments.length),this._delegate.priority},e.prototype.forEach=function(t){var n=this;return(0,o.Dv)("DataSnapshot.forEach",1,1,arguments.length),(0,o.Wj)("DataSnapshot.forEach","action",t,!1),this._delegate.forEach((function(r){return t(new e(n._database,r))}))},e.prototype.hasChildren=function(){return(0,o.Dv)("DataSnapshot.hasChildren",0,0,arguments.length),this._delegate.hasChildren()},Object.defineProperty(e.prototype,"key",{get:function(){return this._delegate.key},enumerable:!1,configurable:!0}),e.prototype.numChildren=function(){return(0,o.Dv)("DataSnapshot.numChildren",0,0,arguments.length),this._delegate.size},e.prototype.getRef=function(){return(0,o.Dv)("DataSnapshot.ref",0,0,arguments.length),new Lu(this._database,this._delegate.ref)},Object.defineProperty(e.prototype,"ref",{get:function(){return this.getRef()},enumerable:!1,configurable:!0}),e}(),Mu=function(){function e(e,t){this.database=e,this._delegate=t}return e.prototype.on=function(t,n,r,i){var s,a=this;(0,o.Dv)("Query.on",2,4,arguments.length),(0,o.Wj)("Query.on","callback",n,!1);var u=e.getCancelAndContextArgs_("Query.on",r,i),l=function(e,t){n.call(u.context,new Ou(a.database,e),t)};l.userCallback=n,l.context=u.context;var c=null===(s=u.cancel)||void 0===s?void 0:s.bind(u.context);switch(t){case"value":return Wa(this._delegate,l,c),n;case"child_added":return Ha(this._delegate,l,c),n;case"child_removed":return Ba(this._delegate,l,c),n;case"child_changed":return ja(this._delegate,l,c),n;case"child_moved":return Za(this._delegate,l,c),n;default:throw new Error((0,o.gK)("Query.on","eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}},e.prototype.off=function(e,t,n){if((0,o.Dv)("Query.off",0,3,arguments.length),fs("Query.off",e,!0),(0,o.Wj)("Query.off","callback",t,!0),(0,o.lb)("Query.off","context",n,!0),t){var r=function(){};r.userCallback=t,r.context=n,za(this._delegate,e,r)}else za(this._delegate,e)},e.prototype.get=function(){var e=this;return Ma(this._delegate).then((function(t){return new Ou(e.database,t)}))},e.prototype.once=function(t,n,r,i){var s=this;(0,o.Dv)("Query.once",1,4,arguments.length),(0,o.Wj)("Query.once","callback",n,!0);var a=e.getCancelAndContextArgs_("Query.once",r,i),u=new o.BH,l=function(e,t){var r=new Ou(s.database,e);n&&n.call(a.context,r,t),u.resolve(r)};l.userCallback=n,l.context=a.context;var c=function(e){a.cancel&&a.cancel.call(a.context,e),u.reject(e)};switch(t){case"value":Wa(this._delegate,l,c,{onlyOnce:!0});break;case"child_added":Ha(this._delegate,l,c,{onlyOnce:!0});break;case"child_removed":Ba(this._delegate,l,c,{onlyOnce:!0});break;case"child_changed":ja(this._delegate,l,c,{onlyOnce:!0});break;case"child_moved":Za(this._delegate,l,c,{onlyOnce:!0});break;default:throw new Error((0,o.gK)("Query.once","eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}return u.promise},e.prototype.limitToFirst=function(t){return(0,o.Dv)("Query.limitToFirst",1,1,arguments.length),new e(this.database,_u(this._delegate,nu(t)))},e.prototype.limitToLast=function(t){return(0,o.Dv)("Query.limitToLast",1,1,arguments.length),new e(this.database,_u(this._delegate,iu(t)))},e.prototype.orderByChild=function(t){return(0,o.Dv)("Query.orderByChild",1,1,arguments.length),new e(this.database,_u(this._delegate,su(t)))},e.prototype.orderByKey=function(){return(0,o.Dv)("Query.orderByKey",0,0,arguments.length),new e(this.database,_u(this._delegate,uu()))},e.prototype.orderByPriority=function(){return(0,o.Dv)("Query.orderByPriority",0,0,arguments.length),new e(this.database,_u(this._delegate,cu()))},e.prototype.orderByValue=function(){return(0,o.Dv)("Query.orderByValue",0,0,arguments.length),new e(this.database,_u(this._delegate,du()))},e.prototype.startAt=function(t,n){return void 0===t&&(t=null),(0,o.Dv)("Query.startAt",0,2,arguments.length),new e(this.database,_u(this._delegate,Ja(t,n)))},e.prototype.startAfter=function(t,n){return void 0===t&&(t=null),(0,o.Dv)("Query.startAfter",0,2,arguments.length),new e(this.database,_u(this._delegate,eu(t,n)))},e.prototype.endAt=function(t,n){return void 0===t&&(t=null),(0,o.Dv)("Query.endAt",0,2,arguments.length),new e(this.database,_u(this._delegate,Ga(t,n)))},e.prototype.endBefore=function(t,n){return void 0===t&&(t=null),(0,o.Dv)("Query.endBefore",0,2,arguments.length),new e(this.database,_u(this._delegate,Qa(t,n)))},e.prototype.equalTo=function(t,n){return(0,o.Dv)("Query.equalTo",1,2,arguments.length),new e(this.database,_u(this._delegate,fu(t,n)))},e.prototype.toString=function(){return(0,o.Dv)("Query.toString",0,0,arguments.length),this._delegate.toString()},e.prototype.toJSON=function(){return(0,o.Dv)("Query.toJSON",0,1,arguments.length),this._delegate.toJSON()},e.prototype.isEqual=function(t){if((0,o.Dv)("Query.isEqual",1,1,arguments.length),!(t instanceof e)){var n="Query.isEqual failed: First argument must be an instance of firebase.database.Query.";throw new Error(n)}return this._delegate.isEqual(t._delegate)},e.getCancelAndContextArgs_=function(e,t,n){var r={cancel:void 0,context:void 0};if(t&&n)r.cancel=t,(0,o.Wj)(e,"cancel",r.cancel,!0),r.context=n,(0,o.lb)(e,"context",r.context,!0);else if(t)if("object"===typeof t&&null!==t)r.context=t;else{if("function"!==typeof t)throw new Error((0,o.gK)(e,"cancelOrContext")+" must either be a cancel callback or a context object.");r.cancel=t}return r},Object.defineProperty(e.prototype,"ref",{get:function(){return new Lu(this.database,new Ia(this._delegate._repo,this._delegate._path))},enumerable:!1,configurable:!0}),e}(),Lu=function(e){function t(t,n){var r=e.call(this,t,new Ca(n._repo,n._path,new Wn,!1))||this;return r.database=t,r._delegate=n,r}return(0,s.ZT)(t,e),t.prototype.getKey=function(){return(0,o.Dv)("Reference.key",0,0,arguments.length),this._delegate.key},t.prototype.child=function(e){return(0,o.Dv)("Reference.child",1,1,arguments.length),"number"===typeof e&&(e=String(e)),new t(this.database,Ea(this._delegate,e))},t.prototype.getParent=function(){(0,o.Dv)("Reference.parent",0,0,arguments.length);var e=this._delegate.parent;return e?new t(this.database,e):null},t.prototype.getRoot=function(){return(0,o.Dv)("Reference.root",0,0,arguments.length),new t(this.database,this._delegate.root)},t.prototype.set=function(e,t){(0,o.Dv)("Reference.set",1,2,arguments.length),(0,o.Wj)("Reference.set","onComplete",t,!0);var n=Na(this._delegate,e);return t&&n.then((function(){return t(null)}),(function(e){return t(e)})),n},t.prototype.update=function(e,t){if((0,o.Dv)("Reference.update",1,2,arguments.length),Array.isArray(e)){for(var n={},r=0;r<e.length;++r)n[""+r]=e[r];e=n,P("Passing an Array to Firebase.update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}ms("Reference.update",this._delegate._path),(0,o.Wj)("Reference.update","onComplete",t,!0);var i=Oa(this._delegate,e);return t&&i.then((function(){return t(null)}),(function(e){return t(e)})),i},t.prototype.setWithPriority=function(e,t,n){(0,o.Dv)("Reference.setWithPriority",2,3,arguments.length),(0,o.Wj)("Reference.setWithPriority","onComplete",n,!0);var r=Aa(this._delegate,e,t);return n&&r.then((function(){return n(null)}),(function(e){return n(e)})),r},t.prototype.remove=function(e){(0,o.Dv)("Reference.remove",0,1,arguments.length),(0,o.Wj)("Reference.remove","onComplete",e,!0);var t=Ra(this._delegate);return e&&t.then((function(){return e(null)}),(function(t){return e(t)})),t},t.prototype.transaction=function(e,t,n){var r=this;(0,o.Dv)("Reference.transaction",1,3,arguments.length),(0,o.Wj)("Reference.transaction","transactionUpdate",e,!1),(0,o.Wj)("Reference.transaction","onComplete",t,!0),ws("Reference.transaction","applyLocally",n,!0);var i=Nu(this._delegate,e,{applyLocally:n}).then((function(e){return new Au(e.committed,new Ou(r.database,e.snapshot))}));return t&&i.then((function(e){return t(null,e.committed,e.snapshot)}),(function(e){return t(e,!1,null)})),i},t.prototype.setPriority=function(e,t){(0,o.Dv)("Reference.setPriority",1,2,arguments.length),(0,o.Wj)("Reference.setPriority","onComplete",t,!0);var n=Ua(this._delegate,e);return t&&n.then((function(){return t(null)}),(function(e){return t(e)})),n},t.prototype.push=function(e,n){var r=this;(0,o.Dv)("Reference.push",0,2,arguments.length),(0,o.Wj)("Reference.push","onComplete",n,!0);var i=Da(this._delegate,e),s=i.then((function(e){return new t(r.database,e)}));n&&s.then((function(){return n(null)}),(function(e){return n(e)}));var a=new t(this.database,i);return a.then=s.then.bind(s),a.catch=s.catch.bind(s,void 0),a},t.prototype.onDisconnect=function(){return ms("Reference.onDisconnect",this._delegate._path),new Uu(new wa(this._delegate._repo,this._delegate._path))},Object.defineProperty(t.prototype,"key",{get:function(){return this.getKey()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"parent",{get:function(){return this.getParent()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"root",{get:function(){return this.getRoot()},enumerable:!1,configurable:!0}),t}(Mu),qu=function(){function e(e,t){var n=this;this._delegate=e,this.app=t,this.INTERNAL={delete:function(){return n._delegate._delete()}}}return e.prototype.useEmulator=function(e,t,n){void 0===n&&(n={}),Iu(this._delegate,e,t,n)},e.prototype.ref=function(e){if((0,o.Dv)("database.ref",0,1,arguments.length),e instanceof Lu){var t=Pa(this._delegate,e.toString());return new Lu(this,t)}t=Sa(this._delegate,e);return new Lu(this,t)},e.prototype.refFromURL=function(e){var t="database.refFromURL";(0,o.Dv)(t,1,1,arguments.length);var n=Pa(this._delegate,e);return new Lu(this,n)},e.prototype.goOffline=function(){return(0,o.Dv)("database.goOffline",0,0,arguments.length),xu(this._delegate)},e.prototype.goOnline=function(){return(0,o.Dv)("database.goOnline",0,0,arguments.length),Su(this._delegate)},e.ServerValue={TIMESTAMP:Eu(),increment:function(e){return Du(e)}},e}(),Fu=function(){je.forceDisallow(),Le.forceAllow()},Wu=function(){Le.forceDisallow()},Hu=function(){return je["isAvailable"]()},ju=function(e,t){var n=e._delegate._repo.persistentConnection_;n.securityDebugCallback_=t},Zu=function(e,t){Ks(e._delegate._repo,t)},Bu=function(e,t){Js(e._delegate._repo,t)},zu=function(e){return e._delegate._repo.dataUpdateCount},Yu=function(e,t){return As(e._delegate._repo,t)};
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Vu(e){var t=e.app,n=e.url,r=e.version,o=e.customAuthImpl,s=e.namespace,a=e.nodeAdmin,u=void 0!==a&&a;h(r);var l=new i.zt("auth-internal",new i.H0("database-standalone"));return l.setComponent(new i.wA("auth-internal",(function(){return o}),"PRIVATE")),{instance:new qu(wu(t,l,void 0,n,u),t),namespace:s}}var Gu=Object.freeze({__proto__:null,forceLongPolling:Fu,forceWebSockets:Wu,isWebSocketsAvailable:Hu,setSecurityDebugCallback:ju,stats:Zu,statsIncrementCounter:Bu,dataUpdateCount:zu,interceptServerData:Yu,initStandalone:Vu}),$u=Ht;
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Ht.prototype.simpleListen=function(e,t){this.sendRequest("q",{p:e},t)},Ht.prototype.echo=function(e,t){this.sendRequest("echo",{d:e},t)};var Qu=it,Ku=function(e){var t=Ht.prototype.put;return Ht.prototype.put=function(n,r,i,o){void 0!==o&&(o=e()),t.call(this,n,r,i,o)},function(){Ht.prototype.put=t}},Ju=he,Xu=function(e){return e._delegate._queryIdentifier},el=function(e){ku(e)},tl=Object.freeze({__proto__:null,DataConnection:$u,RealTimeConnection:Qu,hijackHash:Ku,ConnectionTarget:Ju,queryIdentifier:Xu,forceRestClient:el}),nl=qu.ServerValue;function rl(t){h(t.SDK_VERSION);var n=t.INTERNAL.registerComponent(new i.wA("database",(function(e,t){var n=t.instanceIdentifier,r=e.getProvider("app").getImmediate(),i=e.getProvider("auth-internal"),o=e.getProvider("app-check-internal");return new qu(wu(r,i,o,n),r)}),"PUBLIC").setServiceProps({Reference:Lu,Query:Mu,Database:qu,DataSnapshot:Ou,enableLogging:k,INTERNAL:Gu,ServerValue:nl,TEST_ACCESS:tl}).setMultipleInstances(!0));t.registerVersion(u,l),(0,o.Yr)()&&(e.exports=n)}rl(r.Z)},355:function(e,t,n){n.d(t,{Z:function(){return f}});var r=n(6252),i=n(3577);function o(e,t,n,o,s,a){var u=(0,r.up)("ps-label-title"),l=(0,r.up)("ps-label"),c=(0,r.up)("ps-modal");return(0,r.wg)(),(0,r.j4)(c,{ref:"psmodal",maxWidth:"350px",isClickOut:!1,class:"z-50"},{title:(0,r.w5)((function(){return[(0,r.Wm)(u,null,{default:(0,r.w5)((function(){return[(0,r.Uk)((0,i.zw)(e.$t("ps_loading_dialog__please_wait")),1)]})),_:1})]})),body:(0,r.w5)((function(){return[(0,r.Wm)(l,null,{default:(0,r.w5)((function(){return[(0,r.Uk)((0,i.zw)(e.message),1)]})),_:1})]})),footer:(0,r.w5)((function(){return[]})),_:1},512)}var s=n(2262),a=n(2379),u=n(1340),l=n(4687),c=n(679),h=(0,r.aZ)({components:{PsModal:a.Z,PsLabel:l.Z,PsLabelTitle:u.Z},setup:function(){var e=(0,s.iH)(),t=(0,s.iH)(c.a.global.t("ps_loading_dialog__loading"));function n(){e.value.toggle(!0)}function r(){e.value.toggle(!1)}function i(e){t.value=e}return{psmodal:e,openModal:n,closeModal:r,message:t,setMessage:i}}}),d=n(8118);const p=(0,d.Z)(h,[["render",o]]);var f=p},7181:function(e,t,n){n.d(t,{Z:function(){return l}});var r=n(6252);function i(e,t,n,i,o,s){var a=(0,r.up)("ps-label");return(0,r.wg)(),(0,r.j4)(a,{class:"lg:text-xl sm:text-lg text-base",textColor:e.textColor},{default:(0,r.w5)((function(){return[(0,r.WI)(e.$slots,"default")]})),_:3},8,["textColor"])}var o=n(4687),s=(0,r.aZ)({name:"PsLabelHeader6",components:{PsLabel:o.Z},props:{textColor:{type:String,default:"text-secondary-500 dark:text-secondaryDark-white"}}}),a=n(8118);const u=(0,a.Z)(s,[["render",i]]);var l=u},8225:function(e,t,n){n.d(t,{Z:function(){return l}});var r=n(6252);function i(e,t,n,i,o,s){var a=(0,r.up)("ps-label");return(0,r.wg)(),(0,r.j4)(a,{class:"lg:text-md sm:text-sm text-xs font-medium",textColor:e.textColor},{default:(0,r.w5)((function(){return[(0,r.WI)(e.$slots,"default")]})),_:3},8,["textColor"])}var o=n(4687),s=(0,r.aZ)({name:"PsLabelTitle3",components:{PsLabel:o.Z},props:{textColor:{type:String,default:"text-secondary-500 dark:text-secondaryDark-white"}}}),a=n(8118);const u=(0,a.Z)(s,[["render",i]]);var l=u},2602:function(e,t,n){n.d(t,{Z:function(){return c}});var r=n(6252),i=n(3577),o=["rows","value"];function s(e,t,n,s,a,u){return(0,r.wg)(),(0,r.iD)("textarea",{class:(0,i.C_)(["shadow-sm text-sm",n.theme]),rows:n.rows,value:n.value,onInput:t[0]||(t[0]=function(e){return s.handleInput(e.target.value)})},null,42,o)}var a={name:"PsTextArea",props:{rows:{type:Number,default:3},value:String,type:{type:String,default:"text"},theme:{type:String,default:"ring-primary-200 dark:ring-primaryDark-grey focus:outline-none focus:ring py-2 ps-4 form-input bg-primary-000 dark:bg-primaryDark-black text-secondary-500 dark:text-secondaryDark-white rounded-xl lg:rounded-2xl"}},setup:function(e,t){var n=t.emit;function r(e){n("update:value",e)}return{handleInput:r}}},u=n(8118);const l=(0,u.Z)(a,[["render",s]]);var c=l},8653:function(e,t,n){n.d(t,{Z:function(){return c}});var r=n(6252),i={class:"w-mobile sm:w-median lg:w-large mx-auto"};function o(e,t,n,o,s,a){return(0,r.wg)(),(0,r.iD)("div",i,[(0,r.WI)(e.$slots,"content")])}var s=n(8345),a={name:"PsContentContainer",setup:function(){var e=(0,s.yj)();return{route:e}}},u=n(8118);const l=(0,u.Z)(a,[["render",o]]);var c=l},1850:function(e,t,n){n.r(t),n.d(t,{default:function(){return qn}});var r=n(6252),i=n(3577),o=n(9963),s={class:"relative flex flex-col",style:{height:"90vh"}},a={class:"lg:mt-32 mt-28 h-40 flex flex-col"},u={class:"flex flex-row justify-between mb-2"},l={class:"ms-4 mb-4 flex items-center"},c={class:"flex flex-row content-end items-center cursor-pointer"},h=["src"],d={key:0,class:"flex flex-row justify-between"},p={class:"flex flex-row cursor-pointer"},f=["src"],_={class:"flex flex-col ms-4 mt-2"},v={key:0,class:"flex flex-row items-center"},y={key:1,class:"flex flex-row items-center"},m={key:0,class:"flex flex-col content-end items-center"},g={key:1,class:"flex flex-col content-end items-center"},w=(0,r._)("br",null,null,-1),C={key:0,class:""},b={key:0},k={class:"flex w-full justify-center"},T={class:"px-4 py-2 mt-2 mb-1 rounded-lg inline-block font-medium"},I={key:1},x={key:0},S={key:0,class:"w-full flex justify-end ps-1/3 flex-row items-end"},P={class:"px-4 py-2 mt-2 mb-1 rounded-lg inline-block rounded-br-none bg-yellow-200"},E=(0,r._)("br",null,null,-1),D={key:1,class:"pe-1/3 flex flex-col"},R={class:"flex flex-row items-end"},N={class:"px-4 py-2 mt-2 mb-1 rounded-lg inline-block rounded-bl-none bg-yellow-200"},U=(0,r._)("br",null,null,-1),A={key:1},O={key:0,class:"w-full flex justify-end ps-1/3 flex-row items-end"},M={class:"px-4 py-2 mt-2 mb-1 rounded-lg inline-block rounded-br-none bg-red-400"},L=(0,r._)("br",null,null,-1),q={key:1,class:"pe-1/3 flex flex-col"},F={class:"flex flex-row items-end"},W={class:"px-4 py-2 mt-2 mb-1 rounded-lg inline-block rounded-bl-none bg-red-400"},H=(0,r._)("br",null,null,-1),j={key:2},Z={key:0},B={key:1},z={key:0,class:"w-full ps-1/3 flex flex-col justify-end items-end"},Y={class:"flex flex-row"},V={class:"px-4 py-2 mt-2 mb-1 rounded-lg inline-block rounded-br-none bg-green-400"},G=(0,r._)("br",null,null,-1),$={key:0,class:"me-2"},Q={key:1,class:"pe-1/3 flex flex-col"},K={class:"flex flex-row items-end"},J={class:"px-4 py-2 mt-2 mb-1 rounded-lg inline-block rounded-bl-none bg-green-400"},X=(0,r._)("br",null,null,-1),ee={key:3},te={key:0,class:"w-full flex justify-end ps-1/3 flex-row items-end"},ne={class:"px-4 py-2 mt-2 mb-1 rounded-lg inline-block rounded-br-none bg-secondary-100 dark:bg-secondaryDark-black"},re={key:1,class:"pe-1/3 flex flex-row items-end"},ie={class:"px-4 py-2 mt-2 mb-1 rounded-lg inline-block rounded-bl-none bg-primary-100 dark:bg-primaryDark-black"},oe={key:2},se={class:"w-full flex flex-col justify-center items-center"},ae={class:"flex flex-row"},ue={class:"px-4 py-2 mt-2 mb-1 rounded-lg inline-block bg-primary-000 dark:bg-primaryDark-black"},le=(0,r._)("br",null,null,-1),ce={key:0},he={key:3},de={class:"w-full flex flex-col justify-center items-center"},pe={class:"flex flex-row"},fe={class:"px-4 py-2 mt-2 mb-1 rounded-lg inline-block bg-primary-100 dark:bg-primaryDark-black"},_e=(0,r._)("br",null,null,-1),ve={class:"flex flex-row"},ye={class:"px-4 py-2 mt-2 mb-1 rounded-xl lg:rounded-2xl inline-block bg-primary-100 dark:bg-primaryDark-black"},me=(0,r._)("br",null,null,-1),ge={key:4},we={key:0,class:"w-full flex justify-end ps-1/3 flex-row items-end"},Ce={class:"px-4 py-2 mt-2 mb-1 rounded-lg inline-block rounded-br-none bg-yellow-200"},be=(0,r._)("br",null,null,-1),ke={key:1,class:"pe-1/3 flex flex-col"},Te={class:"flex flex-row items-end"},Ie={class:"px-4 py-2 mt-2 mb-1 rounded-lg inline-block rounded-bl-none bg-yellow-200"},xe=(0,r._)("br",null,null,-1),Se={key:0,class:"ms-2 mb-2 flex flex-row space-x-2"},Pe={key:5},Ee={key:0,class:"w-full flex justify-end ps-1/3 flex-row items-end h-48 mt-4"},De=["onClick","src"],Re={key:1,class:"pe-1/3 flex flex-row items-end h-48 mt-4"},Ne=["onClick","src"],Ue={class:"px-4 mt-2 mb-0 sm:mb-0 absolute inset-y-full w-full"},Ae={class:"relative flex"},Oe={class:"absolute inset-y-0 flex items-center"},Me=(0,r._)("button",{type:"button",class:"inline-flex items-center justify-center rounded-full h-10 w-10 transition duration-500 ease-in-out text-secondary-500 dark:text-secondaryDark-white"},[(0,r._)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",class:"h-6 w-6 text-secondary-500 dark:text-secondaryDark-white"},[(0,r._)("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15.172 7l-6.586 6.586a2 2 0 102.828 2.828l6.414-6.586a4 4 0 00-5.656-5.656l-6.415 6.585a6 6 0 108.486 8.486L20.5 13"})])],-1),Le={class:"absolute right-0 items-center mb-0"},qe=(0,r._)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",class:"h-6 w-6 transform rotate-90"},[(0,r._)("path",{d:"M10.894 2.553a1 1 0 00-1.788 0l-7 14a1 1 0 001.169 1.409l5-1.429A1 1 0 009 15.571V11a1 1 0 112 0v4.571a1 1 0 00.725.962l5 1.428a1 1 0 001.17-1.408l-7-14z"})],-1),Fe=[qe];function We(e,t,n,qe,We,He){var je=(0,r.up)("ps-label"),Ze=(0,r.up)("ps-route-link"),Be=(0,r.up)("ps-icon"),ze=(0,r.up)("ps-label-title-3"),Ye=(0,r.up)("ps-line"),Ve=(0,r.up)("ps-label-caption-2"),Ge=(0,r.up)("ps-input"),$e=(0,r.up)("ps-content-container"),Qe=(0,r.up)("ps-loading-dialog"),Ke=(0,r.up)("ps-confirm-dialog"),Je=(0,r.up)("ps-error-dialog"),Xe=(0,r.up)("ps-success-dialog"),et=(0,r.up)("chat-image-detail"),tt=(0,r.up)("offer-modal"),nt=(0,r.up)("review-modal");return(0,r.wg)(),(0,r.iD)(r.HY,null,[(0,r.Wm)($e,{class:"h-screen"},{content:(0,r.w5)((function(){var n,We,He;return[(0,r._)("div",s,[(0,r._)("div",a,[(0,r._)("div",u,[(0,r._)("div",l,[(0,r.Wm)(Ze,{to:{name:"chat-list"}},{default:(0,r.w5)((function(){return[(0,r.Wm)(je,{class:"hover:underline cursor-pointer font-medium"},{default:(0,r.w5)((function(){return[(0,r.Uk)((0,i.zw)(e.$t("chat__chat_list")),1)]})),_:1})]})),_:1}),(0,r.Wm)(Be,{name:"rightArrow",class:"mx-2"}),(0,r.Wm)(je,null,{default:(0,r.w5)((function(){return[(0,r.Uk)((0,i.zw)(e.$t("chat__chat")),1)]})),_:1})]),(0,r.Wm)(Ze,{to:{name:"other-profile",params:{userId:null===(We=null===(n=qe.userProvider.user)||void 0===n?void 0:n.data)||void 0===We?void 0:We.userId}}},{default:(0,r.w5)((function(){var e,n;return[(0,r._)("div",c,[(0,r._)("img",{alt:"Placeholder",width:"300px",height:"200px",class:"w-10 h-10 p-2 object-cover bg-white rounded-full me-2",src:qe.userProvider.imageUrl(null===(n=null===(e=qe.userProvider.user)||void 0===e?void 0:e.data)||void 0===n?void 0:n.userProfilePhoto,1),onError:t[0]||(t[0]=function(){for(var e,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return qe.chatHistoryProvider.defaultProfileImage&&(e=qe.chatHistoryProvider).defaultProfileImage.apply(e,t)})},null,40,h),(0,r.Wm)(je,{class:""},{default:(0,r.w5)((function(){var e,t;return[(0,r.Uk)((0,i.zw)(null===(t=null===(e=qe.userProvider.user)||void 0===e?void 0:e.data)||void 0===t?void 0:t.userName),1)]})),_:1})])]})),_:1},8,["to"])]),qe.dataReady?((0,r.wg)(),(0,r.iD)("div",d,[(0,r.Wm)(Ze,{to:{name:"item",params:{itemName:qe.itemName.split(" ").join("-").toLowerCase()},query:{item_id:qe.itemId,item_name:qe.itemName.split(" ").join("-").toLowerCase()}}},{default:(0,r.w5)((function(){return[(0,r._)("div",p,[(0,r._)("img",{alt:"Placeholder",width:"300px",height:"200px",class:"w-20 h-20 p-2 object-cover bg-white rounded-md",src:qe.chatHistoryProvider.imageUrl(qe.itemImageName,2),onError:t[1]||(t[1]=function(){for(var e,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return qe.chatHistoryProvider.defaultCarImage&&(e=qe.chatHistoryProvider).defaultCarImage.apply(e,t)})},null,40,f),(0,r._)("div",_,[(0,r.Wm)(ze,null,{default:(0,r.w5)((function(){return[(0,r.Uk)((0,i.zw)(qe.itemName),1)]})),_:1}),(0,r.Wm)(je,{class:"mt-1"},{default:(0,r.w5)((function(){return[(0,r.Uk)((0,i.zw)(qe.currency)+" "+(0,i.zw)(qe.itemPrice)+" ( "+(0,i.zw)(qe.condition)+" ) ",1)]})),_:1}),qe.isOtherUserOnline?((0,r.wg)(),(0,r.iD)("div",v,[(0,r.Wm)(je,null,{default:(0,r.w5)((function(){return[(0,r.Uk)((0,i.zw)(e.$t("chat__online")),1)]})),_:1}),(0,r.Wm)(Be,{name:"dot",class:"text-green-500 mt-1 ms-2"})])):((0,r.wg)(),(0,r.iD)("div",y,[(0,r.Wm)(je,null,{default:(0,r.w5)((function(){return[(0,r.Uk)((0,i.zw)(e.$t("chat__offline")),1)]})),_:1}),(0,r.Wm)(Be,{name:"dot",class:"text-red-500 mt-1 ms-2"})]))])])]})),_:1},8,["to"]),"1"==qe.isSoldOut||"1"==(null===(He=qe.chatHistoryProvider.chatHistory.data)||void 0===He?void 0:He.item.isSoldOut)?((0,r.wg)(),(0,r.iD)("div",m,[(0,r._)("div",null,[(0,r.Wm)(je,{class:"select-none px-4 py-3 my-auto bg-primary-500 dark:bg-primaryDark-accent text-median font-medium text-textLight dark:text-textDark rounded-xl lg:rounded-2xl",textColor:"text-textLight dark:text-textDark"},{default:(0,r.w5)((function(){return[(0,r.Uk)((0,i.zw)(e.$t("chat__sold")),1)]})),_:1})])])):qe.chatFlag==qe.PsConst.CHAT_FROM_SELLER&&qe.showOffer?((0,r.wg)(),(0,r.iD)("div",g,[(0,r._)("div",{onClick:t[2]||(t[2]=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return qe.makeOfferClicked&&qe.makeOfferClicked.apply(qe,e)})},[(0,r.Wm)(je,{class:"select-none px-4 py-3 my-auto bg-primary-500 dark:bg-primaryDark-accent text-median font-medium text-textLight dark:text-textDare rounded-xl lg:rounded-2xl cursor-pointer",textColor:"text-textLight dark:text-textDark"},{default:(0,r.w5)((function(){return[(0,r.Uk)((0,i.zw)(e.$t("chat__make"))+" ",1),w,(0,r.Uk)(" "+(0,i.zw)(e.$t("chat__offer")),1)]})),_:1})])])):(0,r.kq)("",!0)])):(0,r.kq)("",!0)]),(0,r.Wm)(Ye,{class:"mt-2"}),(0,r._)("div",{ref:"messages",onScroll:t[7]||(t[7]=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return qe.handleScroll&&qe.handleScroll.apply(qe,e)}),id:"messages",class:"px-4 flex flex-col-reverse overflow-y-auto h-full scrolling-touch"},[((0,r.wg)(!0),(0,r.iD)(r.HY,null,(0,r.Ko)(qe.chats.data,(function(n){var o;return(0,r.wg)(),(0,r.iD)("div",{key:null!==(o=n.id)&&void 0!==o?o:""},[""!=n.message&&null!=n.message?((0,r.wg)(),(0,r.iD)("div",C,[n.type==qe.PsConst.CHAT_TYPE_DATE?((0,r.wg)(),(0,r.iD)("div",b,[(0,r._)("div",k,[(0,r._)("span",T,[(0,r.Wm)(je,null,{default:(0,r.w5)((function(){return[(0,r.Uk)((0,i.zw)(n.message),1)]})),_:2},1024)])])])):n.type==qe.PsConst.CHAT_TYPE_TEXT?((0,r.wg)(),(0,r.iD)("div",I,[n.offerStatus==qe.PsConst.CHAT_STATUS_OFFER?((0,r.wg)(),(0,r.iD)("div",x,[n.sendByUserId==qe.loginUserId?((0,r.wg)(),(0,r.iD)("div",S,[(0,r.Wm)(Ve,{class:"me-2 mb-2"},{default:(0,r.w5)((function(){return[(0,r.Uk)((0,i.zw)(n.timeString),1)]})),_:2},1024),(0,r._)("span",P,[(0,r.Wm)(je,{class:"text-center",textColor:"text-secondary-500 dark:text-secondaryDark-black"},{default:(0,r.w5)((function(){return[(0,r.Uk)((0,i.zw)(e.$t("chat__make_offer"))+" ",1),E,(0,r.Uk)((0,i.zw)("0"==qe.itemPrice?e.$t("item_price__free"):n.message),1)]})),_:2},1024)])])):((0,r.wg)(),(0,r.iD)("div",D,[(0,r._)("div",R,[(0,r._)("span",N,[(0,r.Wm)(je,{textColor:"text-secondary-500 dark:text-secondaryDark-black"},{default:(0,r.w5)((function(){return[(0,r.Uk)((0,i.zw)(e.$t("chat__make_offer"))+" ",1),U,(0,r.Uk)((0,i.zw)("0"==qe.itemPrice?e.$t("item_price__free"):n.message),1)]})),_:2},1024)]),(0,r.Wm)(Ve,{class:"ms-2 mb-2"},{default:(0,r.w5)((function(){return[(0,r.Uk)((0,i.zw)(n.timeString),1)]})),_:2},1024)])]))])):n.offerStatus==qe.PsConst.CHAT_STATUS_REJECT?((0,r.wg)(),(0,r.iD)("div",A,[n.sendByUserId==qe.loginUserId?((0,r.wg)(),(0,r.iD)("div",O,[(0,r.Wm)(Ve,{class:"me-2 mb-2"},{default:(0,r.w5)((function(){return[(0,r.Uk)((0,i.zw)(n.timeString),1)]})),_:2},1024),(0,r._)("span",M,[(0,r.Wm)(je,{class:"text-center",textColor:"text-secondary-500 dark:text-secondaryDark-black"},{default:(0,r.w5)((function(){return[(0,r.Uk)((0,i.zw)(e.$t("chat__offer_rejected"))+" ",1),L,(0,r.Uk)((0,i.zw)("0"==qe.itemPrice?e.$t("item_price__free"):n.message),1)]})),_:2},1024)])])):((0,r.wg)(),(0,r.iD)("div",q,[(0,r._)("div",F,[(0,r._)("span",W,[(0,r.Wm)(je,{textColor:"text-secondary-500 dark:text-secondaryDark-black"},{default:(0,r.w5)((function(){return[(0,r.Uk)((0,i.zw)(e.$t("chat__offer_rejected")),1),H,(0,r.Uk)((0,i.zw)("0"==qe.itemPrice?e.$t("item_price__free"):n.message),1)]})),_:2},1024)]),(0,r.Wm)(Ve,{class:"ms-2 mb-2"},{default:(0,r.w5)((function(){return[(0,r.Uk)((0,i.zw)(n.timeString),1)]})),_:2},1024)])]))])):n.offerStatus==qe.PsConst.CHAT_STATUS_ACCEPT?((0,r.wg)(),(0,r.iD)("div",j,[n.isSold&&n.isUserBought?((0,r.wg)(),(0,r.iD)("div",Z)):((0,r.wg)(),(0,r.iD)("div",B,[n.sendByUserId==qe.loginUserId?((0,r.wg)(),(0,r.iD)("div",z,[(0,r._)("div",Y,[(0,r.Wm)(Ve,{class:"me-2 mb-2"},{default:(0,r.w5)((function(){return[(0,r.Uk)((0,i.zw)(n.timeString),1)]})),_:2},1024),(0,r._)("span",V,[(0,r.Wm)(je,{class:"text-center",textColor:"text-secondary-500 dark:text-secondaryDark-black"},{default:(0,r.w5)((function(){return[(0,r.Uk)((0,i.zw)(e.$t("chat__offer_accepted"))+" ",1),G,(0,r.Uk)((0,i.zw)("0"==qe.itemPrice?e.$t("item_price__free"):n.message),1)]})),_:2},1024)])]),n.offerStatus==qe.PsConst.CHAT_STATUS_ACCEPT&&0==n.isUserBought?((0,r.wg)(),(0,r.iD)("div",$,[(0,r.Wm)(je,{onClick:function(e){return qe.isUserBought(n)},class:"p-2 flex flex-shrink-0 bg-primary-500 dark:bg-primaryDark-accent rounded-lg cursor-pointer",textColor:"text-textLight dark:textDark "},{default:(0,r.w5)((function(){return[(0,r.Uk)((0,i.zw)(e.$t("chat__is_user_bought")),1)]})),_:2},1032,["onClick"])])):(0,r.kq)("",!0)])):((0,r.wg)(),(0,r.iD)("div",Q,[(0,r._)("div",K,[(0,r._)("span",J,[(0,r.Wm)(je,{class:"",textColor:"text-secondary-500 dark:text-secondaryDark-black"},{default:(0,r.w5)((function(){return[(0,r.Uk)((0,i.zw)(e.$t("chat__offer_accepted"))+" ",1),X,(0,r.Uk)((0,i.zw)("0"==qe.itemPrice?e.$t("item_price__free"):n.message),1)]})),_:2},1024)]),(0,r.Wm)(Ve,{class:"ms-2 mb-2"},{default:(0,r.w5)((function(){return[(0,r.Uk)((0,i.zw)(n.timeString),1)]})),_:2},1024)])]))]))])):((0,r.wg)(),(0,r.iD)("div",ee,[n.sendByUserId==qe.loginUserId?((0,r.wg)(),(0,r.iD)("div",te,[(0,r.Wm)(Ve,{class:"me-2 mb-2"},{default:(0,r.w5)((function(){return[(0,r.Uk)((0,i.zw)(n.timeString),1)]})),_:2},1024),(0,r._)("span",ne,[(0,r.Wm)(je,null,{default:(0,r.w5)((function(){return[(0,r.Uk)((0,i.zw)(n.message),1)]})),_:2},1024)])])):((0,r.wg)(),(0,r.iD)("div",re,[(0,r._)("span",ie,[(0,r.Wm)(je,null,{default:(0,r.w5)((function(){return[(0,r.Uk)((0,i.zw)(n.message),1)]})),_:2},1024)]),(0,r.Wm)(Ve,{class:"ms-2 mb-2"},{default:(0,r.w5)((function(){return[(0,r.Uk)((0,i.zw)(n.timeString),1)]})),_:2},1024)]))]))])):n.type==qe.PsConst.CHAT_TYPE_BOUGHT?((0,r.wg)(),(0,r.iD)("div",oe,[(0,r._)("div",se,[(0,r._)("div",ae,[(0,r._)("span",ue,[(0,r.Wm)(je,{class:"text-center"},{default:(0,r.w5)((function(){return[(0,r.Uk)((0,i.zw)(e.$t("chat__item_bought"))+" ",1),le,(0,r.Uk)((0,i.zw)("0"==qe.itemPrice?e.$t("item_price__free"):n.message),1)]})),_:2},1024)])]),(0,r._)("div",null,[(0,r._)("div",{onClick:t[3]||(t[3]=function(e){return qe.clickGiveReview()})},[(0,r.Wm)(je,{class:"p-2 mb-1 flex flex-shrink-0 bg-primary-500 dark:bg-primaryDark-accent cursor-pointer rounded-lg",textColor:"text-textLight dark:text-textDark"},{default:(0,r.w5)((function(){return[(0,r.Uk)((0,i.zw)(e.$t("chat__give_review")),1)]})),_:1})])]),n.sendByUserId==qe.loginUserId&&n.offerStatus==qe.PsConst.CHAT_STATUS_IS_USER_BOUGHT?((0,r.wg)(),(0,r.iD)("div",ce,[(0,r.Wm)(je,{onClick:function(e){return qe.markAsSold(n)},class:"p-2 flex flex-shrink-0 bg-primary-500 dark:bg-primaryDark-accent cursor-pointer rounded-lg",textColor:"text-textLight dark:text-textDark"},{default:(0,r.w5)((function(){return[(0,r.Uk)((0,i.zw)(e.$t("chat__mark_as_sold")),1)]})),_:2},1032,["onClick"])])):(0,r.kq)("",!0)])])):n.type==qe.PsConst.CHAT_TYPE_SOLD?((0,r.wg)(),(0,r.iD)("div",he,[(0,r._)("div",de,[(0,r._)("div",pe,[(0,r._)("span",fe,[(0,r.Wm)(je,{class:"text-center"},{default:(0,r.w5)((function(){return[(0,r.Uk)((0,i.zw)(e.$t("chat__item_bought"))+" ",1),_e,(0,r.Uk)((0,i.zw)("0"==qe.itemPrice?e.$t("item_price__free"):n.message),1)]})),_:2},1024)])]),(0,r._)("div",null,[(0,r._)("div",{onClick:t[4]||(t[4]=function(e){return qe.clickGiveReview()})},[(0,r.Wm)(je,{class:"p-2 mb-1 flex flex-shrink-0 bg-primary-500 dark:bg-primaryDark-accent cursor-pointer rounded-lg",textColor:"text-textLight dark:text-textDark"},{default:(0,r.w5)((function(){return[(0,r.Uk)((0,i.zw)(e.$t("chat__give_review")),1)]})),_:1})])]),(0,r._)("div",ve,[(0,r._)("span",ye,[(0,r.Wm)(je,{class:"text-center"},{default:(0,r.w5)((function(){return[(0,r.Uk)((0,i.zw)(e.$t("chat__item_sold"))+" ",1),me,(0,r.Uk)((0,i.zw)("0"==qe.itemPrice?e.$t("item_price__free"):n.message),1)]})),_:2},1024)])])])])):n.type==qe.PsConst.CHAT_TYPE_OFFER?((0,r.wg)(),(0,r.iD)("div",ge,[n.sendByUserId==qe.loginUserId?((0,r.wg)(),(0,r.iD)("div",we,[(0,r.Wm)(Ve,{class:"me-2 mb-2"},{default:(0,r.w5)((function(){return[(0,r.Uk)((0,i.zw)(n.timeString),1)]})),_:2},1024),(0,r._)("span",Ce,[(0,r.Wm)(je,{class:"text-center",textColor:"text-secondary-500 dark:text-secondaryDark-black"},{default:(0,r.w5)((function(){return[(0,r.Uk)((0,i.zw)(e.$t("chat__make_offer"))+" ",1),be,(0,r.Uk)((0,i.zw)("0"==qe.itemPrice?e.$t("item_price__free"):n.message),1)]})),_:2},1024)])])):((0,r.wg)(),(0,r.iD)("div",ke,[(0,r._)("div",Te,[(0,r._)("span",Ie,[(0,r.Wm)(je,{class:"dark:text-primaryDark-black",textColor:"text-secondary-500 dark:text-secondaryDark-black"},{default:(0,r.w5)((function(){return[(0,r.Uk)((0,i.zw)(e.$t("chat__make_offer"))+" ",1),xe,(0,r.Uk)((0,i.zw)("0"==qe.itemPrice?e.$t("item_price__free"):n.message),1)]})),_:2},1024)]),(0,r.Wm)(Ve,{class:"ms-2 mb-2"},{default:(0,r.w5)((function(){return[(0,r.Uk)((0,i.zw)(n.timeString),1)]})),_:2},1024)]),n.offerStatus==qe.PsConst.CHAT_STATUS_OFFER?((0,r.wg)(),(0,r.iD)("div",Se,[(0,r.Wm)(je,{onClick:function(e){return qe.acceptOffer(n)},class:"p-2 bg-green-600 hover:bg-green-700 cursor-pointer rounded-lg text-textLight",textColor:"text-textLight"},{default:(0,r.w5)((function(){return[(0,r.Uk)((0,i.zw)(e.$t("chat__accept")),1)]})),_:2},1032,["onClick"]),(0,r.Wm)(je,{onClick:function(e){return qe.rejectOffer(n)},class:"p-2 bg-gray-600 hover:bg-gray-700 cursor-pointer rounded-lg text-textLight",textColor:"text-textLight"},{default:(0,r.w5)((function(){return[(0,r.Uk)((0,i.zw)(e.$t("chat__reject")),1)]})),_:2},1032,["onClick"])])):(0,r.kq)("",!0)]))])):n.type==qe.PsConst.CHAT_TYPE_IMAGE?((0,r.wg)(),(0,r.iD)("div",Pe,[n.sendByUserId==qe.loginUserId?((0,r.wg)(),(0,r.iD)("div",Ee,[(0,r.Wm)(Ve,{class:"me-2 mb-2"},{default:(0,r.w5)((function(){return[(0,r.Uk)((0,i.zw)(n.timeString),1)]})),_:2},1024),(0,r._)("img",{onClick:function(e){return qe.imageView(n.message)},width:"300px",height:"200px",alt:"Placeholder",class:"cursor-pointer w-auto h-48 p-2 object-cover rounded-md",src:qe.chatHistoryProvider.imageUrl(n.message,3),onError:t[5]||(t[5]=function(){for(var e,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return qe.chatHistoryProvider.defaultCarImage&&(e=qe.chatHistoryProvider).defaultCarImage.apply(e,t)})},null,40,De)])):((0,r.wg)(),(0,r.iD)("div",Re,[(0,r._)("img",{onClick:function(e){return qe.imageView(n.message)},width:"300px",height:"200px",alt:"Placeholder",class:"cursor-pointer w-auto h-48 p-2 object-cover rounded-md",src:qe.chatHistoryProvider.imageUrl(n.message,3),onError:t[6]||(t[6]=function(){for(var e,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return qe.chatHistoryProvider.defaultCarImage&&(e=qe.chatHistoryProvider).defaultCarImage.apply(e,t)})},null,40,Ne),(0,r.Wm)(Ve,{class:"ms-2 mb-2"},{default:(0,r.w5)((function(){return[(0,r.Uk)((0,i.zw)(n.timeString),1)]})),_:2},1024)]))])):(0,r.kq)("",!0)])):(0,r.kq)("",!0)])})),128))],544),(0,r._)("div",Ue,[(0,r._)("div",Ae,[(0,r._)("span",Oe,[(0,r._)("div",{class:"",onClick:t[9]||(t[9]=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return qe.onImageClick&&qe.onImageClick.apply(qe,e)}),for:"upload-image1"},[(0,r._)("input",{class:"py-2",type:"file",size:"1",max:"1",accept:".jpg,.jpeg,.png",onChange:t[8]||(t[8]=function(e){return qe.onImageSelected(e)}),ref:"image",id:"upload-image1",style:{display:"none"},ordering:1},null,544),Me])]),(0,r.Wm)(Ge,{placeholder:e.$t("chat__write_message"),onKeyup:t[10]||(t[10]=(0,o.D2)((function(e){return qe.sendNormalMessage(qe.inputMessageController)}),["enter"])),value:qe.inputMessageController,"onUpdate:value":t[11]||(t[11]=function(e){return qe.inputMessageController=e}),class:"w-full mt-1 ps-12 py-2 me-8",theme:"form-input bg-primary-000 dark:bg-primaryDark-black text-secondary-500 dark:text-secondaryDark-white"},null,8,["placeholder","value"]),(0,r._)("div",Le,[(0,r._)("button",{type:"button",onClick:t[12]||(t[12]=function(e){return qe.sendNormalMessage(qe.inputMessageController)}),class:"inline-flex items-center justify-center rounded-full h-12 w-12 transition duration-500 ease-in-out text-textLight dark:text-textDark bg-primary-500 dark:bg-primaryDark-accent focus:outline-none"},Fe)])])])])]})),_:1}),(0,r.Wm)(Qe,{ref:"ps_loading_dialog"},null,512),(0,r.Wm)(Ke,{ref:"ps_confirm_dialog"},null,512),(0,r.Wm)(Je,{ref:"ps_error_dialog"},null,512),(0,r.Wm)(Xe,{ref:"ps_success_dialog"},null,512),(0,r.Wm)(et,{ref:"chat_image"},null,512),(0,r.Wm)(tt,{ref:"offer_modal",price:qe.itemPrice,onSubmit:qe.submitOffer},null,8,["price","onSubmit"]),(0,r.Wm)(nt,{ref:"review_modal"},null,512)],64)}var He=n(655),je=n(3824),Ze=n(5503),Be=(n(2211),n(9446),n(2262)),ze=n(2921),Ye=n(3251),Ve=n(8653),Ge=n(8345),$e=n(9070),Qe=n(9602),Ke=n(4687),Je=n(8225),Xe=n(2776),et=n(7678),tt=n(7640),nt=n(8593),rt=n(9399),it=n(355),ot=n(606),st=n(5429),at=n(7534),ut={class:"w-screem flex flex-col"},lt={class:"flex flex-row justify-between"},ct=(0,r._)("div",{class:"flex-grow"},null,-1),ht={class:"flex flex-row justify-between"},dt={class:"flex flex-grow max-w-10/12"},pt=["src"];function ft(e,t,n,i,o,s){var a=(0,r.up)("font-awesome-icon"),u=(0,r.up)("ps-image-modal");return(0,r.wg)(),(0,r.j4)(u,{ref:"psmodal",isClickOut:!0,class:"z-50 content-center mx-auto"},{body:(0,r.w5)((function(){return[(0,r._)("div",ut,[(0,r._)("div",lt,[ct,(0,r.Wm)(a,{onClick:t[0]||(t[0]=function(t){return e.psmodal.toggle(!1)}),icon:["fas","times"],class:"text-secondary-700 dark:text-secondaryDark-grey",size:"2x"})]),(0,r._)("div",ht,[(0,r._)("div",dt,[(0,r._)("img",{alt:"Placeholder",width:"400px",height:"400px",class:"w-full h-112 overflow:hidden object-contain",src:e.chatHistoryProvider.imageUrl(e.gallery),onError:t[1]||(t[1]=function(){for(var t,n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];return e.chatHistoryProvider.defaultCarImage&&(t=e.chatHistoryProvider).defaultCarImage.apply(t,n)})},null,40,pt)])])])]})),_:1},512)}var _t=n(335),vt=n(4578),yt=n(2255),mt=n(1597),gt=n(8316),wt=function(){function e(){this.itemId="",this.buyerUserId="",this.sellerUserId=""}return e.prototype.MarkAsSoldParameterHolder=function(){this.itemId="",this.buyerUserId="",this.sellerUserId=""},e.prototype.toMap=function(){var e={};return e["item_id"]=this.itemId,e["buyer_user_id"]=this.buyerUserId,e["seller_user_id"]=this.sellerUserId,e},e}(),Ct=wt,bt=n(1476),kt=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.chatHistory=(0,Be.qj)(new mt.Z),t.loading=(0,Be.qj)({value:!1}),t.limit=30,t.offset=0,t}return(0,He.ZT)(t,e),t.prototype.updateChatHistory=function(e){this.chatHistory=e},t.prototype.loadChatHistory=function(e){return(0,He.mG)(this,void 0,void 0,(function(){var t;return(0,He.Jh)(this,(function(n){switch(n.label){case 0:return this.loading.value=!0,[4,yt.Z.getChatHistory(new gt.Z,e.toMap())];case 1:return t=n.sent(),this.updateChatHistory(t),this.loading.value=!1,[2]}}))}))},t.prototype.postChatHistory=function(e,t,n,r,i,o){return(0,He.mG)(this,void 0,void 0,(function(){var s;return(0,He.Jh)(this,(function(a){switch(a.label){case 0:return s=new bt.Z,s.itemId=e,s.buyerUserId=t,s.sellerUserId=n,s.type=r,s.isUserOnline=i,s.message=o,[4,yt.Z.syncChatHistory(new gt.Z,s.toMap())];case 1:return a.sent(),[2]}}))}))},t.prototype.postAcceptedOffer=function(e,t){return(0,He.mG)(this,void 0,void 0,(function(){return(0,He.Jh)(this,(function(n){switch(n.label){case 0:return this.loading.value=!0,[4,yt.Z.acceptedOffer(new gt.Z,e,t.toMap())];case 1:return n.sent(),this.loading.value=!1,[2]}}))}))},t.prototype.postRejectedOffer=function(e,t){return(0,He.mG)(this,void 0,void 0,(function(){return(0,He.Jh)(this,(function(n){switch(n.label){case 0:return this.loading.value=!0,[4,yt.Z.rejectedOffer(new gt.Z,e,t.toMap())];case 1:return n.sent(),this.loading.value=!1,[2]}}))}))},t.prototype.makeMarkAsSold=function(e,t,n,r){return(0,He.mG)(this,void 0,Promise,(function(){var i,o;return(0,He.Jh)(this,(function(s){switch(s.label){case 0:return i=new Ct,i.itemId=t.toString(),i.buyerUserId=n.toString(),i.sellerUserId=r.toString(),this.loading.value=!0,[4,yt.Z.makeMarkAsSold(new gt.Z,e,i.toMap())];case 1:return o=s.sent(),this.loading.value=!1,[2,o]}}))}))},t}(vt.n),Tt=(Symbol("GetChatHistoryProvider"),function(){return(0,Be.qj)(new kt)}),It=n(8947),xt=n(1436);It.vI.add(xt.NBC);var St=(0,r.aZ)({name:"ChatImageDetail",components:{PsImageModal:_t.Z},setup:function(){var e=(0,Be.iH)(),t=(0,Be.iH)(""),n=Tt();function r(n){t.value=n,e.value.toggle(!0)}function i(){e.value.toggle(!1)}return{psmodal:e,openModal:r,closeModal:i,gallery:t,chatHistoryProvider:n}}}),Pt=n(8118);const Et=(0,Pt.Z)(St,[["render",ft]]);var Dt=Et,Rt={class:"flex justify-between container w-full p-4"},Nt={class:"flex flex-col w-full"},Ut={class:"flex flex-row w-full justify-center shadow-lg mb-4"},At={class:"my-4"},Ot=["src"],Mt={class:"ms-6 my-auto"},Lt={class:"flex flex-row w-full justify-center"},qt={class:"flex items-center justify-center mb-4"};function Ft(e,t,n,o,s,a){var u=(0,r.up)("ps-label-header-6"),l=(0,r.up)("ps-label"),c=(0,r.up)("ps-input"),h=(0,r.up)("ps-button"),d=(0,r.up)("ps-modal"),p=(0,r.up)("ps-loading-dialog"),f=(0,r.up)("ps-error-dialog");return(0,r.wg)(),(0,r.iD)(r.HY,null,[(0,r.Wm)(d,{ref:"psmodal",isClickOut:!1,maxWidth:"400px",theme:"p-6 border lg:rounded-2xl rounded-xl"},{title:(0,r.w5)((function(){return[(0,r._)("div",null,[(0,r.Wm)(u,null,{default:(0,r.w5)((function(){return[(0,r.Uk)((0,i.zw)(e.$t("offer_modal__make_offer_for_this_item")),1)]})),_:1})])]})),body:(0,r.w5)((function(){return[(0,r._)("div",Rt,[(0,r._)("div",Nt,[(0,r._)("div",Ut,[(0,r._)("div",At,[(0,r._)("img",{alt:"Placeholder",width:"300px",height:"300px",class:"rounded-sm w-20 h-20 flex items-center justify-center object-contail",src:e.chatHistoryProvider.imageUrl(e.itemImage?e.itemImage:"",2),onError:t[0]||(t[0]=function(){for(var t,n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];return e.chatHistoryProvider.defaultCarImage&&(t=e.chatHistoryProvider).defaultCarImage.apply(t,n)})},null,40,Ot)]),(0,r._)("div",Mt,[(0,r.Wm)(l,{class:"text-medium text-lg"},{default:(0,r.w5)((function(){return[(0,r.Uk)((0,i.zw)(e.itemName),1)]})),_:1}),(0,r.Wm)(l,{class:"mt-2"},{default:(0,r.w5)((function(){return[(0,r.Uk)((0,i.zw)(e.$t("offer_modal__price"))+" "+(0,i.zw)(e.currency)+" "+(0,i.zw)(e.itemPrice),1)]})),_:1})])]),(0,r._)("div",Lt,[(0,r._)("div",null,[(0,r.Wm)(l,{class:"mt-4"},{default:(0,r.w5)((function(){return[(0,r.Uk)((0,i.zw)(e.currency),1)]})),_:1})]),(0,r._)("div",null,[(0,r.Wm)(c,{class:"mt-2 ms-2",type:"text",placeholder:e.$t("report_item_modal__title"),value:e.negoPrice,"onUpdate:value":t[1]||(t[1]=function(t){return e.negoPrice=t})},null,8,["placeholder","value"])])])])])]})),footer:(0,r.w5)((function(){return[(0,r._)("div",qt,[(0,r.Wm)(h,{class:"text-center w-60 mx-auto",onClick:t[2]||(t[2]=function(t){return e.submitClicked(e.negoPrice)})},{default:(0,r.w5)((function(){return[(0,r.Uk)((0,i.zw)(e.$t("offer_modal__make_offer")),1)]})),_:1}),(0,r.Wm)(h,{class:"text-center w-60 mx-auto ms-4",theme:"btn-second",onClick:t[3]||(t[3]=function(t){return e.psmodal.toggle(!1)})},{default:(0,r.w5)((function(){return[(0,r.Uk)((0,i.zw)(e.$t("offer_modal__cancel")),1)]})),_:1})])]})),_:1},512),(0,r.Wm)(p,{ref:"ps_loading_dialog",isClickOut:!1},null,512),(0,r.Wm)(f,{ref:"ps_error_dialog"},null,512)],64)}var Wt=n(2379),Ht=n(7181),jt=n(3013),Zt=(0,r.aZ)({name:"OfferModal",components:{PsModal:Wt.Z,PsLabelHeader6:Ht.Z,PsLabel:Ke.Z,PsButton:jt.Z,PsErrorDialog:st.Z,PsLoadingDialog:it.Z,PsInput:ze.Z},props:{price:{type:String,default:"0"}},emits:["submit"],setup:function(e,t){var n=(0,Be.iH)(),r=(0,Be.iH)(""),i=(0,Be.iH)(""),o=(0,Be.iH)(),s=(0,Be.iH)(),a="",u=(0,Be.iH)(""),l=(0,Be.iH)(""),c=(0,Be.iH)(""),h="",d="",p=(0,Be.iH)(e.price),f=(0,Be.iH)(""),_=Tt();function v(e,t,r,i){u.value=e,l.value=t,c.value=r,p.value=i,f.value=i,n.value.toggle(!0)}function y(e){t.emit("submit",e),n.value.toggle(!1)}return{psmodal:n,openModal:v,itemId:a,itemName:u,itemImage:l,currency:c,buyerUserId:h,sellerUserId:d,negoPrice:p,itemPrice:f,title:r,message:i,submitClicked:y,ps_loading_dialog:o,ps_error_dialog:s,chatHistoryProvider:_}}});const Bt=(0,Pt.Z)(Zt,[["render",Ft]]);var zt=Bt,Yt={class:"w-full p-2"},Vt={class:"w-full flex flex-col"},Gt={class:"flex flex-row justify-between"};function $t(e,t,n,o,s,a){var u=(0,r.up)("ps-label"),l=(0,r.up)("rating-selected"),c=(0,r.up)("ps-input"),h=(0,r.up)("ps-textarea"),d=(0,r.up)("ps-button"),p=(0,r.up)("ps-modal");return(0,r.wg)(),(0,r.j4)(p,{ref:"psmodal",line:"hidden",maxWidth:"500px",isClickOut:!1},{title:(0,r.w5)((function(){return[]})),body:(0,r.w5)((function(){return[(0,r._)("div",Yt,[(0,r._)("div",Vt,[(0,r.Wm)(u,null,{default:(0,r.w5)((function(){return[(0,r.Uk)((0,i.zw)(e.$t("review_entry__your_rating")),1)]})),_:1}),(0,r.Wm)(l,{ref:"rating",class:"mt-5",grade:0,maxStars:5,hasCounter:!0},null,512),(0,r.Wm)(u,{class:"mt-4"},{default:(0,r.w5)((function(){return[(0,r.Uk)((0,i.zw)(e.$t("review_entry__title")),1)]})),_:1}),(0,r.Wm)(c,{class:"mt-2",type:"text",placeholder:e.$t("review_entry__title"),value:o.title,"onUpdate:value":t[0]||(t[0]=function(e){return o.title=e})},null,8,["placeholder","value"]),(0,r.Wm)(u,{class:"mt-4"},{default:(0,r.w5)((function(){return[(0,r.Uk)((0,i.zw)(e.$t("review_entry__message")),1)]})),_:1}),(0,r.Wm)(h,{class:"mt-2",placeholder:e.$t("review_entry__message"),rows:5,value:o.description,"onUpdate:value":t[1]||(t[1]=function(e){return o.description=e})},null,8,["placeholder","value"])])])]})),footer:(0,r.w5)((function(){return[(0,r._)("div",Gt,[(0,r.Wm)(d,{onClick:t[2]||(t[2]=function(e){return o.cancel()}),textSize:"text-xxs lg:text-sm",class:"py-3",theme:"bg-secondary-100 dark:bg-secondaryDark-grey text-primary-500 dark:text-primaryDark-white"},{default:(0,r.w5)((function(){return[(0,r.Uk)((0,i.zw)(e.$t("review_entry__cancel")),1)]})),_:1}),0==o.ratingProvider.loading.value?((0,r.wg)(),(0,r.j4)(d,{key:0,onClick:o.clicked,textSize:"text-xxs lg:text-sm",class:"py-3"},{default:(0,r.w5)((function(){return[(0,r.Uk)((0,i.zw)(e.$t("review_entry__submit")),1)]})),_:1},8,["onClick"])):((0,r.wg)(),(0,r.j4)(d,{key:1,disabled:!0,textSize:"text-xxs lg:text-sm",class:"py-3"},{default:(0,r.w5)((function(){return[(0,r.Uk)((0,i.zw)(e.$t("review_entry__loading")),1)]})),_:1}))])]})),_:1},512)}const Qt={class:"flex items-center"},Kt=["onClick"];function Jt(e,t,n,o,s,a){const u=(0,r.up)("font-awesome-icon");return(0,r.wg)(),(0,r.iD)("div",Qt,[((0,r.wg)(!0),(0,r.iD)(r.HY,null,(0,r.Ko)(n.maxStars,(e=>((0,r.wg)(),(0,r.iD)("div",{onClick:t=>a.rate(e),class:(0,i.C_)([{active:e<=s.stars},"star"]),key:e},[e<=s.stars?((0,r.wg)(),(0,r.j4)(u,{key:0,icon:["fas","star"],class:"text-primary-500 dark:text-primaryDark-accent",size:"lg"})):((0,r.wg)(),(0,r.j4)(u,{key:1,icon:["far","star"],class:"text-primary-500 dark:text-primaryDark-accent",size:"lg"}))],10,Kt)))),128))])}var Xt=n(6024);It.vI.add(Xt.T,xt.Tab);var en={name:"RatingSelected",components:{},props:{grade:{type:Number,default:0},maxStars:{type:Number,default:0},hasCounter:{type:Boolean,default:!0}},data(){return{stars:this.grade}},methods:{rate(e){"number"===typeof e&&e<=this.maxStars&&e>=0&&(this.stars=this.stars===e?e-1:e)},getRating(){return this.stars}}};const tn=(0,Pt.Z)(en,[["render",Jt]]);var nn=tn,rn=n(2602),on=n(2567),sn=n(2317),an=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.rating=(0,Be.qj)(new mt.Z),t.loading=(0,Be.qj)({value:!1}),t.limit=10,t.offset=0,t.id="",t}return(0,He.ZT)(t,e),t.prototype.postRating=function(e){return(0,He.mG)(this,void 0,Promise,(function(){var t;return(0,He.Jh)(this,(function(n){switch(n.label){case 0:return this.loading.value=!0,[4,yt.Z.postRating(new sn.Z,e.toMap())];case 1:return t=n.sent(),this.loading.value=!1,[2,t]}}))}))},t}(vt.n),un=(Symbol("RatingProvider"),function(){return(0,Be.qj)(new an)}),ln=function(){function e(){this.fromUserId="",this.toUserId="",this.title="",this.description="",this.rating=""}return e.prototype.RatingHolder=function(){this.fromUserId="",this.toUserId="",this.title="",this.description="",this.rating=""},e.prototype.toMap=function(){var e={};return e["from_user_id"]=this.fromUserId,e["to_user_id"]=this.toUserId,e["title"]=this.title,e["description"]=this.description,e["rating"]=this.rating,e},e}(),cn=ln,hn={name:"ReviewModal",components:{PsLabel:Ke.Z,PsButton:jt.Z,PsModal:Wt.Z,PsInput:ze.Z,PsTextarea:rn.Z,RatingSelected:nn},setup:function(){var e,t,n=(0,Be.iH)(),r=rt.$.psValueHolder,i=new cn,o=un(),s=r.getLoginUserId(),a=(0,Be.iH)(""),u=(0,Be.iH)(),l=(0,Be.iH)(),c=(0,Be.iH)();function h(){n.value.toggle(!1)}function d(r,i,o){e=o,t=i,a.value=r,n.value.toggle(!0)}function p(){return(0,He.mG)(this,void 0,void 0,(function(){var r;return(0,He.Jh)(this,(function(h){switch(h.label){case 0:return i.fromUserId=s,i.toUserId=a.value,i.rating=u.value.getRating(),i.title=l.value,i.description=c.value,[4,o.postRating(i)];case 1:return r=h.sent(),r.status==on.Z.SUCCESS?e():t(),n.value.toggle(!1),[2]}}))}))}return{ratingProvider:o,openModal:d,clicked:p,cancel:h,description:c,rating:u,title:l,loginUserId:s,psmodal:n}}};const dn=(0,Pt.Z)(hn,[["render",$t]]);var pn=dn,fn=n(7448),_n=n(7259),vn=function(){function e(){this.itemId="",this.buyerUserId="",this.sellerUserId=""}return e.prototype.GetChatHistoryParameterHolder=function(){this.itemId="",this.buyerUserId="",this.sellerUserId=""},e.prototype.toMap=function(){var e={};return e["item_id"]=this.itemId,e["buyer_user_id"]=this.buyerUserId,e["seller_user_id"]=this.sellerUserId,e},e}(),yn=vn,mn=function(){function e(){this.itemId="",this.buyerUserId="",this.sellerUserId="",this.negoPrice="",this.type="",this.isUserOnline="",this.message=""}return e.prototype.MakeOfferParameterHolder=function(){this.itemId="",this.buyerUserId="",this.sellerUserId="",this.negoPrice="",this.type=tt.Z.CHAT_TO_SELLER,this.isUserOnline="",this.message=""},e.prototype.AcceptOfferParameterHolder=function(){this.itemId="",this.buyerUserId="",this.sellerUserId="",this.negoPrice="",this.type=tt.Z.CHAT_TO_BUYER,this.isUserOnline="",this.message=""},e.prototype.toMap=function(){var e={};return e["item_id"]=this.itemId,e["buyer_user_id"]=this.buyerUserId,e["seller_user_id"]=this.sellerUserId,e["nego_price"]=this.negoPrice,e["type"]=this.type,e["is_user_online"]=this.isUserOnline,e["message"]=this.message,e},e}(),gn=mn,wn=n(4403),Cn=n(9788),bn=n(4426),kn=n(7069),Tn=function(){function e(){this.addedDateTimeStamp=0,this.id="",this.isSold=!1,this.isUserBought=!1,this.itemId="",this.message="",this.offerStatus=0,this.sendByUserId="",this.sessionId="",this.type=0}return e.prototype.ChatParameterHolder=function(){return this.addedDateTimeStamp=Math.floor(Date.now()),this.id="",this.isSold=!1,this.isUserBought=!1,this.itemId="",this.message="hi",this.offerStatus=tt.Z.CHAT_STATUS_NULL,this.sendByUserId="",this.sessionId="",this.type=tt.Z.CHAT_TYPE_TEXT,this},e.prototype.ChatAcceptParameterHolder=function(){return this.addedDateTimeStamp=Math.floor(Date.now()),this.id="",this.isSold=!1,this.isUserBought=!1,this.itemId="",this.message="",this.offerStatus=tt.Z.CHAT_STATUS_ACCEPT,this.sendByUserId="",this.sessionId="",this.type=tt.Z.CHAT_TYPE_ACCEPT,this},e.prototype.toMap=function(){var e={};return e["item_id"]=this.itemId,e["send_by_user_id"]=this.sendByUserId,e["message"]=this.message,e["type"]=this.type,e},e}(),In=Tn,xn=function(){function e(){this.itemId="",this.buyerUserId="",this.sellerUserId="",this.type=""}return e.prototype.ResetUnReadMessageHolder=function(){this.itemId="",this.buyerUserId="",this.sellerUserId="",this.type=""},e.prototype.toMap=function(){var e={};return e["item_id"]=this.itemId,e["buyer_user_id"]=this.buyerUserId,e["seller_user_id"]=this.sellerUserId,e["type"]=this.type,e},e}(),Sn=xn,Pn=n(6921),En=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.id="",t.itemId="",t.sessionId="",t.key="",t.message="",t.type=0,t.sendByUserId="",t.offerStatus=0,t.addedDate="",t.isSold=!1,t.isUserBought=!1,t.dateTimeString="",t.dateString="",t.timeString="",t}return(0,He.ZT)(t,e),t.prototype.init=function(e,t,n,r,i,o,s,a,u,l,c,h,d,p){return this.id=e,this.itemId=t,this.sessionId=n,this.key=r,this.message=i,this.type=o,this.sendByUserId=s,this.offerStatus=a,this.addedDate=u,this.isSold=l,this.isUserBought=c,this.dateTimeString=h,this.dateString=d,this.timeString=p,this},t.prototype.getPrimaryKey=function(){return this.itemId},t.prototype.fromMap=function(e){return(new t).init(e.id,e.itemId,e.sessionId,e.key,e.message,e.type,e.sendByUserId,e.offerStatus,e.addedDate,e.isSold,e.isUserBought,e.dateTimeString,e.dateString,e.timeString)},t.prototype.fromMapList=function(e){var t=[];for(var n in e)null!=n&&t.push(this.fromMap(n));return t},t.prototype.toMap=function(e){var t={};return t["id"]=e.id,t["itemId"]=e.itemId,t["sessionId"]=e.sessionId,t["key"]=e.key,t["message"]=e.message,t["type"]=e.type,t["sendByUserId"]=e.sendByUserId,t["offerStatus"]=e.offerStatus,t["addedDate"]=e.addedDate,t["isSold"]=e.isSold,t["isUserBought"]=e.isUserBought,t["dateTimeString"]=e.dateTimeString,t["dateString"]=e.dateString,t["timeString"]=e.timeString,t},t.prototype.toMapList=function(e){for(var t=[],n=0;n<e.length;n++)null!=e[n]&&t.push(this.toMap(e[n]));return t},t}(Pn.L),Dn=En,Rn=function(){function e(){this.itemId="",this.buyerUserId="",this.sellerUserId="",this.isUserOnline=""}return e.prototype.IsUserBoughtParameterHolder=function(){this.itemId="",this.buyerUserId="",this.sellerUserId="",this.isUserOnline=""},e.prototype.toMap=function(){var e={};return e["item_id"]=this.itemId,e["buyer_user_id"]=this.buyerUserId,e["seller_user_id"]=this.sellerUserId,e["is_user_online"]=this.isUserOnline,e},e}(),Nn=Rn,Un=n(7966),An=n.n(Un),On=n(679),Mn={name:"ChatView",components:{PsLabel:Ke.Z,PsInput:ze.Z,PsLine:Ye.Z,PsContentContainer:Ve.Z,PsIcon:Qe.Z,PsLabelTitle3:Je.Z,PsLabelCaption2:et.Z,PsLoadingDialog:it.Z,OfferModal:zt,PsConfirmDialog:ot.Z,PsErrorDialog:st.Z,PsSuccessDialog:at.Z,ChatImageDetail:Dt,PsRouteLink:Xe.Z,ReviewModal:pn},setup:function(){var e,t,n,i,o,s,a,u,l,c,h,d,p,f,_,v,y,m,g,w,C=this,b=(0,Ge.yj)(),k=rt.$.psValueHolder,T=k.getLoginUserId(),I=(0,Be.iH)(!1);null!=T&&""!=T&&T!=tt.Z.NO_LOGIN_USER||je.Z.push({name:"login"});var x=null!==(t=null===(e=b.query.buyer_user_id)||void 0===e?void 0:e.toString())&&void 0!==t?t:"",S=null!==(i=null===(n=b.query.seller_user_id)||void 0===n?void 0:n.toString())&&void 0!==i?i:"",P=null!==(s=null===(o=b.query.item_name)||void 0===o?void 0:o.toString())&&void 0!==s?s:"",E=null!==(u=null===(a=b.query.item_id)||void 0===a?void 0:a.toString())&&void 0!==u?u:"",D=null!==(c=null===(l=b.query.item_image_name)||void 0===l?void 0:l.toString())&&void 0!==c?c:"",R=null!==(d=null===(h=b.query.item_price)||void 0===h?void 0:h.toString())&&void 0!==d?d:"",N=null!==(f=null===(p=b.query.currency)||void 0===p?void 0:p.toString())&&void 0!==f?f:"",U=null!==(v=null===(_=b.query.condition)||void 0===_?void 0:_.toString())&&void 0!==v?v:"",A=null!==(m=null===(y=b.query.chat_flag)||void 0===y?void 0:y.toString())&&void 0!==m?m:"",O=null!==(w=null===(g=b.query.is_sold_out)||void 0===g?void 0:g.toString())&&void 0!==w?w:"";function M(e){return"0"==e.toString()?On.a.global.t("item_price__free"):An()(q.appInfo.data.frontendConfigSetting.priceFormat,parseFloat(e))}var L=new Cn.Z;L.userId=T;var q=(0,wn.ky)();function F(){return(0,He.mG)(this,void 0,void 0,(function(){return(0,He.Jh)(this,(function(e){switch(e.label){case 0:return[4,q.loadDeleteHistory(L)];case 1:return e.sent(),R=An()(q.appInfo.data.frontendConfigSetting.priceFormat,parseFloat(R)).toString(),[2]}}))}))}F();var W,H=Tt(),j=(0,bn.pK)(),Z=(0,fn.vi)(),B=(0,nt.ZK)(),z=(0,kn.me)(),Y=new yn,V=new gn,G=(new In).ChatParameterHolder(),$=new Nn,Q=new Sn,K=(0,Be.iH)(),J=(0,Be.iH)(),X=(0,Be.iH)(),ee=(0,Be.iH)(),te=(0,Be.iH)(),ne=(0,Be.iH)(),re=(0,Be.iH)(),ie=(0,Be.iH)(!1),oe=(0,Be.iH)(),se=(0,Be.iH)(!1),ae=$e.Z.sortinUserId(S,x),ue=Ze.Z.database().ref("Message/"+ae),le=Ze.Z.database().ref("Current_Chat_With"),ce=Ze.Z.database().ref("User_Presence");W=S==T?x:S;var he=(0,_n.xu)();he.getUser(W),Q.itemId=E,Q.buyerUserId=x,Q.sellerUserId=S,A==tt.Z.CHAT_FROM_SELLER?Q.type=tt.Z.CHAT_TO_BUYER:Q.type=tt.Z.CHAT_TO_SELLER,j.resetUnreadMessageCount(Q);var de,pe=(0,Be.iH)(""),fe=(0,Be.qj)({data:[]});function _e(){var e,t;return(0,He.mG)(this,void 0,void 0,(function(){return(0,He.Jh)(this,(function(n){switch(n.label){case 0:return Y.itemId=E,Y.buyerUserId=x,Y.sellerUserId=S,[4,H.loadChatHistory(Y)];case 1:return n.sent(),ie.value=!0,"1"==(null===(t=null===(e=H.chatHistory)||void 0===e?void 0:e.data)||void 0===t?void 0:t.isOffer)&&(ie.value=!1),[2]}}))}))}function ve(e){e.target.scrollTop<50&&$e.Z.log("load more......")}function ye(){var e=(new Date).getTime();return $e.Z.getTimeStampDividedByOneThousand(parseInt(e.toString(),10))}function me(e){return(0,He.mG)(this,void 0,void 0,(function(){return(0,He.Jh)(this,(function(t){switch(t.label){case 0:return G.id="",G.addedDateTimeStamp=ye(),G.isSold=!1,G.isUserBought=!1,G.itemId=E,G.message=e,G.offerStatus=tt.Z.CHAT_STATUS_NULL,G.sendByUserId=T,G.sessionId=ae,G.type=tt.Z.CHAT_TYPE_TEXT,[4,ge(G)];case 1:return t.sent(),[2]}}))}))}function ge(e){var t;return(0,He.mG)(this,void 0,void 0,(function(){var n,r,i,o,s,a;return(0,He.Jh)(this,(function(u){return n=""==e.id?null!==(t=ue.push().key)&&void 0!==t?t:"":e.id,r=e.sendByUserId,i={addedDate:e.addedDateTimeStamp,id:n,isSold:e.isSold,isUserBought:e.isUserBought,itemId:e.itemId,message:e.message,offerStatus:e.offerStatus,sendByUserId:e.sendByUserId,sessionId:e.sessionId,type:e.type},o={itemId:e.itemId,receiverId:W,senderId:r},s={userId:r,userName:k.loginUserName},console.log("User Presence"),console.log(s),ue.child(n).set(i),le.child(r).set(o),ce.child(r).set(s),a="0",se.value&&(a="1"),A==tt.Z.CHAT_FROM_SELLER?H.postChatHistory(E,x,S,tt.Z.CHAT_TO_SELLER,a,e.message):H.postChatHistory(E,x,S,tt.Z.CHAT_TO_BUYER,a,e.message),se.value||(A==tt.Z.CHAT_FROM_SELLER?B.postChatNoti(E,S,x,e.message,tt.Z.CHAT_TO_SELLER):B.postChatNoti(E,S,x,e.message,tt.Z.CHAT_TO_BUYER)),pe.value="",we(700),[2]}))}))}function we(e){setTimeout((function(){null!=de?de.scrollTop=de.scrollHeight+400:$e.Z.log("it null")}),e)}function Ce(){oe.value.click()}function be(e){return(0,He.mG)(this,void 0,void 0,(function(){var t,n,r,i,o;return(0,He.Jh)(this,(function(s){switch(s.label){case 0:return t=e.target.files,t&&t.length>1?($e.Z.log(t.length),[3,6]):[3,1];case 1:for(n=void 0,r=0;r<t.length;r++)n=t[r];return void 0==n?[3,6]:(K.value.openModal(),K.value.setMessage(On.a.global.t("chat__uploading_image")),i=void 0,i=T==S?tt.Z.CHAT_TO_BUYER:tt.Z.CHAT_TO_SELLER,[4,Z.postChatImageUpload(T,S,x,E,i,n)]);case 2:return o=s.sent(),o.status!=on.Z.SUCCESS?[3,4]:(G.addedDateTimeStamp=ye(),G.isSold=!1,G.isUserBought=!1,G.itemId=E,G.message=o.data.imgPath,G.offerStatus=tt.Z.CHAT_STATUS_NULL,G.sendByUserId=T,G.sessionId=ae,G.type=tt.Z.CHAT_TYPE_IMAGE,[4,ge(G)]);case 3:return s.sent(),[3,5];case 4:$e.Z.log("error"),s.label=5;case 5:K.value.closeModal(),s.label=6;case 6:return[2]}}))}))}function ke(){console.log(P),ne.value.openModal(P,D,N,R)}function Te(e){return(0,He.mG)(this,void 0,void 0,(function(){var t;return(0,He.Jh)(this,(function(n){switch(n.label){case 0:return V.itemId=E,V.buyerUserId=x,V.sellerUserId=S,V.negoPrice=e,V.type=tt.Z.CHAT_TO_SELLER,V.isUserOnline="1",V.message=e,K.value.openModal(),[4,z.makeOffer(x,V)];case 1:return t=n.sent(),t.status!=on.Z.ERROR?[3,2]:($e.Z.log(t.message),[3,4]);case 2:return G.id="",G.addedDateTimeStamp=ye(),G.isSold=!1,G.isUserBought=!1,G.itemId=E,G.message=N+" "+e,G.offerStatus=tt.Z.CHAT_STATUS_OFFER,G.sendByUserId=T,G.sessionId=ae,G.type=tt.Z.CHAT_TYPE_OFFER,[4,ge(G)];case 3:n.sent(),n.label=4;case 4:return[4,_e()];case 5:return n.sent(),K.value.closeModal(),[2]}}))}))}function Ie(e){J.value.openModal(On.a.global.t("chat__confirm"),On.a.global.t("chat__confirm_to_accept"),On.a.global.t("chat__yes"),On.a.global.t("chat__no"),(function(){xe(e)}),(function(){$e.Z.log("cancel")}))}function xe(e){return(0,He.mG)(this,void 0,void 0,(function(){var t,n;return(0,He.Jh)(this,(function(r){switch(r.label){case 0:return V.itemId=E,V.buyerUserId=x,V.sellerUserId=S,V.negoPrice=e.message,V.type=tt.Z.CHAT_TO_BUYER,V.isUserOnline="1",V.message=e.message,K.value.openModal(),[4,z.acceptOffer(T,V)];case 1:return t=r.sent(),t.status!=on.Z.ERROR?[3,2]:($e.Z.log(t.message),[3,5]);case 2:return G.id=e.id,G.isSold=!1,G.isUserBought=!1,G.itemId=e.itemId,G.message=e.message,G.offerStatus=tt.Z.CHAT_STATUS_OFFER,G.sendByUserId=e.sendByUserId,G.sessionId=e.sessionId,G.type=tt.Z.CHAT_TYPE_ACCEPT,G.addedDateTimeStamp=e.addedDate,[4,ge(G)];case 3:return r.sent(),n=(new In).ChatAcceptParameterHolder(),n.addedDateTimeStamp=ye(),n.isSold=!1,n.isUserBought=!1,n.itemId=E,n.message=e.message,n.offerStatus=tt.Z.CHAT_STATUS_ACCEPT,n.type=tt.Z.CHAT_TYPE_ACCEPT,n.sendByUserId=T,n.sessionId=ae,[4,ge(n)];case 4:r.sent(),r.label=5;case 5:return[4,_e()];case 6:return r.sent(),K.value.closeModal(),[2]}}))}))}function Se(e){return(0,He.mG)(this,void 0,void 0,(function(){var t,n;return(0,He.Jh)(this,(function(r){switch(r.label){case 0:return $.itemId=E,$.buyerUserId=x,$.sellerUserId=S,$.isUserOnline="1",K.value.openModal(),[4,z.isUserBought(T,$)];case 1:return t=r.sent(),t.status!=on.Z.ERROR?[3,2]:($e.Z.log(t.message),[3,5]);case 2:return G.addedDateTimeStamp=e.addedDate,G.isSold=!1,G.isUserBought=!0,G.id=e.id,G.itemId=e.itemId,G.message=e.message,G.offerStatus=tt.Z.CHAT_STATUS_ACCEPT,G.sendByUserId=e.sendByUserId,G.sessionId=e.sessionId,G.type=tt.Z.CHAT_TYPE_TEXT,[4,ge(G)];case 3:return r.sent(),n=new In,n.addedDateTimeStamp=ye(),n.isSold=!1,n.isUserBought=!0,n.itemId=E,n.message=e.message,n.offerStatus=tt.Z.CHAT_STATUS_IS_USER_BOUGHT,n.sendByUserId=T,n.sessionId=ae,n.type=tt.Z.CHAT_TYPE_BOUGHT,[4,ge(n)];case 4:r.sent(),r.label=5;case 5:return[4,_e()];case 6:return r.sent(),K.value.closeModal(),[2]}}))}))}function Pe(e){return(0,He.mG)(this,void 0,void 0,(function(){var t,n;return(0,He.Jh)(this,(function(r){switch(r.label){case 0:return $.itemId=E,$.buyerUserId=x,$.sellerUserId=S,K.value.openModal(),[4,z.markAsSold(T,$)];case 1:return t=r.sent(),t.status!=on.Z.ERROR?[3,2]:($e.Z.log(t.message),[3,5]);case 2:return G.id=e.id,G.isSold=!0,G.isUserBought=!0,G.itemId=e.itemId,G.message=e.message,G.offerStatus=tt.Z.CHAT_STATUS_ACCEPT,G.sendByUserId=e.sendByUserId,G.sessionId=e.sessionId,G.type=tt.Z.CHAT_TYPE_TEXT,G.addedDateTimeStamp=e.addedDate,[4,ge(G)];case 3:return r.sent(),n=new In,n.addedDateTimeStamp=ye(),n.isSold=!0,n.isUserBought=!0,n.itemId=E,n.message=e.message,n.offerStatus=tt.Z.CHAT_STATUS_SOLD,n.sendByUserId=T,n.sessionId=ae,n.type=tt.Z.CHAT_TYPE_SOLD,[4,ge(n)];case 4:r.sent(),r.label=5;case 5:return[4,_e()];case 6:return r.sent(),K.value.closeModal(),[2]}}))}))}function Ee(e){J.value.openModal(On.a.global.t("chat__confirm"),On.a.global.t("chat__confirm_to_reject"),On.a.global.t("chat__yes"),On.a.global.t("chat__no"),(function(){De(e)}),(function(){$e.Z.log("cancel")}))}function De(e){return(0,He.mG)(this,void 0,void 0,(function(){var t,n;return(0,He.Jh)(this,(function(r){switch(r.label){case 0:return V.itemId=E,V.buyerUserId=x,V.sellerUserId=S,V.negoPrice="0",V.type=tt.Z.CHAT_TO_BUYER,V.isUserOnline="1",V.message=e.message,K.value.openModal(),[4,z.makeOffer(T,V)];case 1:return t=r.sent(),t.status!=on.Z.ERROR?[3,2]:($e.Z.log(t.message),[3,5]);case 2:return G.id=e.id,G.isSold=!1,G.isUserBought=!1,G.itemId=e.itemId,G.message=e.message,G.offerStatus=tt.Z.CHAT_STATUS_OFFER,G.sendByUserId=e.sendByUserId,G.sessionId=e.sessionId,G.type=tt.Z.CHAT_TYPE_REJECT,G.addedDateTimeStamp=e.addedDate,[4,ge(G)];case 3:return r.sent(),n=(new In).ChatAcceptParameterHolder(),n.addedDateTimeStamp=ye(),n.isSold=!1,n.isUserBought=!1,n.itemId=E,n.message=e.message,n.offerStatus=tt.Z.CHAT_STATUS_REJECT,n.type=tt.Z.CHAT_TYPE_REJECT,n.sendByUserId=T,n.sessionId=ae,[4,ge(n)];case 4:r.sent(),r.label=5;case 5:return[4,_e()];case 6:return r.sent(),K.value.closeModal(),[2]}}))}))}function Re(e){te.value.openModal(e)}function Ne(){re.value.openModal(W,(function(){ee.value.openModal(On.a.global.t("chat__review_error"))}),(function(){X.value.openModal("",On.a.global.t("chat__review_sent"))}))}return(0,r.bv)((function(){return(0,He.mG)(C,void 0,void 0,(function(){return(0,He.Jh)(this,(function(e){switch(e.label){case 0:return[4,_e()];case 1:return e.sent(),I.value=!0,window.addEventListener("scroll",ve),de=document.getElementById("messages"),ue.orderByChild("itemId").equalTo(E).on("value",(function(e){fe.data=[];var t=[],n="";e.forEach((function(e){var r=e.val();if(r.key=e.key,r.offerStatus!=tt.Z.CHAT_STATUS_REJECT&&r.offerStatus!=tt.Z.CHAT_STATUS_SOLD||(ie.value=!0),null!=r){if(r.dateTimeString=$e.Z.timeStampToDateString(r.addedDate),null!=r.dateTimeString&&""!=r.dateTimeString&&r.dateTimeString.includes(" ")){var i=r.dateTimeString.split(" ");if(r.dateString=i[0],r.timeString=i[1],""==n||n!=r.dateString){n=r.dateString;var o={};o.message=r.dateString,o.type=tt.Z.CHAT_TYPE_DATE,t.push(o)}}var s=new Dn;s=s.fromMap(r),t.push(s)}})),fe.data=t.reverse(),we(1500),ce.child(W).on("value",(function(e){if(null!=e.val()){var t=e.val().userId;se.value=t==W}else se.value=!1}))})),[2]}}))}))})),(0,r.Ah)((function(){le.child(T).remove(),ce.child(T).remove(),window.removeEventListener("scroll",ve)})),{dataReady:I,chatHistoryProvider:H,userProvider:he,sellerUserId:S,handleScroll:ve,chats:fe,chatFlag:A,sendMessage:ge,inputMessageController:pe,itemName:P,itemId:E,itemImageName:D,itemPrice:R,currency:N,condition:U,PsConst:tt.Z,loginUserId:T,otherUserId:W,isOtherUserOnline:se,onImageClick:Ce,image:oe,onImageSelected:be,ps_loading_dialog:K,ps_confirm_dialog:J,makeOfferClicked:ke,offer_modal:ne,review_modal:re,submitOffer:Te,offerProvider:z,acceptOffer:Ie,rejectOffer:Ee,sendNormalMessage:me,isUserBought:Se,markAsSold:Pe,imageView:Re,chat_image:te,showOffer:ie,clickGiveReview:Ne,ps_error_dialog:ee,ps_success_dialog:X,formatPrice:M,isSoldOut:O}}};const Ln=(0,Pt.Z)(Mn,[["render",We]]);var qn=Ln},6626:function(e,t,n){var r=n(655),i=n(6921),o=n(3616),s=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.id="",t.description="",t.message="",t.addedDate="",t.addedUserId="",t.isRead="",t.addedDateStr="",t.defaultPhoto=new o.Z,t}return(0,r.ZT)(t,e),t.prototype.init=function(e,t,n,r,i,o,s,a){return this.id=e,this.description=t,this.message=n,this.addedDate=r,this.addedUserId=i,this.isRead=o,this.addedDateStr=s,this.defaultPhoto=a,this},t.prototype.getPrimaryKey=function(){return this.id},t.prototype.toMap=function(e){var t={};return t["id"]=e.id,t["description"]=e.description,t["message"]=e.message,t["added_date"]=e.addedDate,t["added_user_id"]=e.addedUserId,t["is_read"]=e.isRead,t["added_date_str"]=e.addedDateStr,t["default_photo"]=(new o.Z).toMap(e.defaultPhoto),t},t.prototype.toMapList=function(e){for(var t=[],n=0;n<e.length;n++)null!=e[n]&&t.push(this.toMap(e[n]));return t},t.prototype.fromMap=function(e){return(new t).init(e.id,e.description,e.message,e.added_date,e.added_user_id,e.is_read,e.added_date_str,(new o.Z).fromMap(e.default_photo))},t.prototype.fromMapList=function(e){var t=[];for(var n in e)null!=n&&t.push(this.fromMap(n));return t},t}(i.L);t["Z"]=s},8593:function(e,t,n){n.d(t,{ZK:function(){return p}});var r=n(655),i=n(2262),o=n(4578),s=n(2255),a=n(1597),u=n(6626),l=function(){function e(){this.itemId="",this.buyerUserId="",this.sellerUserId="",this.message="",this.type=""}return e.prototype.ChatNotiPrameterHolder=function(){this.itemId="",this.buyerUserId="",this.sellerUserId="",this.message="",this.type=""},e.prototype.toMap=function(){var e={};return e["item_id"]=this.itemId,e["buyer_user_id"]=this.buyerUserId,e["seller_user_id"]=this.sellerUserId,e["message"]=this.message,e["type"]=this.type,e},e}(),c=l,h=n(2317),d=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.isNoMoreRecord=(0,i.qj)(!1),t.notiList=(0,i.qj)(new a.Z),t.noti=(0,i.qj)(new a.Z),t.loading=(0,i.qj)({value:!1}),t.limit=30,t.offset=0,t}return(0,r.ZT)(t,e),t.prototype.updateNotiList=function(e){var t;null!=this.notiList&&null!=this.notiList.data&&this.notiList.data.length>0&&0!=this.offset?(null!=e.data&&e.data.length>0?(t=this.notiList.data).push.apply(t,e.data):this.isNoMoreRecord=!0,this.notiList.code=e.code,this.notiList.status=e.status,this.notiList.message=e.message):this.notiList=e,null!=this.notiList&&null!=this.notiList.data&&(this.offset=this.notiList.data.length)},t.prototype.loadNotiList=function(e){return(0,r.mG)(this,void 0,void 0,(function(){var t;return(0,r.Jh)(this,(function(n){switch(n.label){case 0:return this.loading.value=!0,[4,s.Z.getNotificationList(new u.Z,this.limit,this.offset,e.toMap())];case 1:return t=n.sent(),this.updateNotiList(t),this.loading.value=!1,[2]}}))}))},t.prototype.resetNotiList=function(e){return(0,r.mG)(this,void 0,void 0,(function(){var t;return(0,r.Jh)(this,(function(n){switch(n.label){case 0:return this.offset=0,this.loading.value=!0,[4,s.Z.getNotificationList(new u.Z,this.limit,this.offset,e.toMap())];case 1:return t=n.sent(),this.updateNotiList(t),this.loading.value=!1,[2]}}))}))},t.prototype.postNoti=function(e){return(0,r.mG)(this,void 0,void 0,(function(){return(0,r.Jh)(this,(function(t){switch(t.label){case 0:return this.offset=0,this.loading.value=!0,[4,s.Z.postNoti(new u.Z,e.toMap())];case 1:return t.sent(),this.loading.value=!1,[2]}}))}))},t.prototype.loadNoti=function(e,t){return(0,r.mG)(this,void 0,void 0,(function(){var n;return(0,r.Jh)(this,(function(r){switch(r.label){case 0:return this.loading.value=!0,n=this,[4,s.Z.getNotiDetail(new u.Z,e,t,this.limit,this.offset)];case 1:return n.noti=r.sent(),this.loading.value=!1,[2]}}))}))},t.prototype.postChatNoti=function(e,t,n,i,o){return(0,r.mG)(this,void 0,void 0,(function(){var a;return(0,r.Jh)(this,(function(r){switch(r.label){case 0:return a=new c,a.itemId=e,a.sellerUserId=t,a.buyerUserId=n,a.message=i,a.type=o,[4,s.Z.postChatNoti(new h.Z,a.toMap())];case 1:return r.sent(),[2]}}))}))},t.prototype.registerNotiToken=function(e){return(0,r.mG)(this,void 0,void 0,(function(){var t;return(0,r.Jh)(this,(function(n){switch(n.label){case 0:return this.loading.value=!0,[4,s.Z.rawRegisterNotiToken(new h.Z,e.toMap())];case 1:return t=n.sent(),this.loading.value=!1,[2,t]}}))}))},t.prototype.unRegisterNotiToken=function(e){return(0,r.mG)(this,void 0,void 0,(function(){var t;return(0,r.Jh)(this,(function(n){switch(n.label){case 0:return this.loading.value=!0,[4,s.Z.rawUnRegisterNotiToken(new h.Z,e.toMap())];case 1:return t=n.sent(),this.loading.value=!1,[2,t]}}))}))},t}(o.n),p=(Symbol("NotiProvider"),function(){return(0,i.qj)(new d)})}}]);
//# sourceMappingURL=Chat.6c50bb58.js.map